function waitingDialog(){$("#loadingScreen").show()}function closeWaitingDialog(){}!function(t){var e={localstorage_key:"CMDBuild-Authorization",types:{BASE:"base",SYSTEM:"system",PORTAL:"portal",URL:"url"},authenticationToken:null,lockedAuth:!1,getAuthenticationUrl:function(){return t.Cmdbuild.global.getApiUrl()+"sessions/"},setAuthenticationToken:function(t){this.authenticationToken=t},getAuthenticationToken:function(){var e=t.Cmdbuild.utilities.readCookie(t.Cmdbuild.access_token);return e?this.authenticationToken=e:!this.authenticationToken&&localStorage&&localStorage.getItem(this.localstorage_key)&&(this.authenticationToken=localStorage.getItem(this.localstorage_key)),this.authenticationToken},lockAuthentication:function(){this.lockedAuth=!0},unlockAuthentication:function(){this.lockedAuth=!1},isAuthLocked:function(){return this.lockedAuth},authenticate:function(){if(!this.isAuthLocked())switch(this.lockAuthentication(),t.Cmdbuild.global.getAuthenticationConfig().type){case this.types.BASE:this.baseAuthentication();break;case this.types.SYSTEM:this.systemAuthentication();break;case this.types.PORTAL:this.portalAuthentication();break;case this.types.URL:this.urlAuthentication();break;default:var e=new t.Cmdbuild.errorsManager.AuthenticationError("Please check authentication config.");t.Cmdbuild.errorsManager.popup(e)}},baseAuthentication:function(){},systemAuthentication:function(){var e={},i=t.Cmdbuild.global.getAuthenticationConfig();if(i.login&&i.login.username&&i.login.password)e.username=i.login.username,e.password=i.login.password,this.doAuthenticate(e);else{var a=t.Cmdbuild.global.getAppConfigUrl()+"auth.xml";t.Cmdbuild.utilities.getXmlDoc(a,this.systemAuthenticationXMLCB,this,{})}},systemAuthenticationXMLCB:function(e,i){if(e){var a=e.documentElement,r=t(a),n={};n.username=r.find(this.types.SYSTEM).find("username").text(),n.password=r.find(this.types.SYSTEM).find("password").text(),this.doAuthenticate(n)}},portalAuthentication:function(){var t={};this.doAuthenticate(t)},urlAuthentication:function(){var e=t.Cmdbuild.global.getAuthenticationConfig();urlconf=e.login.url;var i=this;t.ajax({type:urlconf.method?urlconf.method:"GET",url:urlconf.base,data:urlconf.params,cache:!1,success:function(t){i.onAuthenticationSuccess(t)},error:function(e,i,a){var r=new t.Cmdbuild.errorsManager.AuthenticationError;t.Cmdbuild.errorsManager.popup(r);var n="A problem occurred while authenticating. Please contact the administrator.";t.Cmdbuild.utilities.popupMessage("Authentication error",n)}})},doAuthenticate:function(e){var i=this,a=JSON.stringify(e);t.ajax({type:"POST",url:i.getAuthenticationUrl(),data:a,dataType:"json",contentType:"application/json",success:function(t){if(t){var e=t.data._id;i.onAuthenticationSuccess(e)}},error:function(e,i,a){var r=new t.Cmdbuild.errorsManager.AuthenticationError;t.Cmdbuild.errorsManager.popup(r)}})},onAuthenticationSuccess:function(e){this.setAuthenticationToken(e),this.unlockAuthentication(),t.Cmdbuild.utilities.startApplication()},getTokenFromLocalStorage:function(){return"undefined"!=typeof Storage?localStorage[this.localstorage_key]:void 0},setTokenToLocalStorage:function(t){"undefined"!=typeof Storage&&(localStorage[this.localstorage_key]=t)}};t.Cmdbuild.authentication=e}(jQuery),function(t){var e={AUTHENTICATION_HEADER:"CMDBuild-Authorization",contentType:"application/json",dataType:"json",loaderrequests:0,makeAjaxRequest:function(e,i,a,r,n){var o=t.Cmdbuild.authentication.getAuthenticationToken(),l=t.Cmdbuild.global.getLanguage();if(o){var s={};s[this.AUTHENTICATION_HEADER]=o,l&&(s["CMDBuild-Localized"]=!0,s["CMDBuild-Localization"]=l),n&&n===!0?this.noJSONAjaxRequest(e,i,a,r,s):this.directMakeAjaxRequest(e,i,a,r,s)}else t.Cmdbuild.authentication.authenticate()},directMakeAjaxRequest:function(e,i,a,r,n){var o=this;this.maskRequest(),t.ajax({type:i,url:e,data:r,cache:!1,dataType:this.dataType,crossDomain:!0,contentType:this.contentType,headers:n}).done(function(t){var e=t?t.data:void 0,i=t?t.meta:void 0;"function"==typeof a?a(e,i):a.success&&a.success(e,i)}).fail(function(t,i,n){"function"==typeof a?console.log("Ajax error = "+e+" -- ",r,Error().stack):a.fail?a.fail():a.failure&&a.failure()}).always(function(){"function"!=typeof a&&a.callback&&a.callback(),o.unmaskRequest()})},noJSONAjaxRequest:function(e,i,a,r,n){var o=this;this.maskRequest(),t.ajax({type:i,url:e,data:r,cache:!1,contentType:!1,processData:!1,headers:n}).done(function(t){"function"==typeof a?a(t):a.success&&a.success(t)}).fail(function(t,i,n){"function"==typeof a?console.log("Ajax error = "+e+" -- ",r,Error().stack):a.fail?a.fail():a.failure&&a.failure()}).always(function(){"function"!=typeof a&&a.callback&&a.callback(),o.unmaskRequest()})},maskRequest:function(){var e=t.Cmdbuild.global.getHtmlContainer().getAttribute("id");0===this.loaderrequests&&t("#"+e).waitMe({effect:"stretch",color:"#1c94c4"}),this.loaderrequests++},unmaskRequest:function(){var e=t.Cmdbuild.global.getHtmlContainer().getAttribute("id");this.loaderrequests--,0===this.loaderrequests&&t("#"+e).delay(500).waitMe("hide")}};t.Cmdbuild.authProxy=e}(jQuery),function(t){var e={context:[],push:function(t){this.context.push({container:t.container,form:t.form})},pop:function(t){for(var e=0;e<this.context.length;e++)t.container==this.context[e].container&&this.context.splice(e,this.context.length-e)},path:function(t){for(var e="",i=0;i<this.context.length&&(e+=this.context[i].container+"_",t.container!=this.context[i].container);i++);return e},getFormPath:function(t){for(var e=this.context.length-1;e>=0;e--)if(t==this.context[e].form)return this.path({container:this.context[e].container})}};t.Cmdbuild.standard.contextStack=e}(jQuery),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){function e(t){return l.raw?t:encodeURIComponent(t)}function i(t){return l.raw?t:decodeURIComponent(t)}function a(t){return e(l.json?JSON.stringify(t):String(t))}function r(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(o," ")),l.json?JSON.parse(t):t}catch(e){}}function n(e,i){var a=l.raw?e:r(e);return t.isFunction(i)?i(a):a}var o=/\+/g,l=t.cookie=function(r,o,s){if(void 0!==o&&!t.isFunction(o)){if(s=t.extend({},l.defaults,s),"number"==typeof s.expires){var d=s.expires,u=s.expires=new Date;u.setTime(+u+864e5*d)}return document.cookie=[e(r),"=",a(o),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}for(var c=r?void 0:{},m=document.cookie?document.cookie.split("; "):[],g=0,f=m.length;f>g;g++){var p=m[g].split("="),b=i(p.shift()),h=p.join("=");if(r&&r===b){c=n(h,o);break}r||void 0===(h=n(h))||(c[b]=h)}return c};l.defaults={},t.removeCookie=function(e,i){return void 0===t.cookie(e)?!1:(t.cookie(e,"",t.extend({},i,{expires:-1})),!t.cookie(e))}}),function(t){var e={insertChildren:function(t){for(var e="",i=0;i<t.childNodes.length;i++)e+=this.toHtml(t.childNodes[i]);return e},toHtml:function(e){try{var i=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.MALFORMEDXMLNODE,element:e.nodeName});if("html"==e.nodeName)throw i;if("ldap"==e.nodeName)return"";if("rowButton"==e.nodeName)return"";if("columnsCommands"==e.nodeName)return"";if("#text"==e.nodeName)return"";if("onInit"==e.nodeName)return"";if("onDblClick"==e.nodeName)return"";if("onClick"==e.nodeName)return"";if("onChange"==e.nodeName)return"";if("params"==e.nodeName)return"";if("form"==e.nodeName)return"";if("openEntry"==e.nodeName)return"";if("#comment"==e.nodeName)return"";if("observe"==e.nodeName)return"";if("fields"==e.nodeName)return"";if("widgets"==e.nodeName)return"";if("buttons"==e.nodeName)return"";if("noActivityFields"==e.nodeName)return"";if(t.Cmdbuild.custom.elements&&t.Cmdbuild.custom.elements[e.nodeName]){var a=t.Cmdbuild.custom.elements[e.nodeName](e);return a}if(t.Cmdbuild.standard.elements[e.nodeName]){var a=t.Cmdbuild.standard.elements[e.nodeName](e);return a}console.log(e.nodeName+" not found!");var i=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.XMLTAGNOTDEFINED,element:e.nodeName});throw i}catch(r){var n="$.Cmdbuild.elementsManager.toHtml";throw t.Cmdbuild.errorsManager.log(n),t.Cmdbuild.errorsManager.log(r),r}return""},insertLoadingMask:function(t){var e="<div id='"+t+"'><h1>wait wait wait</h1></div>";return e},insertDialog:function(e,i){var a="<div id='"+e+"'></div>";return t.Cmdbuild.scriptsManager.push({script:"dialog",id:e,callback:i}),a},getText:function(e){var i=e.getAttribute("i18nText"),a=e.getAttribute("variableText"),r="";return r=t.Cmdbuild.utilities.escapeHtml(e.getAttribute("text")),a&&(r+=" "+t.Cmdbuild.dataModel.resolveVariable(a)),i?t.Cmdbuild.translations.getTranslation(i,r):r},getTooltip:function(e){var i=e.getAttribute("i18nTooltip"),a="";return a=t.Cmdbuild.utilities.escapeHtml(e.getAttribute("tooltip")),i?t.Cmdbuild.utilities.escapeHtml(t.Cmdbuild.translations.getTranslation(i,a)):a},getXmlElementId:function(t){var e=t.getAttribute("id");return e},getCommonAttributes:function(e){var i=" ",a=t.Cmdbuild.elementsManager.getXmlElementId(e);a&&(i+="id='"+a+"' ");var r=e.getAttribute("class");r&&(i+="class='"+r+"' ");var n=e.getAttribute("interactivity");n&&(i+="interactivity='"+n+"' ",i+=n==t.Cmdbuild.global.READ_ONLY?" disabled ":"");var o=e.getAttribute("title");o&&(i+="title='"+o+"' ");var l=e.getAttribute("formName");l&&(i+="formName='"+l+"' ");var s=e.getAttribute("fieldName");s&&(i+="fieldName='"+s+"' ");var d=e.getAttribute("height");d&&(i+="height='"+d+"' ");var u=e.getAttribute("width");u&&(i+="width='"+u+"' ");var c=t.Cmdbuild.elementsManager.getTooltip(e);return c&&(i+="title='"+c+"' "),i},insertReturn:function(t){var e="",i=t.getAttribute("withReturn");return"true"==i&&(e+="<br/>"),e},isReturn:function(t){return"true"==t.getAttribute("withReturn")?!0:!1},insertLabel:function(e){var i=t.Cmdbuild.elementsManager.getXmlElementId(e),a=e.getAttribute("label"),r=e.getAttribute("i18nLabel");r&&(a=t.Cmdbuild.translations.getTranslation(r,a));var n=e.getAttribute("interactivity")||t.Cmdbuild.global.READ_WRITE,o=n==t.Cmdbuild.global.READ_WRITE_REQUIRED?"* ":"",l=e.getAttribute("classLabel"),s=" class='cmdbuildLabel"+(l?" "+l:"")+"'";return htmlStr="<label for='"+i+"'"+s+">"+o+a+"</label>",a?htmlStr:""},wrapInLayoutContainer:function(t,e){var i=t.getAttribute("labelPosition");return"over"==i?"<div class='cdmdbuildVboxContainer'>"+e+"</div>":e},wrapInRowContainer:function(e,i){var a=t.Cmdbuild.elementsManager.isReturn(e)?" cmdbuildBlockFormRow":"";return"<div class='cmdbuildFormRow"+a+"'>"+i+"</div>"},wrapInFormRow:function(e,i,a,r){var n=t("<dl></dl>").addClass("cmdbuildGuiFormRow").addClass("cmdbuildGuiFormRow-"+a);r&&n.addClass("cmdbuildGuiFormRowReadOnly");var o=t("<dt></dt>").html(e);e&&n.append(o);var l=t("<dd></dd>").html(i);return n.append(l),n.prop("outerHTML")},getEvent:function(e,i){var a={},r=t(i),n=r.children(e);return n.children().length?(a.id=r.attr("id"),n.children().each(function(e){var i=t(this).prop("tagName"),r=t(this).text();a[i]=r}),a):null},getGroupElements:function(e,i,a){a=a||{};var r=t(e),n=r,o=n.children(i);return o.children().each(function(e){var i=t(this).prop("tagName");if(!a[i]){var r=t(this).text();a[i]=r}}),t.isEmptyObject(a)?null:a},getRowButtons:function(e,i){var a=[],r=t(e);r.children("rowButton").each(function(e){a.push({id:t(this).attr("id"),tooltip:t(this).attr("tooltip"),className:t(this).attr("class"),text:t(this).attr("text"),i18nText:t(this).attr("i18nText"),onClick:t.Cmdbuild.elementsManager.getEvent("onClick",this),onMouseOver:t.Cmdbuild.elementsManager.getEvent("onMouseOver",this),params:t.Cmdbuild.elementsManager.getParams(this)}),t.Cmdbuild.dataModel.prepareCallerParameters(t(this).attr("id"),t.Cmdbuild.elementsManager.getParams(this))}),i.rowButtons=a},getColumnsCommands:function(e,i){var a=[],r=t(e);r.children("columnsCommands").children("column").each(function(e,i){a.push({attribute:t(i).children("name").text(),icon:t(i).children("icon").text(),onClick:t.Cmdbuild.elementsManager.getEvent("onClick",this)})}),i.columnsCommands=a},getParams:function(t,e){return this.getGroupElements(t,"params",e)},isObserving:function(e,i){var a=this.getGroupElements(e,"observe");if(a){var r=e.getElementsByTagName("observe")[0].getAttribute("container");return t.Cmdbuild.dataModel.setObserver({container:r,form:i,fields:a}),!0}return!1},getElement:function(e){var i=t(t.Cmdbuild.global.getConfigurationDocument()),a=i.find("#"+e);if(!a){var r=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.XMLELEMENTNOTDEFINED,element:e});throw r}return a[0]},initialize:function(){t.Cmdbuild.scriptsManager.execute()},makeServiceButton:function(e,i,a,r){var n="";return n+="<button class='"+e+"' id='"+i+"' onclick='"+r+"'></button>",t.Cmdbuild.scriptsManager.push({script:"button",id:i,icon:a}),n},loadIconButtons:function(e,i,a){for(var r=0;r<i.length;r++){var n=t.Cmdbuild.dataModel.resolveVariables(i[r].params);if("false"!=n.condition){var o={type:"IMAGEBUTTON",displayableInList:!0,active:!0,name:i[r].id,className:i[r].className?i[r].className:i[r].id,tooltip:i[r].tooltip,text:t.Cmdbuild.translations.getTranslation(i[r].i18nText,i[r].text),onClick:JSON.stringify(i[r].onClick)};"left"==a?e.splice(r,0,o):e.push(o)}}},pushSelectionCheck:function(e,i){var a={type:"ROWSELECTIONCHECK",displayableInList:!0,active:!0,name:"selectionCheck",tooltip:t.Cmdbuild.global.SELECTIONTOOLTIP};"left"==i?e.splice(0,0,a):e.push(a)}};t.Cmdbuild.elementsManager=e}(jQuery),function(t){var e="An error is occured!";AuthenticationError=function(t){this.name="AuthenticationError",this.message=t||"Authentication error"},AuthenticationError.prototype=new Error,AuthenticationError.prototype.constructor=AuthenticationError;var i={isDialogOpen:!1,CMERROR:"cmError",ERROREXPLAINED:1,EVENTCOMMANDNOTFOUND:101,EVENTMETHODNOTDEFINED:102,INITNOTDEFINED:103,XMLTAGNOTDEFINED:201,MALFORMEDXMLNODE:202,BACKENDMETHODNOTDEFINED:301,FORMFIELDMETHODNOTDEFINED:401,AJAXERROR:501,AJAXERRORNOTFOUND:502,XMLELEMENTNOTDEFINED:601,MALFORMEDVARIABLE:602,SCRIPTNOTDEFINED:701,XMLFILENOTFOUND:801,XMLFILENOTCORRECT:802,PARAMNOTCORRECT:901,AUTHENTICATIONERROR:902,CONTAINERNOTFOUND:1001,CONFIGURATIONDOCUMENTNOTFOUND:1002,CLASSNOTFOUND:1101,CLASSNOTFOUND:1101,UNDEFINEDDEFAULTROLE:1201,AuthenticationError:AuthenticationError,strings:{0:"Errore {1} non riconosciuto",1:"{1}",101:"Non Ã¨ definito l'elemento Command.\nElement Xml: {1}",102:"Comando non riconosciuto.\nElement Xml: {1}\nComando:{2}",103:"Init [ {1} {2} ] nella form [ {3} ] non definito",201:"Elemento {1} non definito",202:"Nodo Xml {1} non corretto",301:"Backend {1} non definito",501:"Ajax: errata richiesta.\nUrl: {1}",502:"Ajax: elemento non trovato nel Datatabase.\nUrl: {1}",601:"Elemento Xml [ {1} ] non presente nel file di configurazione",602:"Formato della variabile [ {1} ]\nerrato in [ {2} ]",701:"Script [ {1} ] non definito in {2}",801:"Xml file [ {1} ] non trovato",802:"Xml file [ {1} ] non corretto",901:"Parametro [ {1} {2} ] nella form [ {3} ] non corretto",902:"Credenziali di login non trovate: table {1} key {2} value {3}",1001:"Container Html non definito",1002:"Configuration [ {1} ] non definito",1101:"Classe [ {1} ] non trovata",1201:"Default role non definito per questo utente"},log:function(t){"object"==typeof t&&t.cmParam?console.log(t,t.cmParam.type,t.stack):"object"==typeof t?console.log(t,t.stack):console.log(t,t.stack)},warn:function(t){console.warn(t)},error:function(t){console.error(t)},popupOnRequestFields:function(e,i){if(e.length>0){var a=this.getAttributesErrorsMessage(e);return t.Cmdbuild.utilities.popupMessage("Error!",a,"errorDialog",600,400,i),!1}},popup:function(i){if(!this.isDialogOpen){this.isDialogOpen=!0,this.log(i);var a="";a+="<h2>"+e+"</h2>",i.message==this.CMERROR?(a+="<p>"+i.cmParam.type+"</p>",a+="<p>"+this.getErrorMessage(i)+"</p>"):a+="<p>"+i.message+"</p>",t.Cmdbuild.utilities.popupMessage(i.name,a,"errorDialog")}},close:function(){this.isDialogOpen=!1},getErrorMessage:function(e){switch(e.cmParam.type){case this.ERROREXPLAINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.EVENTCOMMANDNOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.EVENTMETHODNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element,e.cmParam.method);case this.INITNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.param,e.cmParam.method,e.cmParam.element);case this.XMLTAGNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.MALFORMEDXMLNODE:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.BACKENDMETHODNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.AJAXERROR:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.AJAXERRORNOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.XMLELEMENTNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.MALFORMEDVARIABLE:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.variable,e.cmParam.element);case this.SCRIPTNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.XMLFILENOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.XMLFILENOTCORRECT:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.PARAMNOTCORRECT:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.param,e.cmParam.method,e.cmParam.element);case this.AUTHENTICATIONERROR:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.table,e.cmParam.key,e.cmParam.value);case this.CONTAINERNOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type]);case this.CONFIGURATIONDOCUMENTNOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.CLASSNOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.UNDEFINEDDEFAULTROLE:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type]);default:return t.Cmdbuild.utilities.formatVarString(this.strings[0],e.cmParam.type,e.cmParam.element)}},getError:function(t){var e=new Error(t.message);return e.cmParam=t,e},getAttributesErrorsMessage:function(t){for(var e="",i=0;i<t.length;i++){var a=t[i];e+="<p>",e+=a.message?"<strong>"+a.field+":</strong> "+a.message:"Il campo "+a.field+" deve essere valorizzato",e+="</p>"}return e}};t.Cmdbuild.errorsManager=i}(jQuery),function(t){var e={events:[],deferred:0,onEvent:function(t){t&&(this.events.push(t),this.executeAllEvents())},deferEvents:function(){this.deferred++},unDeferEvents:function(){this.deferred--,this.executeAllEvents()},executeAllEvents:function(){if(!(this.deferred>0))for(;this.events.length>0;){var t=this.events[0];this.events.splice(0,1),this.executeEvent(t)}},executeEvent:function(e){try{if(!e.command){var i=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.EVENTCOMMANDNOTFOUND,element:e.id});throw i}if(t.Cmdbuild.dataModel.callerParameters[e.id]&&t.Cmdbuild.dataModel.pushParametersOnStack(e.id),t.Cmdbuild.custom.commands&&t.Cmdbuild.custom.commands[e.command])t.Cmdbuild.custom.commands[e.command](e);else{if(!t.Cmdbuild.standard.commands[e.command]){var i=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.EVENTMETHODNOTDEFINED,element:e.id,method:e.command});throw i}t.Cmdbuild.standard.commands[e.command](e)}}catch(a){throw t.Cmdbuild.errorsManager.log("$.Cmdbuild.eventsManager.executeEvent "+e.command),a}}};t.Cmdbuild.eventsManager=e}(jQuery),function(t){var e="cmdbuildGuiFormField",i={types:{BOOLEAN:"boolean",CHAR:"char",DATE:"date",DECIMAL:"decimal",DOUBLE:"double",IPADDRESS:"ipAddress",INTEGER:"integer",LOOKUP:"lookup",REFERENCE:"reference",STRING:"string",TEXT:"text",TIME:"time",DATETIME:"dateTime",FOREIGNKEY:"foreignKey",SELECT:"select"},generateHTML:function(t,e,i,a,r){var n=t.writable===!0||"true"===t.writable,o=t.mandatory===!0||"true"===t.mandatory,l=this.getFormFieldContainer(e,t._id,t.type,t.description,t.hidden,!n,o),s=this.getFormField(t,e,i,a,r);return t.hidden?l.append(s):l.find("dd").append(s),l},getFieldValidator:function(e){var i={};switch(e.mandatory&&(i.required=!0),e.type){case this.types.DECIMAL:i.decimal=[e.precision,e.scale];break;case this.types.DOUBLE:i.number=!0;break;case this.types.IPADDRESS:"ipv4"===e.ipType?i.ipv4=!0:"ipv6"===e.ipType&&(i.ipv6=!0);break;case this.types.INTEGER:i.integer=!0;break;default:$output=t("<span></span>").text(e.type+" not implemented")}return{rules:i}},getFormFieldContainer:function(i,r,n,o,l,s,d){var u,c=a(i,r);if(l)u=t("<div></div>");else{u=t("<dl></dl>").addClass(e).addClass(e+"-"+n),s?u.addClass(e+"ReadOnly"):d&&(o="* "+o);var m=t("<dt></dt>").append(t("<label></label>").addClass("cmdbuildLabel").attr("for",c).text(o));u.append(m).append(t("<dd></dd>"))}return u.attr("id",c+"_container"),u},getFormField:function(e,i,a,r,C){var v,y=this;if(e.hidden)v=n(i,e._id,r);else switch(e.type){case y.types.BOOLEAN:v=o(i,e,r);break;case y.types.CHAR:v=l(i,e,r);break;case y.types.DATE:v=s(i,e,r);break;case y.types.DATETIME:v=s(i,e,r);break;case y.types.DECIMAL:v=d(i,e,r);break;case y.types.DOUBLE:v=u(i,e,r);break;case y.types.FOREIGNKEY:v=f(i,a,e,r);break;case y.types.IPADDRESS:e.ipType="ipv4",v=c(i,e,r);break;case y.types.INTEGER:v=m(i,e,r);break;case y.types.LOOKUP:v=g(i,e,r);break;case y.types.REFERENCE:v=f(i,a,e,r,C);break;case y.types.SELECT:v=p(i,e,r);break;case y.types.STRING:v=b(i,e,r);break;case y.types.TEXT:v=h(i,e,r);break;case y.types.TIME:v=s(i,e,r);break;default:v=t("<span></span>").text(e.type+" not implemented")}return v},getFieldId:function(t,e){return a(t,e)}},a=function(t,e){return e=e.split(".").join("-"),t+"-field-"+e},r=function(t,e,i){if(t.attr("id",a(i,e._id)),t.attr("formName",i).attr("form",i),t.attr("name",e._id).attr("fieldName",e._id),e.className&&t.addClass(e.className),e.title||e.tooltip){var r=e.title?e.title:e.tooltip;t.attr("title",r)}e.width&&t.attr("width",e.width),e.height&&t.attr("height",e.height)},n=function(e,i,a){var n=t("<input></input>").attr("type","hidden");return r(n,{_id:i},e),a&&n.val(a),n},o=function(e,i,a){if(i.writable===!0||"true"===i.writable){var o=t("<input></input>").attr("type","checkbox");return r(o,i,e),(a===!0||"true"===a)&&o.attr("checked","checked"),o}var o=n(e,i._id,a),l=a===!0||"true"===a?t.Cmdbuild.translations.getTranslation("cgf_core_boolfield_yes","Yes"):t.Cmdbuild.translations.getTranslation("cgf_core_boolfield_no","No");return[l,o]},l=function(e,i,a){if(i.writable===!0||"true"===i.writable){var o=t("<input></input>").attr("type","text");return r(o,i,e),o.attr("maxlength",1).attr("size",1),a&&o.val(a),o}var o=n(e,i._id,a),l=t("<span></span>").text(a?a:"");return[l,o]},s=function(e,i,a){if(i.writable===!0||"true"===i.writable){var o=t("<input></input>").attr("type","text");switch(r(o,i,e),o.attr("isDate",!0).attr("date-input-type",i.type),a&&(a=t.Cmdbuild.utilities.convertDateDB2GUI(a,i.type),o.val(a)),i.type){case"time":o.timepicker({timeFormat:"HH:mm:ss"});break;case"date":o.datepicker({dateFormat:"dd/mm/yy"});break;case"dateTime":o.datetimepicker({dateFormat:"dd/mm/yy",timeFormat:"HH:mm:ss"})}return o}var o=n(e,i._id,a),l=t("<span></span>").text(a?t.Cmdbuild.utilities.convertDateDB2GUI(a,i.type):"");return[l,o]},d=function(e,i,a){if(i.writable===!0||"true"===i.writable){var o=t("<input></input>").attr("type","text");return r(o,i,e),a&&o.val(a),o}var o=n(e,i._id,a),l=t("<span></span>").text(a?a:"");return[l,o]},u=function(e,i,a){if(i.writable===!0||"true"===i.writable){var o=t("<input></input>").attr("type","text");return r(o,i,e),a&&o.val(a),o}var o=n(e,i._id,a),l=t("<span></span>").text(a?a:"");return[l,o]},c=function(e,i,a){if(i.writable===!0||"true"===i.writable){var o=t("<input></input>").attr("type","text");return r(o,i,e),"ipv4"===i.ipType?o.attr("maxlength","15"):"ipv6"===i.ipType&&o.attr("maxlength","39"),a&&o.val(a),o}var o=n(e,i._id,a),l=t("<span></span>").text(a?a:"");return[l,o]},m=function(e,i,a){if(i.writable===!0||"true"===i.writable){var o=t("<input></input>").attr("type","text");return r(o,i,e),a&&o.val(a),o}var o=n(e,i._id,a),l=t("<span></span>").text(a?a:"");return[l,o]},g=function(e,i,a){var o,l=i.writable===!0||"true"===i.writable;if(l){var o=t("<select></select>");r(o,i,e),t("#"+e).on("DOMNodeInserted",function(i){t("#"+e).find("#"+o.attr("id")).length&&(t(i.target).attr("id")===o.attr("id")||t(i.target).find("#"+o.attr("id")).length)&&o.selectmenu({change:function(e,i){var a={id:o.attr("id")};t.Cmdbuild.custom.commands&&t.Cmdbuild.custom.commands.fieldChanged?t.Cmdbuild.custom.commands.fieldChanged(a):t.Cmdbuild.standard.commands.fieldChanged(a)}})})}else var o=n(e,i._id,a);var s=o.attr("id");return new t.Cmdbuild.standard.lookupField({form:e,id:s,readOnly:!l,lookupType:i.lookupType,value:a}),o},f=function(e,i,a,o,l){var s,d=[],u=a.writable===!0||"true"===a.writable;if(u){var s=t("<select></select>");r(s,a,e);var c=t("<button></button>").attr("id",s.attr("id")+"_btnsearch").addClass("cmdbuildButton").button({icons:{primary:"ui-icon-search"},text:!1}).click(function(t){return s.trigger("searchreferenceitem"),!1}),m=t("<button></button>").attr("id",s.attr("id")+"_btnclear").addClass("cmdbuildButton").button({icons:{primary:"ui-icon-closethick"},text:!1}).click(function(t){return s.trigger("clearreference"),!1});t("#"+e).on("DOMNodeInserted",function(i){t("#"+e).find("#"+s.attr("id")).length&&(t(i.target).attr("id")===s.attr("id")||t(i.target).find("#"+s.attr("id")).length)&&s.selectmenu({change:function(e,i){var a={id:s.attr("id")};t.Cmdbuild.custom.commands&&t.Cmdbuild.custom.commands.fieldChanged?t.Cmdbuild.custom.commands.fieldChanged(a):t.Cmdbuild.standard.commands.fieldChanged(a)}})}),d.push(s,c,m)}else{var s=n(e,a._id,o);d.push(s)}var g,f,p=s.attr("id");a.target?(g=a.target.type,f=a.target.name):(g=a.targetType,f=a.targetClass);var b=!1;return a.metadata&&a.metadata["system.type.reference.preselectIfUnique"]&&(b=a.metadata["system.type.reference.preselectIfUnique"]===!0||"true"===a.metadata["system.type.reference.preselectIfUnique"]),l||(l=e),new t.Cmdbuild.standard.referenceField({id:p,container:i,targetClass:f,targetType:g,filter:a.filter,readOnly:!u,optionsLimit:a.optionsLimit,value:o,displayAttribute:a.displayAttribute,mandatory:a.mandatory,preselectIfUnique:b,cqlRefForm:l,cqlRefField:a.name,customBackend:a.customBackend,sortAttribute:a.sortAttribute,sortDirection:a.sortDirection}),d},p=function(e,i,a){var o,l=i.writable===!0||"true"===i.writable;if(l){var o=t("<select></select>");r(o,i,e),t("#"+e).on("DOMNodeInserted",function(i){t("#"+e).find("#"+o.attr("id")).length&&(t(i.target).attr("id")===o.attr("id")||t(i.target).find("#"+o.attr("id")).length)&&o.selectmenu({change:function(e,i){var a={id:o.attr("id")};t.Cmdbuild.custom.commands&&t.Cmdbuild.custom.commands.fieldChanged?t.Cmdbuild.custom.commands.fieldChanged(a):t.Cmdbuild.standard.commands.fieldChanged(a)}})})}else var o=n(e,i._id,a);var s=o.attr("id");return new t.Cmdbuild.standard.selectField({form:e,id:s,readOnly:!l,backend:i.backend,options:i.options,value:a,hideEmptyOption:i.hideEmptyOption,refreshGridAfterInit:i.refreshGridAfterInit}),o},b=function(e,i,a){if(i.writable===!0||"true"===i.writable){var o=t("<input></input>").attr("type","text");return r(o,i,e),i.length&&o.attr("maxlength",i.length),a&&o.val(a),o}var o=n(e,i._id,a),l=t("<span></span>").text(a?a:"");return[l,o]},h=function(e,i,a){var n=t("<textarea></textarea>");r(n,i,e),a&&n.val(a);var o="HTML"===i.editorType?!0:!1;if(i.writable===!0||"true"===i.writable){var l=6;return i.rows&&(l=i.rows),n.attr("rows",l),i.cols&&n.attr("cols",i.cols),i.length&&n.attr("maxlength",i.lenght),o&&t("#"+e).on("DOMNodeInserted",function(e){t(e.target).find("#"+n.attr("id")).length&&n.cleditor({controls:"bold italic underline | size | color highlight | alignleft center alignright justify | link unlink | bullets numbering | pastetext | removeformat | source",bodyStyle:""})}),n}var s=t("<div></div>").addClass("textareaReadOnly");return o||(a=t.Cmdbuild.utilities.plain2html(a)),s.html(a),n.addClass("hiddentextarea").attr("disabled","disabled"),[s,n]};t.Cmdbuild.fieldsManager=i}(jQuery),function(t){var e={CQLUNDEFINEDVALUE:"CMDBUILDUNDEFINEDFIELD",MAILSTATUSDRAFT:"draft",MAILSTATUSNEW:"new",MAILSTATUSOUTGOING:"outgoing",MAILSTATUSRECEIVED:"received",NOVALUEONREQUIREDFIELD:"NOVALUEONREQUIREDFIELD",LOOKUPPROCESSSTATUSES:"FlowStatus",STATE_VALUE_OPEN:"",STATE_VALUE_SUSPENDED:"open.not_running.suspended",STATE_VALUE_COMPLETED:"closed.completed",STATE_VALUE_ABORTED:"closed.aborted",STATE_VALUE_ALL:"all",PROCESS_STARTED:1,PROCESS_SUSPENDED:2,PROCESS_COMPLETED:3,PROCESS_STOPPED:4,PROCESS_INTERRUPTED:5,READ_WRITE_REQUIRED:"READ_WRITE_REQUIRED",READ_WRITE:"READ_WRITE",READ_ONLY:"READ_ONLY",htmlContainer:null,themeCSSClass:null,debugMode:void 0,ID_TAGS:["onClick > dialog","onClick > form","onClick > container","onClick > *[variableId='true']","onInit > dialog","onInit > form","onInit > container","onInit > *[variableId='true']","onChange > dialog","onChange > form","onChange > container","onInit > *[variableId='true']","params > *[variableId='true']","observe > *[variableId='true']"],ID_TAGSWITHVARIABLEATTRIBUTES:[["observe","container"]],WIDTH_REFERENCE:400,GRIDROWSCOUNT:"Page {1} of {2} (records {3})",GROUPOTHER:"Others",SELECTIONTOOLTIP:"Select element",modalMaxHeight:600,modalMaxWidth:800,fieldInteractivityFromProcess:function(t,e){return t&&e?this.READ_WRITE_REQUIRED:t?this.READ_WRITE:this.READ_ONLY},fieldInteractivityFromCard:function(t){return t===!0?this.READ_WRITE_REQUIRED:this.READ_WRITE},setHtmlContainer:function(t){this.htmlContainer=t[0]},getHtmlContainer:function(){try{if(this.htmlContainer)return this.htmlContainer;var e=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.CONTAINERNOTFOUND});throw e}catch(i){throw t.Cmdbuild.errorsManager.log(i),i}},setConfigurationDocument:function(e,i){var a={callback:i};t.Cmdbuild.utilities.getXmlDoc(e,this.setConfigurationDocumentCB,this,a)},setConfigurationDocumentCB:function(t,e){this.configurationDocument=t,e.callback()},getConfigurationDocument:function(){try{if(this.configurationDocument)return this.configurationDocument;var e=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.CONFIGURATIONDOCUMENTNOTFOUND,element:""});throw e}catch(i){throw t.Cmdbuild.errorsManager.log(i),i}},setThemeCSSClass:function(t){this.themeCSSClass=t},getThemeCSSClass:function(){return this.themeCSSClass},setApiUrl:function(t){this.apiUrl=t},getApiUrl:function(){return this.apiUrl},setAppRootUrl:function(t){this.appRootUrl=t},getAppRootUrl:function(){return this.appRootUrl},setAppConfigUrl:function(t){this.appConfigUrl=t},getAppConfigUrl:function(){return this.appConfigUrl},setCqlUrl:function(t){this.cqlUrl=t},getCqlUrl:function(){return this.cqlUrl},setLanguage:function(t){this.language=t},getLanguage:function(){return this.language},setDebugMode:function(t){this.debugMode=t},isDebugMode:function(){return this.debugMode},setAuthenticationConfig:function(e){
var i={};"string"==typeof e?i.type=e:"object"==typeof e&&e&&e.type?i=e:i.type=t.Cmdbuild.authentication.types.BASE,this.authConf=i},getAuthenticationConfig:function(){return this.authConf},getApplicationConfig:function(){var e=t.Cmdbuild.custom.configuration;return e||(e={}),t.extend({},t.Cmdbuild.standard.configuration,e)}};t.Cmdbuild.global=e}(jQuery),function(t){var e={configurator:void 0,variables:void 0,form:void 0,write:function(e){try{var i=function(t){console.log("cql.manager: "+t.msg)};this.form=e.form,this.configurator=new Configurator(i);var a=t.Cmdbuild.elementsManager.getElement(e.ldapDescriptor),r=this.getXmlValues(a,"fields","field");this.variables=this.getXmlValues(a,"variables","variable"),ldapRecord={},this.evaluateFields(r,ldapRecord,function(){ldapRecord=JSON.stringify(ldapRecord),t.Cmdbuild.utilities.proxyGuiServerSide.postLdap(ldapRecord,function(t){},this)},this)}catch(n){console.log("$.Cmdbuild.ldap.write "+n.message),t.Cmdbuild.errorsManager.popup(n)}},evaluateFields:function(e,i,a,r){try{if(e.length<=0)return void a.apply(r,[i]);var n=e[0];e.splice(0,1);var o=n.values.split(","),l=[n.format];this.evaluateSingleFields(o,l,function(){i[n.ldapName]=sprintf.apply(null,l),this.evaluateFields(e,i,a,r)},this)}catch(s){console.log("$.Cmdbuild.ldap.evaluateFields "+s.message),t.Cmdbuild.errorsManager.popup(s)}},evaluateSingleFields:function(e,i,a,r){try{if(e.length<=0)return void a.apply(r);var n=t.trim(e[0]);if(e.splice(0,1),"cql:"==(""+n).substr(0,4))this.resolveCql(n,function(t){i.push(t),this.evaluateSingleFields(e,i,a,r)},this);else{var o=t.Cmdbuild.dataModel.getValue(this.form,t.trim(n));i.push(o),this.evaluateSingleFields(e,i,a,r)}}catch(l){console.log("$.Cmdbuild.ldap.evaluateSingleFields "+l.message),t.Cmdbuild.errorsManager.popup(l)}},resolveCql:function(e,i,a){try{var r=(""+e).substr(4),n=r.split(".");if(2!=n.length)throw new t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.PARAMNOTCORRECT,param:"type",method:"ldap resolveCql",element:e});this.getVariable(n[0],function(t){this.resolveCqlCallback(t,n,i,a)},this)}catch(o){console.log("$.Cmdbuild.ldap.resolveCql "+o.message),t.Cmdbuild.errorsManager.popup(o)}},resolveCqlCallback:function(e,i,a,r){try{this.configurator.manager.cql.getValue("",e,function(n){if(n&&n.length<=0)throw new t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.PARAMNOTCORRECT,param:"type",method:"ldap resolveCql: Cql failed",element:e});var o="";n&&1==n.length&&(o=n[0][i[1]],"object"==typeof o&&(o=o.description)),a.apply(r,[o])},this)}catch(n){console.log("$.Cmdbuild.ldap.resolveCql "+n.message),t.Cmdbuild.errorsManager.popup(n)}},getVariable:function(e,i,a){for(var r=0;r<this.variables.length;r++)if(this.variables[r].key==e){var n={filter:this.variables[r].cql,meta:{},form:this.form};return void cqlEvaluate(n,function(t){i.apply(a,[t])},this)}throw new t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.PARAMNOTCORRECT,param:"type",method:"ldap resolveCql",element:"variable "+e+" not defined"})},getXmlValues:function(e,i,a){var r=t(e),n=r.find(i);if(n.length){for(var o=[],l=t(n[0]),s=0;s<l.children(a).length;s++){for(var d=t(l.children(a)[s]),u=d.children("*"),c={},m=0;m<u.length;m++){var g=t(u[m]),f=g.text(),p=g[0].tagName;c[p]=f}o.push(c)}return o}}};t.Cmdbuild.ldap=e}(jQuery),function($){var dataModel={model:{},observers:{},forms:{},formFields:{},callerParameters:{},parameters:{},widgets:{},attachments:{},classes:[],processes:[],observing:!0,isAProcess:function(t){return $.grep(this.processes,function(e){return e._id==t}).length>0},isAClass:function(t){return $.grep(this.classes,function(e){return e._id==t}).length>0},setClasses:function(t){this.classes=t},setProcesses:function(t){this.processes=t},cleanForm:function(t){this.forms[t]&&delete this.forms[t]},substituteWidgetWindow:function(t,e){this.widgets[t]=e},putWidgetWindow:function(t,e){this.widgets[t]=e},getWidgetWindow:function(t){return this.widgets[t]},prepareCallerParameters:function(t,e){$.Cmdbuild.dataModel.callerParameters[t]=e},pushSingleParameterOnStack:function(t,e){$.Cmdbuild.dataModel.parameters[t]=e},pushParametersOnStack:function(t){var e=$.Cmdbuild.dataModel.callerParameters[t];for(var i in e){var a=e[i];$.Cmdbuild.dataModel.parameters[i]=a}},getParameter:function(t){return $.Cmdbuild.dataModel.parameters[t]},deleteParameter:function(t){delete $.Cmdbuild.dataModel.parameters[t]},addFields:function(t,e){var i=[];for(var a in t)for(var r=0;r<e.length;r++){var n=e[r];if(a==n._id){n.displayableInList=!0;for(k in t[a])n[k]=t[a][k];i.push(n);break}}return i},evaluateFields:function(t,e){for(var i=[],a=this,r=0;r<e.length;r++){var n=e[r];for(var o in t)if(o==n._id){var l=t[o];if(jQuery.isEmptyObject(l)){n=null;break}if(l)for(var s in l)"interactivity"===s?($.Cmdbuild.errorsManager.warn("Interactivity is deprecated. Use hidden or writable properties"),l[s]===$.Cmdbuild.global.READ_ONLY?(n.writable=!1,n.mandatory=!1):l[s]===$.Cmdbuild.global.READ_WRITE_REQUIRED?(n.writable=!0,n.mandatory=!0):l[s]===$.Cmdbuild.global.READ_WRITE&&(n.writable=!0,n.mandatory=!1)):n[s]=a.resolveVariable(l[s]);break}n&&i.push(n)}return i},evaluateXmlAttributes:function(t,e){if($.Cmdbuild.dataModel.formFields[t]){var i=$.Cmdbuild.dataModel.getFormFields(t),a=i.fields,r="evaluate"==i.method?this.evaluateFields(a,e):this.addFields(a,e);e.splice(0,e.length);for(var n=0;n<r.length;n++)e.push(r[n])}},evaluateJSONAttributes:function(t,e){if(e){var i="evaluate"==e.method?this.evaluateFields(e.fields,t):this.addFields(e.fields,t);t.splice(0,t.length);for(var a=0;a<i.length;a++)t.push(i[a])}},getFormFields:function(t){return $.Cmdbuild.dataModel.formFields[t]?$.Cmdbuild.dataModel.formFields[t]:void 0},putFormFields:function(t){t.fields?$.Cmdbuild.dataModel.formFields[t.form]=t:delete $.Cmdbuild.dataModel.formFields[t.form]},getCurrentIndex:function(t){return $.Cmdbuild.dataModel.model[t].currentIndex},setCurrentIndex:function(t,e){$.Cmdbuild.dataModel.model[t].currentIndex=e,$.Cmdbuild.dataModel.dispatchChange(t)},setValues:function(t,e){if(!$.Cmdbuild.dataModel.model[t])return{};var i=$.Cmdbuild.dataModel.model[t].currentIndex;return-1==i?{}:void(void 0!==i?$.extend($.Cmdbuild.dataModel.model[t].data[i],e):$.extend($.Cmdbuild.dataModel.model[t].data,e))},getData:function(t){return $.Cmdbuild.dataModel.model[t]&&void 0!==$.Cmdbuild.dataModel.model[t].data?$.Cmdbuild.dataModel.model[t].data:[]},updateData:function(t,e){$.Cmdbuild.dataModel.model[t]&&($.Cmdbuild.dataModel.model[t].data=e)},getMetaData:function(t,e){return $.Cmdbuild.dataModel.model[t]?$.Cmdbuild.dataModel.model[t].metadata[e]:void 0},updateMetaData:function(t,e,i){$.Cmdbuild.dataModel.model[t]&&($.Cmdbuild.dataModel.model[t].metadata[e]=i)},getValues:function(t){if($.Cmdbuild.standard.contextStack.getFormPath({form:t}),!$.Cmdbuild.dataModel.model[t])return"";var e=$.Cmdbuild.dataModel.model[t].currentIndex;return-1==e?"":void 0!==e?$.Cmdbuild.dataModel.model[t].data[e]:$.Cmdbuild.dataModel.model[t].data},getValue:function(t,e){if(!$.Cmdbuild.dataModel.model[t])return"";var i=$.Cmdbuild.dataModel.model[t].currentIndex;return-1==i?"":void 0!==i?$.Cmdbuild.dataModel.model[t].data[i][e]:$.Cmdbuild.dataModel.model[t].data[e]},push:function(t){try{$.Cmdbuild.dataModel.model[t.form]={type:t.type,currentIndex:t.currentIndex,data:t.data,backup:$.Cmdbuild.utilities.clone(t.data),metadata:t.metadata?t.metadata:{}}}catch(e){e.message+="\n$.Cmdbuild.dataModel.push",$.Cmdbuild.errorsManager.log(e)}},flush:function(t,e,i){try{t.data=$.Cmdbuild.dataModel.model[t.form].data,t.formObject.flush(t,function(a){if($.Cmdbuild.dataModel.model[t.form].backup=$.Cmdbuild.utilities.clone($.Cmdbuild.dataModel.model[t.form].data),$.Cmdbuild.dataModel.dispatchChange(t.form),t.successMessage||t.i18nSuccessMessage){var r=t.successMessage;t.i18nSuccessMessage&&(r=$.Cmdbuild.translations.getTranslation(t.i18nSuccessMessage,t.successMessage?t.successMessage:t.i18nSuccessMessage)),$("<div />").html(r).dialog({dialogClass:$.Cmdbuild.global.getThemeCSSClass(),closeText:$.Cmdbuild.translations.getTranslation("cgf_core_dialog_close","Close"),width:300,height:250,buttons:[{text:"OK",click:function(){$(this).dialog("destroy")}}]})}e.apply(i,[a])},this)}catch(a){throw $.Cmdbuild.dataModel.model[t.form].data=$.Cmdbuild.utilities.clone($.Cmdbuild.dataModel.model[t.form].backup),$.Cmdbuild.dataModel.reset(t),$.Cmdbuild.errorsManager.log("$.Cmdbuild.dataModel.flush"),a}},reset:function(t){try{t.data=$.Cmdbuild.dataModel.model[t.form].data,t.formObject.reset(t)}catch(e){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.dataModel.reset"),e}},change:function(t,e){if(void 0===e)return void $.Cmdbuild.errorsManager.popup({name:"dataModel.change",message:"$.Cmdbuild.dataModel.change has been changed. Please check custom code or contact system administrator!"});try{t.data=$.Cmdbuild.dataModel.model[t.form].data,t.formObject.change(t,function(t){t.length?($.Cmdbuild.errorsManager.popupOnRequestFields(t),e.failure&&e.failure.apply(e.scope,[t])):e.success&&e.success.apply(e.scope),e.callback&&e.callback.apply(e.scope)},this)}catch(i){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.dataModel.change"),i}},resolveParametersVariable:function(t){var e=$.Cmdbuild.dataModel.parameters[t],i=$.Cmdbuild.dataModel.resolveVariable(e);return i},resolveInterfaceVariable:function(t){var e=$.Cmdbuild.utilities.getHtmlFieldValue("#"+t);return e},resolveWindowVariable:function(field){return eval("window."+field)},resolveCMDBuildVariable:function(t){return $.Cmdbuild.customvariables[t]},resolveCMDBuildFunctions:function(t){return $.Cmdbuild.customfunctions[t].apply()},resolveModelVariable:function(t,e){var i=$.Cmdbuild.dataModel.getValue(t,e);return i},resolveAnd:function(t){t=$.trim(t),t=t.substr(1),t=t.substr(0,t.length-1);for(var e=t.split(","),i=0;i<e.length;i++)if(!$.Cmdbuild.dataModel.resolveVariable($.trim(e[i])))return!1;return!0},resolveAnd:function(t){t=$.trim(t),t=t.substr(1),t=t.substr(0,t.length-1);for(var e=t.split(","),i=0;i<e.length;i++)if(!$.Cmdbuild.dataModel.resolveVariable($.trim(e[i])))return!1;return!0},resolveOr:function(t){t=$.trim(t),t=t.substr(1),t=t.substr(0,t.length-1);for(var e=t.split(","),i=0;i<e.length;i++)if($.Cmdbuild.dataModel.resolveVariable($.trim(e[i])))return!0;return!1},resolveNot:function(t){return t=$.trim(t),t=t.substr(1),t=t.substr(0,t.length-1),!$.Cmdbuild.dataModel.resolveVariable($.trim(t))},resolveVariable:function(t){var e="";if("$and"==(""+t).substr(0,4))e=$.Cmdbuild.dataModel.resolveAnd(t.substr(4));else if("$or"==(""+t).substr(0,3))e=$.Cmdbuild.dataModel.resolveOr(t.substr(3));else if("$not"==(""+t).substr(0,4))e=$.Cmdbuild.dataModel.resolveNot(t.substr(4));else if("$"==(""+t).substr(0,1)){var i=t.substr(1),a=i.split(".");e=1==a.length?$.Cmdbuild.dataModel.resolveInterfaceVariable(a[0]):"parameters"==a[0]?$.Cmdbuild.dataModel.resolveParametersVariable(a[1]):"window"==a[0]?$.Cmdbuild.dataModel.resolveWindowVariable(a[1]):"cmdbuildvariables"==a[0]?$.Cmdbuild.dataModel.resolveCMDBuildVariable(a[1]):"cmdbuildfunctions"==a[0]?$.Cmdbuild.dataModel.resolveCMDBuildFunctions(a[1]):$.Cmdbuild.dataModel.resolveModelVariable(a[0],a[1])}else e=t;return e},resolveVariables:function(t){var e={};for(var i in t)e[i]=$.Cmdbuild.dataModel.resolveVariable(t[i]);return e},detachObserving:function(){this.observing=!1},attachObserving:function(){this.observing=!0},detachedObserving:function(){return!this.observing},dispatchChange:function(t){if(!$.Cmdbuild.dataModel.detachedObserving())try{var e={};for(var i in $.Cmdbuild.dataModel.observers)for(var a=0;a<$.Cmdbuild.dataModel.observers[i].fields.length;a++){var r=$.Cmdbuild.dataModel.observers[i].fields[a].form;t==r&&(e[i]||(e[i]={},e[i].fields=[],e[i].container=$.Cmdbuild.dataModel.observers[i].container),e[i].fields.push({tag:$.Cmdbuild.dataModel.observers[i].fields[a].tag,variable:"$"+t+"."+$.Cmdbuild.dataModel.observers[i].fields[a].field}))}for(var n in e){var o={};o.form=n,o.container=e[n].container,o.fromObserving="true";for(var a=0;a<e[n].fields.length;a++)o[e[n].fields[a].tag]=e[n].fields[a].variable;$.Cmdbuild.standard.commands.navigate(o)}}catch(l){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.dataModel.setObserver"),l}},setObserver:function(t){var e=[];try{for(var i in t.fields){if("$"!=(""+t.fields[i]).substr(0,1)){var a=$.Cmdbuild.errorsManager.getError({message:$.Cmdbuild.errorsManager.CMERROR,type:$.Cmdbuild.errorsManager.MALFORMEDVARIABLE,element:i,variable:t.fields[i]});throw a}var r=t.fields[i].substr(1),n=r.split(".");e.push({form:n[0],field:n[1],tag:i})}$.Cmdbuild.dataModel.observers[t.form]={},$.Cmdbuild.dataModel.observers[t.form].fields=e,$.Cmdbuild.dataModel.observers[t.form].container=t.container}catch(o){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.dataModel.setObserver"),o}},setAttachmentsForWidget:function(t,e){this.attachments[t]=e.slice()},addAttachmentForWidget:function(t,e){t in this.attachments||(this.attachments[t]=[]),this.attachments[t].push(e)},getAttachmentsForWidget:function(t){return t in this.attachments?this.attachments[t]:[]}};$.Cmdbuild.dataModel=dataModel}(jQuery),function(t){var e={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},i={getBaseUrlCard:function(){return t.Cmdbuild.guiJavaUrlKey+"services/gui/ldapmanager/"},postLdap:function(i,a,r){var n=this.getBaseUrlCard();t.Cmdbuild.authProxy.makeAjaxRequest(n,e.POST,function(t){a.apply(r,[t])},i)}};t.Cmdbuild.utilities.proxyGuiServerSide=i}(jQuery),function(t){var e={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},i={prepareParamsForList:function(t){var e={start:t.start?t.start:0};t.limit&&(e.limit=t.limit);var i=[];return t.sort&&(i.push({property:t.sort,direction:t.direction}),e.sort=JSON.stringify(i)),t.filter?e.filter=JSON.stringify(t.filter):e.filter="{query : ''}",t.active&&(e.active=t.active),t.positionOf&&(e.positionOf=t.positionOf),e},getURIForFileStoreItemDownload:function(e,i,a){return t.Cmdbuild.global.getApiUrl()+"filestores/"+e+"/folders/"+i+"/files/"+a+"/download?CMDBuild-Authorization="+t.Cmdbuild.authentication.getAuthenticationToken()},getURIForGetFunctions:function(){return t.Cmdbuild.global.getApiUrl()+"functions/"},getURIForGetFunctionOutputs:function(e){return t.Cmdbuild.global.getApiUrl()+"functions/"+e+"/outputs/"},getURIForNavigationTrees:function(){return t.Cmdbuild.global.getApiUrl()+"domainTrees/"},getURIForNavigationTree:function(e){return t.Cmdbuild.global.getApiUrl()+"domainTrees/"+e},getURIForReports:function(){return t.Cmdbuild.global.getApiUrl()+"reports/"},getURIForReport:function(e){return t.Cmdbuild.global.getApiUrl()+"reports/"+e},getURIForReportAttributes:function(e){return t.Cmdbuild.global.getApiUrl()+"reports/"+e+"/attributes/"},getURIForReportDownload:function(e,i,a){return t.Cmdbuild.global.getApiUrl()+"reports/"+e+"/download/?CMDBuild-Authorization="+t.Cmdbuild.authentication.getAuthenticationToken()+"&extension="+i+"&parameters="+JSON.stringify(a)},getURIForTemporaryFilters:function(e,i){var a;return"class"===i?a="classes":"process"===i&&(a="processes"),t.Cmdbuild.global.getApiUrl()+a+"/"+e+"/temporary_filters/"},getAttachmentsCategories:function(i,a){var r=t.Cmdbuild.global.getApiUrl()+"configuration/attachments/categories";t.Cmdbuild.authProxy.makeAjaxRequest(r,e.GET,function(t){i.apply(a,[t])})},getClassPrivileges:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"roles/"+i+"/classes_privileges/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t){r.apply(n,[t])})},getClassAttributes:function(i,a,r){var n=t.Cmdbuild.global.getApiUrl()+"classes/"+i+"/attributes";t.Cmdbuild.authProxy.makeAjaxRequest(n,e.GET,function(e){var i=[];t.each(e,function(t,e){e.active&&i.push(e)}),a.apply(r,[i])})},getFilteredCards:function(i,a,r){var n=this.prepareParamsForList(i),o=t.Cmdbuild.global.getApiUrl()+"classes";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){a.apply(r,[t,e])},n)},getCardList:function(i,a,r,n){var o=this.prepareParamsForList(a),l=t.Cmdbuild.global.getApiUrl()+"classes/"+i+"/cards";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t,e){r.apply(n,[t,e])},o)},getRelations:function(i,a,r,n){var o=this.prepareParamsForList(a),l=t.Cmdbuild.global.getApiUrl()+"domains/"+i+"/relations/";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t,e){r.apply(n,[t,e])},o)},getRelation:function(i,a,r,n,o){var l=this.prepareParamsForList(r),s=t.Cmdbuild.global.getApiUrl()+"domains/"+i+"/relations/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t,e){n.apply(o,[t,e])},l)},getDomains:function(i,a,r){var n=this.prepareParamsForList(i),o=t.Cmdbuild.global.getApiUrl()+"domains/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){a.apply(r,[t,e])},n)},getDomain:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"domains/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){a.apply(r,[t,e])},n)},getDomainAttributes:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"domains/"+i+"/attributes";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){a.apply(r,[t,e])},n)},getClass:function(i,a,r){var n={success:function(t,e){a.apply(r,[t,e])},fail:function(t){a.apply(r,[[],[]])}},o=t.Cmdbuild.global.getApiUrl()+"classes/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,n,{})},getClasses:function(i,a){var r=t.Cmdbuild.global.getApiUrl()+"classes/";t.Cmdbuild.authProxy.makeAjaxRequest(r,e.GET,function(t,e){i.apply(a,[t,e])},{})},deleteCard:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"classes/"+i+"/cards/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.DELETE,function(t,e){r.apply(n,[t,e])},{})},getCardData:function(i,a,r,n,o){var l=this.prepareParamsForList(r),s=t.Cmdbuild.global.getApiUrl()+"classes/"+i+"/cards/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t,e){n.apply(o,[t,e])},l)},getCardAttachments:function(i,a,r,n,o){var l=this.prepareParamsForList(r),s=t.Cmdbuild.global.getApiUrl()+"classes/"+i+"/cards/"+a+"/attachments/";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t,e){n.apply(o,[t,e])},l)},getLookupValue:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"lookup_types/"+i+"/values/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t,e){n.apply(o,[t,e])},{})},getLookupType:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"lookup_types/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){r.apply(n,[t,e])},{})},getLookupData:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"lookup_types/"+i+"/values/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){r.apply(n,[t,e])},a)},getStepProcessAttributes:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/activities/"+r+"/";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t){n.apply(o,[t])})},putProcessMail:function(i,a,r,n,o,l){var s=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/emails/"+r;t.Cmdbuild.authProxy.makeAjaxRequest(s,e.PUT,function(t){o.apply(l,[t])},JSON.stringify(n))},deleteProcessMail:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/emails/"+r;t.Cmdbuild.authProxy.makeAjaxRequest(l,e.DELETE,function(t){n.apply(o,[t])},{})},postProcessMail:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/emails/";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.POST,function(t){n.apply(o,[t])},JSON.stringify(r))},getProcessMails:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/emails/";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t,e){r.apply(n,[t,e])},o)},getProcessSingleMail:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/emails/"+r+"/";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t){n.apply(o,[t])})},getProcess:function(i,a,r){var n={success:function(t){a.apply(r,[t])},fail:function(t){a.apply(r,[[]])}},o=t.Cmdbuild.global.getApiUrl()+"processes/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,n)},getProcessAttributes:function(i,a,r){var n=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/attributes";t.Cmdbuild.authProxy.makeAjaxRequest(n,e.GET,function(e){var i=[];t.each(e,function(t,e){e.active&&i.push(e)}),a.apply(r,[i])})},getProcesses:function(i,a){var r=t.Cmdbuild.global.getApiUrl()+"processes/";t.Cmdbuild.authProxy.makeAjaxRequest(r,e.GET,function(t){i.apply(a,[t])})},getProcessStatuses:function(i,a){var r=t.Cmdbuild.global.getApiUrl()+"configuration/processes/statuses/";t.Cmdbuild.authProxy.makeAjaxRequest(r,e.GET,function(t){i.apply(a,[t])})},getStartProcessAttributes:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/start_activities/"+a+"/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t){r.apply(n,[t])})},getStartProcessActivities:function(i,a,r){var n=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/start_activities/";t.Cmdbuild.authProxy.makeAjaxRequest(n,e.GET,function(t){a.apply(r,[t])})},getCardProcess:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t,e){n.apply(o,[t,e])})},getActivity:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/activities/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t){r.apply(n,[t])})},getActivityList:function(i,a,r,n){var o=this.prepareParamsForList(a),l=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t,e){r.apply(n,[t,e])},o)},putSession:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"sessions/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.PUT,function(){},JSON.stringify(a))},getSession:function(i,a,r,n){n||(n=[]);var o=t.Cmdbuild.global.getApiUrl()+"sessions/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){n.push([t,e]),a.apply(r,n)},{})},postNewCard:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"classes/"+i+"/cards/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.POST,function(t){r.apply(n,[t])},JSON.stringify(a))},getSingleProcessInstance:function(i,a,r,n,o,l){var s=this.prepareParamsForList(r),d=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/";t.Cmdbuild.authProxy.makeAjaxRequest(d,e.GET,function(t){o.apply(l,callBackData,[t])},s)},abortProcess:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.DELETE,function(t){n.apply(o,[t])},JSON.stringify(r))},putStepProcess:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/",s={success:function(t){n.apply(o,[t])},fail:function(){var e=t.Cmdbuild.translations.getTranslation("cgf_core_error_title","Error!"),i=t.Cmdbuild.translations.getTranslation("cgf_core_error_content","We're sorry, but there seems to be an error.");t.Cmdbuild.utilities.popupMessage(e,i,"errorDialog",400,400)},callback:null};t.Cmdbuild.authProxy.makeAjaxRequest(l,e.PUT,s,JSON.stringify(r))},postNewProcess:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/",l={success:function(t){r.apply(n,[t])},fail:function(){var e=t.Cmdbuild.translations.getTranslation("cgf_core_error_title","Error!"),i=t.Cmdbuild.translations.getTranslation("cgf_core_error_content","We're sorry, but there seems to be an error.");t.Cmdbuild.utilities.popupMessage(e,i,"errorDialog",400,400)},callback:null};t.Cmdbuild.authProxy.makeAjaxRequest(o,e.POST,l,JSON.stringify(a))},postDomain:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"domains/"+i+"/relations/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.POST,function(t){r.apply(n,[t])},JSON.stringify(a))},putCard:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"classes/"+i+"/cards/"+a+"/";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.PUT,function(t){n.apply(o,[t])},JSON.stringify(r))},putImpersonate:function(i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"sessions/"+i+"/impersonate/"+a+"/",l={success:function(t){r.apply(n,[!0])},fail:function(t){r.apply(n,[!1])}};t.Cmdbuild.authProxy.makeAjaxRequest(o,e.PUT,l)},getReports:function(i,a,r){var n={};i&&i.filter&&(n.filter=JSON.stringify(i.filter)),i&&i.limit&&(n.limit=i.limit),i&&i.start&&(n.start=i.start),i&&i.sort&&(n.sort=JSON.stringify(i.sort)),t.Cmdbuild.authProxy.makeAjaxRequest(this.getURIForReports(),e.GET,function(t,e){a.apply(r,[t,e])},n)},getReportAttributes:function(i,a,r){t.Cmdbuild.authProxy.makeAjaxRequest(this.getURIForReportAttributes(i),e.GET,function(e){var i=[];t.each(e,function(t,e){e.active&&i.push(e)}),a.apply(r,[i])})},getReport:function(i,a,r){t.Cmdbuild.authProxy.makeAjaxRequest(this.getURIForReport(i),e.GET,function(t,e){a.apply(r,[t,e])})},getInstanceAttachment:function(i,a,r,n,o){var l=t.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/attachments/";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t){n.apply(o,[t])},params)},postInstanceAttachment:function(e,i,a,r,n){var o=t.Cmdbuild.global.getApiUrl()+"processes/"+e+"/instances/"+i+"/attachments/",l={success:function(t,e){r.apply(n,[t,e])},fail:function(e){t.Cmdbuild.errorsManager.popup(new Error("The document is just saved")),r.apply(n,[e])}};t.Cmdbuild.authProxy.makeAjaxRequest(o,"POST",l,a,!0)},getCqlResult:function(i,a,r){var n=this.prepareParamsForList(i),o=t.Cmdbuild.global.getApiUrl()+"cql/",l=void 0;l="function"==typeof a?{success:function(t,e){a.apply(r,[t,e])},fail:function(t){a.apply(r,[[],[]])}}:a,t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,l,n)},getIcons:function(i,a,r){var n=this.prepareParamsForList(i),o=t.Cmdbuild.global.getApiUrl()+"icons/",l=void 0;l="function"==typeof a?{success:function(t,e){a.apply(r,[t,e])},fail:function(t){console.log("Error on icons! The sprites cannot be load"),a.apply(r,[[],[]])}}:a,t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,l,n)},getFunctions:function(i,a,r){var n=this.getURIForGetFunctions();t.Cmdbuild.authProxy.makeAjaxRequest(n,e.GET,function(t,e){a.apply(r,[t,e])},i)},getFunctionOutputs:function(i,a,r,n){var o={parameters:JSON.stringify(a)},l=this.getURIForGetFunctionOutputs(i);t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t,e){r.apply(n,[t,e])},o)},postTemporaryFilter:function(i,a,r,n,o){var l=this.getURIForTemporaryFilters(i,a);t.Cmdbuild.authProxy.makeAjaxRequest(l,e.POST,function(t,e){r.apply(n,[t,e])},JSON.stringify(o))},getNavigationTree:function(i,a,r,n){var o=this.getURIForNavigationTree(i);t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){a.apply(r,[t,e])},n)}};t.Cmdbuild.utilities.proxy=i}(jQuery),function(t){var e={arScripts:[],execute:function(){try{for(;this.arScripts.length>0;){var e=this.arScripts[0];this.arScripts.splice(0,1),this.executeScript(e)}}catch(i){throw t.Cmdbuild.errorsManager.log("$.Cmdbuild.scriptsManager.execute "+i.message,i.stack),i}},executeScript:function(e){if(t.Cmdbuild.custom.scripts&&t.Cmdbuild.custom.scripts[e.script])t.Cmdbuild.custom.scripts[e.script](e);else{if(!t.Cmdbuild.standard.scripts[e.script]){var i=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.SCRIPTNOTDEFINED,element:e.id,method:e.type});throw i}t.Cmdbuild.standard.scripts[e.script](e)}},push:function(t){this.arScripts.push(t)}};t.Cmdbuild.scriptsManager=e}(jQuery),function(t){function e(){var t=arguments[0],i=e.cache;return i[t]&&i.hasOwnProperty(t)||(i[t]=e.parse(t)),e.format.call(null,i[t],arguments)}function i(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function a(t,e){return Array(e+1).join(t)}var r={not_string:/[^s]/,number:/[dief]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fiosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};e.format=function(t,n){var o,l,s,d,u,c,m,g=1,f=t.length,p="",b=[],h=!0,C="";for(l=0;f>l;l++)if(p=i(t[l]),"string"===p)b[b.length]=t[l];else if("array"===p){if(d=t[l],d[2])for(o=n[g],s=0;s<d[2].length;s++){if(!o.hasOwnProperty(d[2][s]))throw new Error(e("[sprintf] property '%s' does not exist",d[2][s]));o=o[d[2][s]]}else o=d[1]?n[d[1]]:n[g++];if("function"==i(o)&&(o=o()),r.not_string.test(d[8])&&"number"!=i(o)&&isNaN(o))throw new TypeError(e("[sprintf] expecting number but found %s",i(o)));switch(r.number.test(d[8])&&(h=o>=0),d[8]){case"b":o=o.toString(2);break;case"c":o=String.fromCharCode(o);break;case"d":case"i":o=parseInt(o,10);break;case"e":o=d[7]?o.toExponential(d[7]):o.toExponential();break;case"f":o=d[7]?parseFloat(o).toFixed(d[7]):parseFloat(o);break;case"o":o=o.toString(8);break;case"s":o=(o=String(o))&&d[7]?o.substring(0,d[7]):o;break;case"u":o>>>=0;break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}!r.number.test(d[8])||h&&!d[3]?C="":(C=h?"+":"-",o=o.toString().replace(r.sign,"")),c=d[4]?"0"===d[4]?"0":d[4].charAt(1):" ",m=d[6]-(C+o).length,u=d[6]&&m>0?a(c,m):"",b[b.length]=d[5]?C+o+u:"0"===c?C+u+o:u+C+o}return b.join("")},e.cache={},e.parse=function(t){for(var e=t,i=[],a=[],n=0;e;){if(null!==(i=r.text.exec(e)))a[a.length]=i[0];else if(null!==(i=r.modulo.exec(e)))a[a.length]="%";else{if(null===(i=r.placeholder.exec(e)))throw new SyntaxError("[sprintf] unexpected placeholder");if(i[2]){n|=1;var o=[],l=i[2],s=[];if(null===(s=r.key.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o[o.length]=s[1];""!==(l=l.substring(s[0].length));)if(null!==(s=r.key_access.exec(l)))o[o.length]=s[1];else{if(null===(s=r.index_access.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");o[o.length]=s[1]}i[2]=o}else n|=2;if(3===n)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");a[a.length]=i}e=e.substring(i[0].length)}return a};var n=function(t,i,a){return a=(i||[]).slice(0),a.splice(0,0,t),e.apply(null,a)};"undefined"!=typeof exports?(exports.sprintf=e,exports.vsprintf=n):(t.sprintf=e,t.vsprintf=n,"function"==typeof define&&define.amd&&define(function(){return{sprintf:e,vsprintf:n}}))}("undefined"==typeof window?this:window),function(t){var e="en",i={translations:{},language:null,loadTranslations:function(e,i){return this.language=t.Cmdbuild.global.getLanguage(),this.language?void this.loadCoreTranslations(e,i):(t.Cmdbuild.errorsManager.warn("No language selected"),void e.apply(i,[]))},loadCoreTranslations:function(i,a){var r=this,n=this.language;this.language||(n=e);var o=t.Cmdbuild.global.getAppRootUrl()+"translations/"+n+".json";t.ajax({type:"GET",url:o,cache:!t.Cmdbuild.global.isDebugMode()}).done(function(t,e){"success"===e?r.loadCoreTranslationsCB(t,{callback:i,callbackScope:a}):this.loadValidatorsTranslations(i,a)}).fail(function(){this.language=e,r.loadValidatorsTranslations(i,a),t.Cmdbuild.errorsManager.warn("No core translation file found for language "+r.language.toUpperCase())})},loadCoreTranslationsCB:function(t,e){this.translations=t,this.loadValidatorsTranslations(e.callback,e.callbackScope)},loadValidatorsTranslations:function(e,i){var a=this,r=this.language;this.language||(r="en");var n=t.Cmdbuild.global.getAppRootUrl()+"libraries/plugin/validation/src/localization/messages_"+r+".js";t.ajax({type:"GET",url:n,cache:!t.Cmdbuild.global.isDebugMode()}).always(function(){a.loadConfigTranslations(e,i)})},loadValidatorsTranslationsCB:function(t,e){this.translations=t,this.loadConfigTranslations(e.callback,e.callbackScope)},loadConfigTranslations:function(e,i){var a=this,r=t.Cmdbuild.global.getAppConfigUrl()+"translations/"+this.language+".xml";t.ajax({type:"HEAD",url:r}).done(function(){t.Cmdbuild.utilities.getXmlDoc(r,a.loadConfigTranslationsCB,a,{callback:e,callbackScope:i})}).fail(function(){e.apply(i,[]),t.Cmdbuild.errorsManager.warn("No config translation file found for language "+a.language.toUpperCase())})},loadConfigTranslationsCB:function(e,i){var a=e.documentElement,r=t(a),n=this;t.each(r.children(),function(t,e){
n.translations[e.tagName]=e.textContent}),i.callback.apply(i.callbackScope,[])},getTranslations:function(){return this.translations},getTranslation:function(e,i){if(this.getTranslations()&&this.getTranslations()[e])return this.getTranslations()[e];var a=t.Cmdbuild.global.getLanguage();return a&&t.Cmdbuild.errorsManager.warn("No translation found for label "+e+" into "+a.toUpperCase()+" language file"),i?i:e}};t.Cmdbuild.translations=i}(jQuery),function(t){var e={getXmlDoc:function(e,i,a,r){t.support.cors=!0,t.ajax({type:"GET",url:e,data:{},cache:!1,dataType:"xml",crossDomain:!0}).done(function(t){i.call(a,t,r)}).fail(function(t,e,i){console.log(t,e,i)}).always(function(){})},getLookupIdFromCode:function(e,i,a,r){var n=t.Cmdbuild.global.getApiUrl()+"lookup_types/"+e+"/values/";t.Cmdbuild.authProxy.makeAjaxRequest(n,"GET",function(t,e){for(var n=0;n<t.length;n++)if(t[n].code==i){a.apply(r,[t[n]._id]);break}},{})},removeAllChildren:function(t){for(var e;e=t.lastChild;)t.removeChild(e)},include:function(e,i,a,r){var n="";if(n=e.getAttribute("include"),!n)return void i.apply(r,[a]);var o=e.getAttribute("withId"),l=e.getAttribute("fileType");this.removeAllChildren(e);var s="";s=l&&"core"===l?t.Cmdbuild.global.getAppRootUrl()+"templates/"+n:t.Cmdbuild.global.getAppConfigUrl()+n,this.getXmlDoc(s,this.includeCB,this,{withId:o,xmlElement:e,callback:i,callbackParams:a,callbackScope:r})},includeCB:function(e,i){var a=e.documentElement;if(i.withId){var r=this;t(a).find("*[id]").each(function(){r.updateElementIds(a,this,i.withId)}),this.updateAttributeIds(a,i.withId)}for(var n=0;n<a.childNodes.length;n++)"#text"!=a.childNodes[n].nodeName&&"#comment"!=a.childNodes[n].nodeName&&i.xmlElement.appendChild(a.childNodes[n]);i.callback&&i.callback.apply(i.callbackScope,[i.callbackParams])},updateElementIds:function(e,i,a){var r=t(i).attr("id");t(i).attr("id",a+r);for(var n=0;n<t.Cmdbuild.global.ID_TAGS.length;n++){var o=t.Cmdbuild.global.ID_TAGS[n];t(e).find(o+":contains("+r+")").each(function(){var e=t(this).text();if("$"==e.substr(0,1)&&t.trim(e.substr(1))==r){t(this).text("$"+a+r);var i=e.split(".");i.length>1&&t(this).text(t(this).text()+i[1])}else if("$"==e.substr(0,1)){var i=e.split(".");t.trim(i[0].substr(1))==r&&i.length>1&&t(this).text("$"+a+r+"."+i[1])}else if(t.trim(e)==r)t(this).text(a+r);else{var i=e.split(".");i.length>1&&t.trim(i[n])==r&&t(this).text(i[0]+"."+a+r)}})}},updateAttributeIds:function(e,i){for(var a=0;a<t.Cmdbuild.global.ID_TAGSWITHVARIABLEATTRIBUTES.length;a++){var r=t.Cmdbuild.global.ID_TAGSWITHVARIABLEATTRIBUTES[a][0],n=t.Cmdbuild.global.ID_TAGSWITHVARIABLEATTRIBUTES[a][1];t(e).find(r).each(function(){var e=t(this).attr(n);t(this).attr(n,i+e)})}},getBackend:function(e){var i=t.Cmdbuild.utilities.getPathObject(e,t.Cmdbuild.custom.backend);if(i||(i=t.Cmdbuild.utilities.getPathObject(e,t.Cmdbuild.standard.backend)),!i){var a=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.BACKENDMETHODNOTDEFINED,element:e});throw a}return i},getPathObject:function(t,e){if(!t)return null;for(var i=t.split("."),a=0;a<i.length;a++){if(!e[i[a]])return null;e=e[i[a]]}return e},formatVarString:function(){var t=[].slice.call(arguments);"[object Object]"!=this.toString()&&t.unshift(this.toString());var e=new RegExp("{([1-"+t.length+"])}","g");return String(t[0]).replace(e,function(e,i){return t[i]})},getFieldDescription:function(e,i,a,r){if("reference"==e.type)t.Cmdbuild.utilities.proxy.getCardData(e.targetClass,i,{},function(t,e){a.apply(r,[t.Description])},this);else if("lookup"==e.type)t.Cmdbuild.utilities.proxy.getLookupValue(e.lookupType,i,{},function(t,e){a.apply(r,[t.description])},this);else if("decimal"==e.type)try{a.apply(r,[i.toFixed(e.scale)])}catch(n){a.apply(r,[void 0])}else a.apply(r,[void 0])},getHtmlFieldValue:function(e){var i=t(e);if(i){if("SELECT"==i.prop("tagName")){var a=i.val();return a}if(i.attr("isDate")){var a=i.val(),r=i.attr("date-input-type");return a=t.Cmdbuild.utilities.convertDateGUI2DB(a,r)}if("spinner"==i.attr("valueType")){var a=i.spinner("value");return a}return"checkbox"==i.attr("type")?i.prop("checked")?!0:!1:i.val()}return null},convertDateGUI2DB:function(t,e){if("date"==e&&t){var i=t.split("/");return 3==i.length?t=i[2]+"-"+i[1]+"-"+i[0]+"T00:00:00":""}if("time"==e&&t)return"1970-01-01T"+t;if("dateTime"==e&&t){var a=t.split(" ");return 2===a.length?(i=a[0].split("/"),t=i[2]+"-"+i[1]+"-"+i[0]+"T"+a[1]):t.replace("/","-")}return t},convertDateDB2GUI:function(t,e){if(!t)return"";if("date"==e){var i=t.split("T");return i=i[0].split("-"),3==i.length&&(t=i[2]+"/"+i[1]+"/"+i[0]),t}if("time"==e){var i=t.split("T");return i[1]}return"dateTime"==e?this.convertDateDB2GUI(t,"date")+" "+this.convertDateDB2GUI(t,"time"):t},getHtmlFieldInteractivity:function(e){var i=t(e);return i&&i.attr("interactivity")?i.attr("interactivity"):null},setAttributesInteractivity:function(e){for(var i=0;i<e.length;i++)e[i].interactivity=t.Cmdbuild.global.fieldInteractivityFromCard(e[i].isnotnull)},currentMenu:function(e,i){t("#"+i+" .ui-menu-item.selected").removeClass("selected"),t("#"+e).addClass("selected")},getEventLikeString:function(e,i,a){var r="";otherCommand=""|a;var n=t.Cmdbuild.elementsManager.getEvent(i,e);return n?r=" "+i+"='$.Cmdbuild.eventsManager.onEvent("+JSON.stringify(n)+");"+a+"' ":""},clone:function(t){return JSON.parse(JSON.stringify(t))},escapeHtml:function(t){if(!t)return"";var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","/":"/"},i=String(t).replace(/[&<>"'\/]/g,function(t){return e[t]});return i},removeAttribute:function(t,e){for(var i=0;i<t.length;i++)if(t[i].name==e){t.splice(i,1);break}return t},changeAttributeType:function(t,e,i){for(var a=0;a<t.length;a++)if(t[a].name==e){t[a].type=i;break}return t},sortAttributes:function(t){t.sort(function(t,e){return t.index-e.index})},insertOtherGroup:function(t,e){for(var i=!1,a=0;a<t.length;a++)if(t[a].group){i=!0;break}if(i)for(var a=0;a<t.length;a++)t[a].group||(t[a].group="Others");return t},startApplication:function(){var e=this;t.Cmdbuild.utilities.proxy.getClasses(function(i){t.Cmdbuild.dataModel.setClasses(i),t.Cmdbuild.utilities.proxy.getProcesses(function(i){t.Cmdbuild.dataModel.setProcesses(i),t.Cmdbuild.custom.commands&&t.Cmdbuild.custom.commands.initialize?t.Cmdbuild.custom.commands.initialize(e.startApplicationCallBack):e.startApplicationCallBack()},e)},e)},startApplicationCallBack:function(){t.Cmdbuild.global.getHtmlContainer().innerHTML="";var e=t.Cmdbuild.global.getConfigurationDocument().documentElement,i=t.Cmdbuild.elementsManager.insertChildren(e);t(t.Cmdbuild.global.getHtmlContainer()).attr("class",t.Cmdbuild.global.getThemeCSSClass()),t.Cmdbuild.global.getHtmlContainer().innerHTML=i,t.Cmdbuild.elementsManager.initialize(),t(document).tooltip()},getFields:function(e){var i=t(e),a=i.find("fields");if(a.length){var r={},n=t(a[0]),o=n.children("form").text();r.form=o;var l=n.children("method").text();if(r.method=l,0==n.children("field").length)return r;r.fields={};for(var s=0;s<n.children("field").length;s++){var d=t(n.children("field")[s]),u=d.children("name").text(),c={};if(u){for(var m=d.children("attributes"),g=0;g<m.children("attribute").length;g++){var f=t(m.children("attribute")[g]),p=f.children("name").text(),b=f.children("value").text();p&&(c[p]=b)}r.fields[u]=c}}return r}},getFormFields:function(e){var i=t(e),a=i.find("formFields");if(a.length){var r={},n=t(a[0]),o=n.children("form").text();if(r.form=o,0==n.children("field").length)return r;r.fields={};for(var l=0;l<n.children("field").length;l++){var s=t(n.children("field")[l]),d=s.children("name").text(),u={};if(d){for(var c=s.children("attributes"),m=0;m<c.children("attribute").length;m++){var g=t(c.children("attribute")[m]),f=g.children("name").text(),p=g.children("value").text();f&&(u[f]=p)}r.fields[d]=u}}return r}},addFields:function(){},getToday:function(){var t=new Date,e=t.getDate(),i=t.getMonth()+1,a=t.getFullYear();return e+"/"+i+"/"+a},getConditionsFromParam:function(e){var i=[];if(e.condition)for(var a=e.condition.split(","),r=0;r<a.length;r++){var n=a[r].split("="),o={field:n[0],value:t.Cmdbuild.dataModel.resolveVariable(n[1])};i.push(o)}return i},getAttributesFilterFromConditions:function(t){if(0!=t.length){for(var e={},i=[],a=0;a<t.length;a++){var r={simple:{attribute:t[a].field,operator:"equal",value:[t[a].value],parameterType:"fixed"}};i.push(r)}return e=1==t.length?i[0]:{and:i}}},getWidgetsFromXML:function(e){var i=[],a=t(e),r=a.children("widgets");return r.length&&0!=r.children("widget").length?(t.each(r.children("widget"),function(e,a){var r={};t.each(t(a).children(),function(t,e){r[e.nodeName]=e.textContent}),i.push({_id:r.id,active:r.active,label:r.label,required:r.required,type:r.type,data:r})}),i):void 0},getButtonsFromXML:function(e){var i="",a=t.grep(e.childNodes,function(t,e){return"buttons"===t.nodeName});if(a.length){var r=t.grep(a[0].childNodes,function(t,e){return"button"===t.nodeName}),n=r.length>0;n&&(i+='<div class="formButtons">'),t.each(r,function(e,a){i+=t.Cmdbuild.elementsManager.toHtml(a)}),n&&(i+="</div>")}return i},popupMessage:function(e,i,a,r,n,o){t("<div />").attr("id",a).html(i).dialog({title:e,dialogClass:t.Cmdbuild.global.getThemeCSSClass(),closeText:t.Cmdbuild.translations.getTranslation("cgf_core_dialog_close","Close"),width:r,height:n,buttons:[{text:"OK",click:function(){t(this).dialog("close")}}],close:function(e,i){return o&&o.apply(),t(this).dialog("destroy"),!1}})},showConfirmPopup:function(e,i,a,r,n,o,l){t("<div />").attr("id",a).html(i).dialog({title:e,dialogClass:t.Cmdbuild.global.getThemeCSSClass(),closeText:t.Cmdbuild.translations.getTranslation("cgf_core_dialog_close","Close"),width:o,height:l,buttons:[r,n],close:function(e,i){return n.click&&n.click.apply(),t(this).dialog("destroy"),!1}})},uniqueId:function(){return Math.round((new Date).getTime()+100*Math.random())},readCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),a=0;a<i.length;a++){for(var r=i[a];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(e))return r.substring(e.length,r.length)}return null},attributesSorter:function(t,e){return t.index<e.index?-1:t.index>e.index?1:0},getFormValidatorObject:function(){return{onsubmit:!1,ignore:"input:hidden",rules:{},messages:{},errorPlacement:function(t,e){t.insertBefore(e),e.parents("dl").addClass("cmdbuildGuiFormFieldError")},success:function(t){t.parents("dl").removeClass("cmdbuildGuiFormFieldError")}}},htmlencode:function(t){return t?t.replace(/[&<>"']/g,function(t){return"&"+{"&":"amp","<":"lt",">":"gt",'"':"quot","'":"#39"}[t]+";"}):""},plain2html:function(e){var i=t.Cmdbuild.utilities.htmlencode(e);return(i+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},getClassDescription:function(e){var i=t.grep(t.Cmdbuild.dataModel.classes,function(t){return t._id==e});return i.length?i[0].description:e},getProcessDescription:function(e){var i=t.grep(t.Cmdbuild.dataModel.processes,function(t){return t._id==e});return i.length?i[0].description:e},getReportsOverrides:function(e){var i={},a=t(e),r=a.find("reports");return t.each(r.children("report"),function(e,a){var r=t(a);i[r.attr("name")]={extension:t.Cmdbuild.dataModel.resolveVariable(r.attr("extension")),attributes:{}};var n=i[r.attr("name")].attributes;t.each(r.children("attribute"),function(e,i){var a=t(i),r=n[a.attr("name")]={};t.each(a.children("property"),function(e,i){var a=i.getAttribute("name"),n=i.getAttribute("value");r[a]=t.Cmdbuild.dataModel.resolveVariable(n)})})}),i}};t.Cmdbuild.utilities=t.extend(t.Cmdbuild.utilities,e)}(jQuery);
//# sourceMappingURL=core.min.js.map