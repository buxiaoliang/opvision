!function(t){var i=function(i,a,e){this.param=i,this.type=i.className,this.processInstanceId=i.cardId,this.processActivityId=i.activityInstanceId,this.data=[],this.metadata={},this.widgets=void 0;var a=a,e=e;this.updateData=function(i,a){for(var e={},s=0;s<this.attributes.length;s++)e[this.attributes[s]._id]=i.data[this.attributes[s]._id];e._advance="true"==i.advance,e._activity=this.processActivityId[0],t.Cmdbuild.utilities.proxy.putStepProcess(this.type,this.processInstanceId,e,a,this)},this.init=function(){this.loadAttributes()},this.loadAttributes=function(){this.attributes=[{type:"title",name:"title"},{type:"paragraph",name:"help"}],this.loadData(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.data.activityTitle=this.activityTitle,this.metadata=i,s()},this.loadData=function(){t.Cmdbuild.utilities.proxy.getCardData(this.type,this.param.cardId,{},this.loadDataCallback,this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var s=function(){a.apply(e)};this.init()};t.Cmdbuild.standard.backend.ActivityHelp=i}(jQuery),function(t){function i(i){var a=t(i),e=a.find("noActivityFields");if(e.length){var s={};return 0==e.children("field").length?s:(s.attributes=[],t.each(e.children("field"),function(i,a){var e=t(a).children("name").text();s.attributes.push(e)}),s)}}var a="activityTitle",e={type:"title",displayableInList:!1,active:!0,name:a,index:-1},s=function(a,s,r){"Activity"!==a.backend&&t.Cmdbuild.errorsManager.warn(a.backend+" backend is deprecated. Please use Activity backend."),this.config=null,this.hasActivity=null,this.newInstance=null,this.activityId=null,this.writable=!1,this.activityTitle=null,this.processAttributes=[],this.attributes=[],this.widgets=[],this.data={},this.widgetsData=[];var s=s,r=r;this.init=function(){this.config=a,this.hasActivity=!0,this.newInstance=void 0===this.config.cardId,this.loadAttributes()},this.loadAttributes=function(){if(!this.config.className){var i="No _type specified for form: "+this.config.form;return t.Cmdbuild.errorsManager.warn(i),void(this.attributes=[])}t.Cmdbuild.utilities.proxy.getProcessAttributes(this.config.className,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){this.processAttributes=i,this.originalAttributes=i.slice(),this.newInstance?t.Cmdbuild.utilities.proxy.getStartProcessActivities(this.config.className,this.onActivitiesLoaded,this):this.config.cardId?this.config.activityInstanceId?(this.activityId=this.config.activityInstanceId,this.loadActivity()):this.config.displayFirstAvailableActivity&&"true"==this.config.displayFirstAvailableActivity?t.Cmdbuild.utilities.proxy.getActivity(this.config.className,this.config.cardId,this.onActivitiesLoaded,this):this.loadNoActivityAttributes():n()},this.onActivitiesLoaded=function(t){t.length?(this.activityId=t[0]._id,this.loadActivity()):this.loadNoActivityAttributes()},this.loadActivity=function(){this.newInstance?t.Cmdbuild.utilities.proxy.getStartProcessAttributes(this.config.className,this.activityId,this.onActivityLoaded,this):t.Cmdbuild.utilities.proxy.getStepProcessAttributes(this.config.className,this.config.cardId,this.activityId,this.onActivityLoaded,this)},this.onActivityLoaded=function(i){var a=this,s=[];this.activityTitle=i.description,this.writable=i.writable,this.config.showActivityTitle&&s.push(e),t.each(i.attributes,function(i,e){var r=t.grep(a.processAttributes,function(t){return e._id===t._id});if(r.length){var n=t.extend({},r[0],e);s.push(n)}}),t.Cmdbuild.utilities.changeAttributeType(s,"Notes","text"),this.setAttributes(s),this.setWidgets(i.widgets),this.loadData()},this.loadNoActivityAttributes=function(){var a=this;this.hasActivity=!1;var e=t.Cmdbuild.dataModel.forms[this.config.form],s=i(e.xmlForm);s&&s.attributes&&s.attributes.length?(this.attributes=[],t.each(s.attributes,function(i,e){var s=t.grep(a.processAttributes,function(t){return e===t.name});if(s.length){var r=t.extend({},s[0]);a.attributes.push(r)}})):this.attributes=this.processAttributes.slice(),this.loadData()},this.loadData=function(){if(this.newInstance){var i={};t.each(this.attributes,function(t,a){i[a._id]=null}),i.writable=this.writable,this.loadDataCallback(i,{})}else t.Cmdbuild.utilities.proxy.getCardProcess(this.config.className,this.config.cardId,{},this.loadDataCallback,this)},this.loadDataCallback=function(i,a){var e=this;this.data=t.extend(i,{activityTitle:e.activityTitle,advanceEnabled:e.hasActivity,readOnly:!e.hasActivity,writable:e.writable}),this.metadata=a,n()},this.updateData=function(i,a){function e(i){t.Cmdbuild.widgets.savePostponedWidgets(r.widgets,r.widgetsData,{type:r.config.className,id:i._id},r.config.form,function(){s(i)},r)}function s(e){"true"===i.advance||i.advance===!0?t.Cmdbuild.utilities.proxy.getActivity(r.config.className,r.config.cardId,function(i){var s={_advance:!0,_activity:i[0]._id};t.Cmdbuild.utilities.proxy.putStepProcess(e._type,e._id,s,function(t){a(e)},r)},r):a(e)}var r=this,n={};t.each(this.attributes,function(t,a){n[a._id]=i.data[a._id]}),n=t.extend(n,{_advance:!1,_activity:r.activityId}),t.Cmdbuild.widgets.getWidgetsData(i.form,this.widgets,function(i){r.widgetsData=i,t.Cmdbuild.widgets.saveOnDataWidgets(n,r.widgetsData),r.newInstance?t.Cmdbuild.utilities.proxy.postNewProcess(r.config.className,n,function(i){r.config.cardId=i,t.Cmdbuild.utilities.proxy.getCardProcess(r.config.className,i,{},function(t,i){e(t)})},this):t.Cmdbuild.utilities.proxy.putStepProcess(r.config.className,r.config.cardId,n,function(i){t.Cmdbuild.utilities.proxy.getCardProcess(r.config.className,r.config.cardId,{},function(t,i){e(t)})},this)},this)},this.isReadOnly=function(){return!(this.writable===!0||"true"===this.writable||this.newInstance)},this.deleteMail=function(t){for(var i=0;i<this.data.mails.length;i++){var a=this.data.mails[i];a._id===t.cardId&&this.data.mails.splice(i,1)}},this.getAttributes=function(){return this.attributes},this.getOriginalAttributes=function(){return this.originalAttributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata},this.getWidgets=function(){return this.widgets},this.setAttributes=function(i){i.sort(t.Cmdbuild.utilities.attributesSorter),this.attributes=i.slice()},this.setWidgets=function(t){this.widgets=t.slice()};var n=function(){s.apply(r)};this.init()};t.Cmdbuild.standard.backend.Activity=s,t.Cmdbuild.standard.backend.NewActivity=s}(jQuery),function(t){var i=function(i,a,e){this.type=i.className,this.data=[],this.metadata={},this.listData=[],this.typeFilter="attribute",this.conditions=t.Cmdbuild.utilities.getConditionsFromParam(i),this.positionOf=i.positionOf,this.positions={},this.defaultSort=i.sort,this.defaultDirection=i.direction,this.disableMultipleActivities="true"===i.disableMultipleActivities||i.disableMultipleActivities===!0,i.noUser||this.conditions.push({field:i.paramUser,value:i.user}),this.cqlfilter=i.cqlFilter,this.cqlfilterFn=i.cqlFilterFn,this.filter={},this.setFilter=function(i){var a=this.filter.CQL,e=this.conditions.slice();i.flowStatus&&void 0!==i.flowStatus&&e.push({field:"_status",value:i.flowStatus});var s=t.Cmdbuild.utilities.getAttributesFilterFromConditions(e);this.filter.attribute=s,this.cqlfilter?(this.filter.CQL=this.cqlfilter,this.noValidFilter=!1):this.cqlfilterFn?(this.noValidFilter=!1,this.filter.CQL=this.cqlfilterFn.apply()):this.filter.CQL=a},this.updateFilter=function(){this.cqlfilterFn&&(this.filter.CQL=this.cqlfilterFn.apply())},this.getStatus=function(){return this.flowStatus};var a=a,e=e;this.deleteRow=function(i,a){var e=t.Cmdbuild.dataModel.getValues(i.form);t.Cmdbuild.utilities.proxy.abortProcess(e._type,e._id,{},function(t){a(t)},this)},this.init=function(){t.Cmdbuild.utilities.proxy.getProcessStatuses(function(a){this.flowStatuses=a,t.Cmdbuild.utilities.proxy.getProcess(this.type,function(t){i.flowStatus?this.setFilter({flowStatus:t.defaultStatus}):this.setFilter({}),this.loadAttributes()},this)},this)},this.loadAttributes=function(){if(!this.type){var a="No _type specified for form: "+i.form;return void t.Cmdbuild.errorsManager.warn(a)}t.Cmdbuild.utilities.proxy.getProcessAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(t){this.attributes=t,this.positionOf?this.loadPositions():s()},this.loadPositions=function(){var t=this;this.updateFilter();var i={sort:this.defaultSort,direction:this.defaultDirection||"ASC",positionOf:this.positionOf,filter:this.filter};this.makeAjaxRequest(i,function(i,a){t.positions=a.positions,t.data=[],t.metadata={},s()},this)},this.loadData=function(t,i,a){if(this.data=[],this.noValidFilter)return void i.apply(a,this.data);this.updateFilter();var e={page:t.currentPage,start:t.firstRow,limit:t.nRows,sort:t.sort,direction:t.direction,filter:this.filter,active:!0};this.makeAjaxRequest(e,function(t,e){this.data=[],this.listData=t,this.metadata=e,this.expandData(0,[],i,a)},this)},this.makeAjaxRequest=function(i,a,e){t.Cmdbuild.utilities.proxy.getActivityList(this.type,i,function(t,i){a.apply(e,[t,i])},this)},this.expandData=function(i,a,e,s){if(this.listData.length<=i)return this.data=a,void e.apply(s,this.data);var r=this.listData[i];t.Cmdbuild.utilities.proxy.getActivity(r._type,r._id,function(n){if(0==n.length)r.writable=!1,a.push(r);else if(this.disableMultipleActivities)r.writable=n[0].writable,a.push(r);else for(var d=0;d<n.length;d++){var o=t.Cmdbuild.utilities.clone(r);o.ActivityInstanceId=n[d]._id,o.activityTitle=n[d].description,o.writable=n[d].writable,a.push(o)}this.expandData(i+1,a,e,s)},this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var s=function(){a.apply(e)};this.getStatus=function(){return this.flowStatus},this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.ActivityList=i}(jQuery),function(t){var i=[{type:"string",name:"_description",description:"Descrizione",displayableInList:!0,active:!0},{type:"string",name:"_name",description:"Nome file",displayableInList:!0,active:!0},{type:"string",name:"_author",description:"Autore",displayableInList:!0,active:!0},{type:"string",name:"_category",description:"Categoria",displayableInList:!0,active:!0},{type:"string",name:"_version",description:"Versione",displayableInList:!0,active:!0}],a=function(a,e,s){this.param=a,this.type=a.className,this.procId=a.cardId,this.data=[],this.metadata={},this.attributes=[];var e=e,s=s;this.init=function(){this.loadAttributes()},this.loadAttributes=function(){this.attributes=i.slice(),setTimeout(function(){r()},500)},this.loadData=function(i,a,e){var s={page:i.currentPage,start:i.firstRow,limit:i.nRows,sort:i.sort,direction:i.direction,filter:this.filter},r=function(t,i){this.data=t,this.metadata=i,a.apply(e,this.data)};t.Cmdbuild.dataModel.isAClass(this.type)?t.Cmdbuild.utilities.proxy.getCardAttachments(this.type,this.procId,s,r,this):t.Cmdbuild.dataModel.isAProcess(this.type)&&t.Cmdbuild.utilities.proxy.getInstanceAttachment(this.type,this.procId,s,r,this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var r=function(){e.apply(s)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.Attachments=a,t.Cmdbuild.standard.backend.ProcessAttachments=function(){t.Cmdbuild.errorsManager.error("ProcessAttachments backend was removed. Please use Attachments backend.")}}(jQuery),function(t){var i=function(i,a,e){this.param=i,this.type=i.className,this.data=[],this.metadata={};var a=a,e=e;this.init=function(){this.loadAttributes()},this.newData=function(i,a){for(var e={},s=0;s<this.attributes.length;s++)e[this.attributes[s]._id]=i.data[this.attributes[s]._id];t.Cmdbuild.utilities.proxy.postNewCard(this.type,e,a,this)},this.updateData=function(i,a){var e={};if(!this.data._id)return void this.newData(i,a);for(var s=0;s<this.attributes.length;s++)e[this.attributes[s]._id]=i.data[this.attributes[s]._id];t.Cmdbuild.utilities.proxy.putCard(this.type,this.data._id,e,a,this)},this.loadAttributes=function(){if(!this.type){var a="No _type specified for form: "+i.form;return t.Cmdbuild.errorsManager.warn(a),void(this.attributes=[])}t.Cmdbuild.utilities.proxy.getClassAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){this.originalAttributes=i.slice(),"true"!=this.param.withNotes?this.attributes=t.Cmdbuild.utilities.removeAttribute(i,"Notes"):this.attributes=i,t.Cmdbuild.utilities.sortAttributes(i),t.Cmdbuild.utilities.changeAttributeType(this.attributes,"Notes","text"),this.loadData(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.metadata=i,s()},this.loadData=function(){if(this.param.cardId)t.Cmdbuild.utilities.proxy.getCardData(this.type,this.param.cardId,{},this.loadDataCallback,this);else{for(var i=0;i<this.attributes.length;i++)this.data[this.attributes[i]._id]="";this.metadata={},s()}},this.getAttributes=function(){return this.attributes?this.attributes:[]},this.getData=function(){return this.data?this.data:[]},this.getMetadata=function(){return this.metadata},this.getOriginalAttributes=function(){return this.originalAttributes};var s=function(){a.apply(e)};this.init()};t.Cmdbuild.standard.backend.Card=i}(jQuery),function(t){var i=function(i,a,e){this.type=i.className,this.data=[],this.metadata={},this.filter={},this.positionOf=i.positionOf,this.positions={},this.defaultSort=i.sort,this.defaultDirection=i.direction,this.conditions=t.Cmdbuild.utilities.getConditionsFromParam(i),this.filter={},this.cqlFilter=i.cqlFilter,this.cqlFilterFn=i.cqlFilterFn,this.updateFilter=function(){var i=this.filter.query,a=this.filter.CQL;this.filter={};var e=t.Cmdbuild.utilities.getAttributesFilterFromConditions(this.conditions);e&&(this.filter.attribute=e),i&&(this.filter.query=i),this.cqlFilter?(this.filter.CQL=this.cqlFilter,this.noValidFilter=!1):this.cqlFilterFn?(this.filter.CQL=this.cqlFilterFn.apply(),this.noValidFilter=!1):this.filter.CQL=a},i.widgetId;var a=a,e=e;this.init=function(){this.loadAttributes()},this.deleteRow=function(i,a,e){var s=t.Cmdbuild.dataModel.getValues(i.form);t.Cmdbuild.utilities.proxy.deleteCard(s._type,s._id,function(){a.apply(e,[])},this)},this.loadAttributes=function(){if(!this.type){var a="No _type specified for form: "+i.form;return t.Cmdbuild.errorsManager.warn(a),void(this.attributes=[])}t.Cmdbuild.utilities.proxy.getClassAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){this.attributes=i,this.attributes.sort(t.Cmdbuild.utilities.attributesSorter),this.positionOf?this.loadPositions():s()},this.loadPositions=function(){var t=this;this.updateFilter();var i={sort:this.defaultSort,direction:this.defaultDirection||"ASC",positionOf:this.positionOf,filter:this.filter};this.makeAjaxRequest(i,function(){t.positions=t.metadata.positions,t.data=[],t.metadata={},s()},this)},this.loadData=function(t,i,a){if(this.noValidFilter)return this.data=[],void i.apply(a,this.data);this.updateFilter();var e={page:t.currentPage,start:t.firstRow,limit:t.nRows,sort:t.sort,direction:t.direction,filter:this.filter};this.makeAjaxRequest(e,i,a)},this.makeAjaxRequest=function(i,a,e){t.Cmdbuild.utilities.proxy.getCardList(this.type,i,function(t,i){this.data=t,this.metadata=i,a.apply(e,this.data)},this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var s=function(){a.apply(e)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.CardList=i}(jQuery),function(t){var i=function(t,i,a){this.param=t,this.type=t.processName,this.data=[],this.metadata={};var i=i,a=a;this.init=function(){this.data=[{_id:"Hour_1",description:"1 Hour"},{_id:"Hour_2",description:"2 Hours"},{_id:"Hour_4",description:"4 Hours"},{_id:"Day_1",description:"1 Day"},{_id:"Day_2",description:"2 Days"},{_id:"Day_4",description:"4 Days"}],setTimeout(e,100)},this.getData=function(){return this.data},this.getValue=function(){return this.flowStatus},this.getMetadata=function(){return this.metadata};var e=function(){i.apply(a)};this.init()};t.Cmdbuild.standard.backend.DelayTable=i}(jQuery),function(t){var i=function(i,a,e){this.param=i,this.type=i.lookupName,this.data=[],this.metadata={};var a=a,e=e;this.init=function(){this.loadAttributes(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.metadata=i,s()},this.loadAttributes=function(){this.loadData()},this.loadData=function(i,a){t.Cmdbuild.utilities.proxy.getAttachmentsCategories(this.loadDataCallback,this)},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var s=function(){a.apply(e)};this.init()};t.Cmdbuild.standard.backend.DmsCategory=i}(jQuery),function(t){var i=function(i,a,e){this.type=i.destinationClass,this.data=[],this.listData=[],this.metadata={},this.param=i;var a=a,e=e;this.conditions=t.Cmdbuild.utilities.getConditionsFromParam(i);var s=t.Cmdbuild.utilities.getAttributesFilterFromConditions(this.conditions);this.filter={},s&&(this.filter.attribute=s),i.sourceId=""+i.sourceId;for(var r=i.sourceId.split(","),n=[],d=0;d<r.length;d++)n.push({className:i.sourceClass,id:t.trim(r[d])});this.filter.relation=[{domain:i.domainName,source:i.destinationClass,destination:i.sourceClass,type:"oneof",direction:"_2"==i.domainDirection?"_1":"_2",cards:n}],this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getClassAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(t){this.attributes=t,o()},this.loadData=function(i,a,e){if(this.noValidFilter)return this.data=[],void a.apply(e,this.data);var s={page:i.currentPage,start:i.firstRow,limit:i.nRows,sort:i.sort,direction:i.direction,filter:this.filter};this.data=[],t.Cmdbuild.utilities.proxy.getCardList(this.type,s,function(t,i){this.data=t,this.metadata=i,a.apply(e,this.data)},this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var o=function(){a.apply(e)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.DomainList=i}(jQuery),function(t){var i=function(i,a,e){this.type=i.destinationClass,this.data=[],this.listData=[],this.metadata={};var a=a,e=e;if(this.conditions=[],i.condition)for(var s=i.condition.split(","),r=0;r<s.length;r++){var n=s[r].split("="),d={field:n[0],value:n[1]};this.conditions.push(d)}this.conditions=t.Cmdbuild.utilities.getConditionsFromParam(i);var o=t.Cmdbuild.utilities.getAttributesFilterFromConditions(this.conditions);this.filter={},o&&(this.filter.attribute=o),this.filter.relation=[{domain:i.domainName,source:i.destinationClass,destination:i.sourceClass,type:"oneof",direction:"_2"==i.domainDirection?"_1":"_2",cards:[{className:i.sourceClass,id:i.sourceId}]}],this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getClassAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(t){this.attributes=t,u()},this.loadData=function(i,a,e){if(this.noValidFilter)return this.data=[],void a.apply(e,this.data);var s={page:i.currentPage,start:i.firstRow,limit:i.nRows,sort:i.sort,direction:i.direction,filter:this.filter,filterType:this.typeFilter};this.data=[],t.Cmdbuild.utilities.proxy.getActivityList(this.type,s,function(t,i){this.listData=t,this.metadata=i,this.expandData(a,e)},this)},this.expandData=function(i,a){if(0==this.listData.length)return void i.apply(a,this.data);var e=this.listData[0];this.listData.splice(0,1),t.Cmdbuild.utilities.proxy.getActivity(e._type,e._id,function(s){if(0==s.length)this.data.push(e);else for(var r=0;r<s.length;r++){var n=t.Cmdbuild.utilities.clone(e);n.ActivityInstanceId=s[r]._id,n.activityTitle=s[r].description,this.data.push(n)}this.expandData(i,a)},this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var u=function(){a.apply(e)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.DomainListOnProcesses=i}(jQuery),function(t){var i=function(i,a,e){this.param=i,this.type=i.className,this.processInstanceId=void 0,this.data=[],this.metadata={};var a=a,e=e;this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getProcessAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){t.Cmdbuild.utilities.proxy.getStartProcessActivities(this.type,this.processInstanceId,function(i){if(i.length>0){this.description=i[0].description;var a=i[0]._id;t.Cmdbuild.utilities.proxy.getStartProcessAttributes(this.type,a,function(t){this.instructions=t.instructions,this.attributes=[{type:"title",name:"title"},{type:"paragraph",name:"help"}],this.loadData(this.param)},this)}},this)},this.loadData=function(){this.data={title:this.description,help:this.instructions},s()},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data};var s=function(){a.apply(e)};this.init()};t.Cmdbuild.standard.backend.HelpNewActivity=i}(jQuery),function(t){var i=function(i,a,e){this.param=i,this.type=i.lookupName,this.data=[],this.metadata={};var a=a,e=e;this.init=function(){this.loadAttributes(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.metadata=i,s()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getLookupType(this.type,{},this.loadData,this)},this.loadData=function(i,a){t.Cmdbuild.utilities.proxy.getLookupData(this.type,{},this.loadDataCallback,this)},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var s=function(){a.apply(e)};this.init()};t.Cmdbuild.standard.backend.Lookup=i}(jQuery),function(t){var i=function(i,a,e){this.param=i,this.type=i.className,this.searchCard=function(t){var i=this.innerSearchCard(t);return"reply"==this.param.mailStatus?this.composeReplyMail(i):"new"==this.param.mailStatus?this.composeNewMail(i):i},this.composeReplyMail=function(i){return{_id:"newmail_"+t.Cmdbuild.utilities.uniqueId(),account:"default",to:i.from,from:i.to,body:i.from+"wrote: </br>"+i.body,subject:"R: "+i.subject}},this.composeNewMail=function(i){return{_id:"newmail_"+t.Cmdbuild.utilities.uniqueId(),account:"default",to:"",from:"default",body:"-----------",subject:"........."}},this.innerSearchCard=function(i){for(var a=t.Cmdbuild.dataModel.forms[this.param.formData],e=a.getBackendData().mails,s=0;s<e.length;s++){var r=e[s];if(r._id===i){var n=[];switch(r.status){case t.Cmdbuild.global.MAILSTATUSDRAFT:n=r.fromTemplate?["keepSynchronization","delay","account","from","to","bcc","subject","body"]:["delay","account","from","to","bcc","subject","body"];break;default:n=["account","from","to","bcc","subject","body"]}return this.loadAttributes(n,this.possibleAttributes),r}}},this.updateData=function(i,a,e){var s={};s._id=i.data._id;for(var r=0;r<this.attributes.length;r++)s[this.attributes[r].name]=i.data[this.attributes[r].name];if("reply"==this.param.mailStatus||"new"==this.param.mailStatus){var n=t.Cmdbuild.dataModel.forms[this.param.formData];s.status=t.Cmdbuild.global.MAILSTATUSDRAFT,n.getBackendData().mails.push(s)}a&&a.apply(e,[])},this.possibleAttributes=[{_id:"keepSynchronization",type:"boolean",name:"keepSynchronization",description:"keepSynchronization",writable:!0},{_id:"delay",type:"select",name:"delay",description:"Delay",backend:"DelayTable",writable:!0},{_id:"account",type:"string",name:"account",description:"Account",writable:!0},{_id:"from",type:"string",name:"from",description:"From",writable:!0},{_id:"to",type:"string",name:"to",description:"To",writable:!0},{_id:"bcc",type:"string",name:"bcc",description:"Bcc",writable:!0},{_id:"subject",type:"string",name:"subject",description:"Subject",writable:!0},{_id:"body",type:"text",name:"body",description:"Body",writable:!0,editorType:"HTML"}],this.replyTable={account:"to",body:"body",subject:"subject"};var a=a,e=e;this.init=function(){this.loadData()},this.loadData=function(){this.data=this.searchCard(this.param.cardId),setTimeout(s,100)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata},this.loadAttributes=function(t,i){this.attributes=[];for(var a=0;a<t.length;a++)for(var e=0;e<i.length;e++)if(t[a]==i[e].name){this.attributes.push(i[e]);break}};var s=function(){a.apply(e)};this.init()};t.Cmdbuild.standard.backend.Mail=i}(jQuery),function(t){var i=function(i,a,e){this.param=i,this.data=[],this.metadata={};var a=a,e=e;this.init=function(){this.loadAttributes(this.param)},this.loadAttributes=function(){this.attributes=[{type:"string",name:"status",description:"Status",displayableInList:!0},{type:"string",name:"to",description:"Addresses",displayableInList:!0},{type:"text",name:"subject",description:"Subject",displayableInList:!0}];var t=this;this.TM=setTimeout(function(){s(),clearTimeout(t.TM)},500)},this.loadData=function(i,a,e){var s=t.Cmdbuild.dataModel.forms[this.param.formData],r=s.getBackendData().mails;if("true"===this.param.onlyTemplates){this.data=[];for(var n=0;n<r.length;n++)r[n].fromTemplate&&this.data.push(r[n])}else this.data=r;this.data.sort(function(t,i){return t.status>=i.status?1:-1}),a.apply(e)},this.disableRowButtons=function(i){switch(this.data[i].status){case t.Cmdbuild.global.MAILSTATUSDRAFT:return this.data[i].fromTemplate?[]:[t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREGENERATE];case t.Cmdbuild.global.MAILSTATUSNEW:return[];case t.Cmdbuild.global.MAILSTATUSOUTGOING:return[t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREGENERATE,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREPLY];case t.Cmdbuild.global.MAILSTATUSRECEIVED:return[t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREGENERATE,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONMODIFY,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONDELETE];default:return[t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREGENERATE,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREPLY,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONMODIFY,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONDELETE]}},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata},this.getTotalRows=function(){return this.getData().length};var s=function(){a.apply(e)};this.init()};t.Cmdbuild.standard.backend.MailList=i}(jQuery),function(t){var i="title",a="_extension",e={_id:a,name:a,description:t.Cmdbuild.translations.getTranslation("cgf_label_report_extension","Extension"),index:-1,active:!0,hidden:!1,mandatory:!0,type:"select",options:[{value:"pdf",label:"PDF"},{value:"odt",label:"ODT"},{value:"rtf",label:"RTF"},{value:"csv",label:"CSV"}],defaultValue:null,writable:!0},s=function(a,s,r){function n(){s.apply(r)}this.attributes=[],this.reportId=null,this.reportName=null,this.reportDescription=null;var s=s,r=r;this.init=function(){this.reportName=a.name,this.reportId=a.id;var e=this;this.reportId?t.Cmdbuild.utilities.proxy.getReport(e.reportId,function(t,i){t?(e.reportName=t.name,e.reportDescription=t.description,this.loadAttributes()):n()},e):this.reportName?t.Cmdbuild.utilities.proxy.getReports({filter:{attribute:{simple:{attribute:i,operator:"equal",value:[e.reportName]}}}},function(t,i){t.length?(e.reportId=t[0]._id,e.reportDescription=t[0].description,this.loadAttributes()):n()},e):n()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getReportAttributes(this.reportId,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){i.push(t.extend({},e)),this.attributes=i,this.attributes.sort(t.Cmdbuild.utilities.attributesSorter),n()},this.getAttributes=function(){return this.attributes},this.getReportId=function(){return this.reportId},this.getReportDescription=function(){return this.reportDescription},this.init()};t.Cmdbuild.standard.backend.OpenReport=s}(jQuery),function(t){var i=function(i,a,e){this.param=i,this.type=i.className,this.processInstanceId=i.cardId,this.data=[],this.metadata={},this.widgets=void 0;var a=a,e=e;this.updateData=function(t,i){},this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getProcessAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(t){this.attributes=t,this.loadData(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.data.activityTitle=this.activityTitle,this.metadata=i,s()},this.loadData=function(){t.Cmdbuild.utilities.proxy.getCardProcess(this.type,this.param.cardId,{},this.loadDataCallback,this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var s=function(){a.apply(e)};this.init()};t.Cmdbuild.standard.backend.Process=i}(jQuery),function(t){var i=function(i,a,e){this.type=i.className,this.data=[],this.metadata={},this.listData=[],this.typeFilter="attribute",this.filter={},this.filter.attribute={simple:{attribute:"_status",operator:"in",value:[t.Cmdbuild.global.PROCESS_STARTED]}};var a=a,e=e;this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getProcessAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(t){this.attributes=t,s()},this.loadData=function(i,a,e){if(this.noValidFilter)return this.data=[],void a.apply(e,this.data);var s={page:i.currentPage,start:i.firstRow,limit:i.nRows,sort:i.sort,direction:i.direction,filter:this.filter,active:!0,filterType:this.typeFilter};t.Cmdbuild.utilities.proxy.getActivityList(this.type,s,function(t,i){this.data=t,this.metadata=i,a.apply(e,this.data)},this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var s=function(){a.apply(e)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.ReferenceActivityList=i}(jQuery),function(t){var i=function(i,a,e){this.param=i,this.type=i.className,this.data=[],this.metadata={};var a=a,e=e;this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getReportAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){t.Cmdbuild.utilities.sortAttributes(i),this.attributes=i,s()},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var s=function(){a.apply(e)};this.init()};t.Cmdbuild.standard.backend.Report=i}(jQuery),function(t){var i=function(i,a,e){function s(){a.apply(e)}this.data=[],this.metadata={};var a=a,e=e;this.init=function(){setTimeout(s,500)},this.loadData=function(i,a,e){var s=this,r={limit:i.limit,start:i.start,sort:i.sort};i.searchTherm&&(r.filter={query:i.searchTherm}),t.Cmdbuild.utilities.proxy.getReports(r,function(t,i){s.data=t,s.metadata=i,a.apply(e,[t,i])},s)},this.getData=function(){return this.data},this.getReportInfo=function(i,a,e){t.Cmdbuild.utilities.proxy.getReport(i,a,e)},this.getMetadata=function(){return this.metadata},this.init()};t.Cmdbuild.standard.backend.Reports=i}(jQuery),function(t){var i=function(i,a,e){this.param=i,this.type=i.processName,this.data=[],this.metadata={};var a=a,e=e;this.init=function(){t.Cmdbuild.utilities.proxy.getProcessStatuses(function(i){
this.data=i,t.Cmdbuild.utilities.proxy.getProcess(this.type,function(t){this.flowStatus=t.defaultStatus,s()},this)},this)},this.getData=function(){return this.data},this.getValue=function(){return this.flowStatus},this.getMetadata=function(){return this.metadata};var s=function(){a.apply(e)};this.init()};t.Cmdbuild.standard.backend.Select=i}(jQuery),function(t){var i=[{type:"string",name:"document",description:"Documento"},{type:"string",name:"description",description:"Descrizione"},{type:"string",name:"category",description:"Category"}],a=function(a,e,s){this.type=a.className,this.data=[],this.attributes=[],s.backend=this;var e=e,s=s;this.init=function(){this.loadAttributes()},this.loadAttributes=function(){for(var t=0;t<i.length;t++)this.attributes.push({type:i[t].type,displayableInList:!0,active:!0,name:i[t].name,description:i[t].description});r()},this.loadData=function(i,a,e){var s=t.Cmdbuild.dataModel.getAttachmentsForWidget(i.form).slice();s?this.data=s:this.data=[],a.apply(e,this.data)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var r=function(){e.apply(s)};this.getTotalRows=function(){return this.getData().length},this.deleteRow=function(i){var a=t.Cmdbuild.dataModel.getCurrentIndex(i.form);this.data.splice(a,1),t.Cmdbuild.dataModel.setAttachmentsForWidget(i.form,this.data),t.Cmdbuild.standard.grid.onNavigate("begin",i.form)},this.addRow=function(i){this.data.splice(0,0,i.row),t.Cmdbuild.dataModel.setAttachmentsForWidget(i.form,this.data),t.Cmdbuild.standard.grid.onNavigate("begin",i.form)},this.init()};t.Cmdbuild.standard.backend.AttachmentsWidget=a}(jQuery),function(t){function i(i,a){for(var i=t.Cmdbuild.dataModel.forms[i],e=i.getBackendWidgets(),s=0;s<e.length;){if(e[s]._id===a)return e[s].data;s++}return null}function a(i){var a={};return t.each(i,function(t,i){a[i.name]=null}),a}function e(i,a){var e=-1;return t.each(i,function(t,i){i[a]>e&&(e=i[a])}),e}function s(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(var a in t)if(t[a]!==i[a])return!1;return!0}var r="fn_properties",n=function(n,d,o){this.widgetConfig={},this.data=[],this.metadata={},this.instanceForm=null,this.widgetId=null,this.formname=null,this.fromGrid=null,this._fnvariables=[],this._fnvariablesresolved={},this._maxid=null,this.extraproperties={ID:"__id__",COMMANDS:"__commands__"},this.refreshtypes={FIRST_TIME:"firstTime",EVERY_TIME:"everyTime"};var d=d,o=o;this.init=function(){this.instanceForm=n.instanceForm,this.widgetId=n.widgetId,this.recordId=n.recordId,this.fromGrid="true"===n.fromGrid||n.fromGrid===!0,this.formname=t.Cmdbuild.widgets.CustomForm.formName(this.instanceForm,{_id:this.widgetId}),this.widgetConfig=i(this.instanceForm,this.widgetId),this.loadAttributes()},this.loadAttributes=function(){var i=t.parseJSON(this.widgetConfig.model);t.each(i,function(t,i){i._id=i.name}),this.loadAttributesCallback(i)},this.loadAttributesCallback=function(i){this.attributes=i,this.attributes.sort(t.Cmdbuild.utilities.attributesSorter),this.loadData()},this.loadData=function(){function i(){n.setData(d),n._maxid=e(d,n.extraproperties.ID),setTimeout(u,500)}function a(){if(n._maxid=-1,t.Cmdbuild.dataModel.updateData(n.formname,[]),n.setData([]),n.getWidgetConfig().data){var i=t.parseJSON(n.getWidgetConfig().data);t.each(i,function(t,i){n.addRecord(i)}),setTimeout(u,500)}else n.getWidgetConfig().functionData?n.resolveFnVariables(function(){n.loadFnData()},n):setTimeout(u,500)}var n=this,d=t.Cmdbuild.dataModel.getData(this.formname),o=this.getWidgetConfig().capabilities.refreshBehaviour;if(this._fnvariables=[],t.each(n.getWidgetConfig().variables,function(t,i){n._fnvariables.push({key:t,value:i})}),null===d)a();else if(o===this.refreshtypes.FIRST_TIME)i();else{var l=t.Cmdbuild.dataModel.getMetaData(this.formname,r);this.resolveFnVariables(function(){!l||!l&&t.isEmptyObject(n._fnvariablesresolved)||s(l,n._fnvariablesresolved)?i():a()},this)}},this.resolveFnVariables=function(i,a){var e=this;if(this._fnvariables.length){var s=this._fnvariables.splice(0,1)[0];cqlEvaluate({form:e.instanceForm,filter:s.value},function(r){r&&(r=r.trim(),r===t.Cmdbuild.global.CQLUNDEFINEDVALUE&&(r=null)),e._fnvariablesresolved[s.key]=r,e.resolveFnVariables(i,a)},e)}else t.Cmdbuild.dataModel.updateMetaData(this.formname,r,e._fnvariablesresolved),i.apply(a)},this.loadFnData=function(){var i=this;t.Cmdbuild.utilities.proxy.getFunctions({},function(a,e){var s=t.grep(a,function(t,a){return t.name===i.getWidgetConfig().functionData});if(s.length){var r=s[0];t.Cmdbuild.utilities.proxy.getFunctionOutputs(r._id,i._fnvariablesresolved,function(a,e){t.each(a,function(t,a){i.addRecord(a)}),u()},i)}else u()},this)},this.updateData=function(i){this.setData(i),t.Cmdbuild.dataModel.updateData(this.formname,i),t.Cmdbuild.dataModel.updateMetaData(this.formname,t.Cmdbuild.widgets.CustomForm.METADATA_HASDATA,i.length>0)},this.addRecord=function(i){var e=this,s=function(){var t={};return t[e.extraproperties.COMMANDS]=null,t[e.extraproperties.ID]=++e._maxid,t},r=t.extend({},a(this.getAttributes()),i,s()),n=this.getRawData().slice();return n.push(r),this.updateData(n),r},this.removeRecord=function(i){var a=this,e=this.getRawData().slice(),s=[];t.each(e,function(t,e){e[a.extraproperties.ID]!==i&&s.push(e)}),this.updateData(s),this.removeRowErrors(i)},this.addEmptyRecord=function(){var t=a({}),i=this.addRecord(t);return this.validateNewRecord(i),i},this.cloneRecord=function(i){var a=this,e=t.grep(this.getRawData(),function(t){return t[a.extraproperties.ID]==i});if(e.length){var s=this.addRecord(e[0]);return this.validateClonedRecord(i,s[a.extraproperties.ID]),s}return null},this.updateRecordProperty=function(i,a,e){var s=this,r=this.getRawData().slice(),n=t.grep(r,function(t){return t[s.extraproperties.ID]==i});if(n.length){var d=n[0];d[a]=e,this.updateData(r)}},this.getAllErrors=function(){return t.Cmdbuild.dataModel.getMetaData(this.formname,t.Cmdbuild.widgets.CustomForm.METADATA_ERRORS)},this.updateErrors=function(i){t.Cmdbuild.dataModel.updateMetaData(this.formname,t.Cmdbuild.widgets.CustomForm.METADATA_ERRORS,i)},this.removeRowErrors=function(i){var a=t.grep(this.getAllErrors(),function(t){return t.id!==i});this.updateErrors(a)},this.updateAttributeErrors=function(i,a,e){var s=t.grep(this.getAllErrors(),function(t){return!(t.id===i&&t.attribute===a)});t.each(e,function(t,e){e.id=i,e.attribute=a,s.push(e)}),this.updateErrors(s)},this.validateNewRecord=function(i){var a=this;t.each(this.getAttributes(),function(e,s){s.mandatory&&!i[s.name]&&a.updateAttributeErrors(i[a.extraproperties.ID],s.name,[{field:s.description,message:t.validator.messages.required}])})},this.validateClonedRecord=function(i,a){var e=this,s=t.grep(this.getAllErrors(),function(t){return t.id===i});t.each(s,function(t,i){e.updateAttributeErrors(a,i.attribute,[{field:i.field,message:i.message}])})},this.getFieldErrors=function(i,a){return t.grep(this.getAllErrors(),function(t){return t.id===i&&t.attribute===a})},this.getAttributes=function(){return this.attributes},this.getData=function(){return"form"===this.getWidgetConfig().layout?this.data.length?this.data[0]:{}:this.isFromGrid()&&void 0!==this.recordId&this.recordId<this.data.length?this.data[this.recordId]:this.data},this.getRawData=function(){return this.data},this.getMetadata=function(){return this.metadata},this.getWidgetConfig=function(){return this.widgetConfig},this.isFromGrid=function(){return this.fromGrid},this.setData=function(t){this.data=t.slice()};var u=function(){d.apply(o)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getRawData().length},this.init()};t.Cmdbuild.standard.backend.CustomFormWidget=n}(jQuery),function(t){var i=".CustomForm",a=function(t,i){return t.index<i.index?-1:t.index>i.index?1:0},e=function(t,i){return t+"_"+i},s=function(s,r,n){var d=new t.Cmdbuild.standard.backend.Activity(s,r,n);d.allAttributes=void 0,d.cfwAttributes=void 0,d.allData=void 0,d.cfwData=void 0,d.getAttributes=function(){if(this.allAttributes)return this.allAttributes;var i=this.attributes;i.sort(a);var e=t.merge(i,o());return this.allAttributes=e,e},d.getData=function(){if(this.allData)return this.allData;var i={};return t.extend(i,this.data,u()),this.allData=i,i},d.extractWidgetAttributes=function(i,a){var s=[];a=a?a:0;var r=i.data;if(r.model){var n=JSON.parse(r.model),o=d.param.readOnly;o=o||r.capabilities.readOnly,o=o||r.capabilities.modifyDisabled,o=o||r.capabilities.addDisabled,t.each(n,function(r,n){n.originalName=n.name,n.name=e(i._id,n.name),n.index+=a,n.group=i.label,(o||!n.writable)&&(n.interactivity=t.Cmdbuild.global.READ_ONLY),s.push(n)})}return s};var o=function(){if(d.cfwAttributes)return d.cfwAttributes;var e=[];return d.widgets&&t.each(d.widgets,function(t,a){var s=e.length;a.type===i&&a.active&&"form"===a.data.layout&&(e=e.concat(d.extractWidgetAttributes(a,s)))}),e.sort(a),d.cfwAttributes=e,e},u=function(){if(d.cfwData)return d.cfwData;var a={};return d.widgets&&t.each(d.widgets,function(e,s){if(s.type===i&&s.active&&"form"===s.data.layout){var r=s.data,n={};if(r.data){var o=JSON.parse(r.data);n=o[0]}t.each(d.cfwAttributes,function(t,i){a[i.name]=n[i.originalName]})}}),d.cfwData=a,a};return d};t.Cmdbuild.standard.backend.InstanceAndCustomFormWidgets=s}(jQuery),function(t){function i(i,a){for(var i=t.Cmdbuild.dataModel.forms[i],e=i.getBackendWidgets(),s=0;s<e.length;){if(e[s]._id===a)return e[s].data;s++}return null}function a(i){return t.Cmdbuild.dataModel.isAClass(i)?"class":t.Cmdbuild.dataModel.isAProcess(i)?"process":void 0}function e(t,i){var a,e;return t.target.name===t.domain.source?(a="_1",e=t.domain.destination):(a="_2",e=t.domain.source),[{domain:t.domain._id,type:"oneof",destination:e,source:t.target.name,direction:a,cards:[{className:e,id:i}]}]}function s(t){return{simple:{attribute:"Id",operator:"in",value:t}}}var r=function(r,n,d){function o(){n.apply(d)}function u(i,e){function s(t,s){var r={_id:t._id,parent:t.parent,recursionEnabled:t.metadata.recursionEnabled,target:{name:t.metadata.targetClass,type:a(t.metadata.targetClass),filter:t.metadata.filter}};s&&(r.domain={_id:s._id,source:s.source,destination:s.destination,descriptionDirect:s.descriptionDirect,descriptionInverse:s.descriptionInverse}),e.nodes.push(r),u(i,e)}if(!i.length)return void o();var r=i.splice(0,1)[0];r.metadata.domain?t.Cmdbuild.utilities.proxy.getDomain(r.metadata.domain,function(t,i){s(r,t)},e):s(r,null)}this.instanceForm=null,this.widgetId=null,this.widgetConfig=null,this.description=null,this.nodes=[],this.init=function(){this.instanceForm=r.instanceForm,this.widgetId=r.widgetId,this.formname=t.Cmdbuild.widgets.NavigationTree.formName(this.instanceForm,{_id:this.widgetId}),this.widgetConfig=i(this.instanceForm,this.widgetId),t.Cmdbuild.CqlManager.compile(this.instanceForm,t.Cmdbuild.dataModel.forms[this.instanceForm].getBackendAttributes()),this.loadTree()},this.loadTree=function(){var i=this;t.Cmdbuild.utilities.proxy.getNavigationTree(this.widgetConfig.navigationTreeName,function(t,a){i.description=t.description,u(t.nodes,this)},i)},this.getTreeDescription=function(){return this.description},this.getTreeNodes=function(){return this.nodes},this.getRootNode=function(){var i=this,a=t.grep(i.nodes,function(t){return null===t.parent});return a.length?a[0]:void 0},this.getChildrenNodes=function(i){var a=this,e=t.grep(a.nodes,function(t){return t.parent==i});return e},this.getNodeItems=function(i,a,r,n){function d(d){var o={},l={name:"tempfilter",description:"tempfilter"};a&&i.domain&&(o.relation=e(i,a)),d&&d.length&&(o.attribute=s(d)),l.configuration=JSON.stringify(o),t.Cmdbuild.utilities.proxy.postTemporaryFilter(i.target.name,i.target.type,function(a){var e={filter:{_temporaryId:a._id}};"class"===i.target.type?t.Cmdbuild.utilities.proxy.getCardList(i.target.name,e,r,n):"process"===i.target.type&&t.Cmdbuild.utilities.proxy.getActivityList(i.target.name,e,r,n)},u,l)}function o(i){var a=[];t.each(i,function(t,i){a.push(i._id)}),d(a)}var u=this;i.target.filter&&i.target.filter.text?cqlEvaluate({form:u.instanceForm,filter:i.target.filter.text},function(a){a&&(a=a.trim(),a===t.Cmdbuild.global.CQLUNDEFINEDVALUE&&(a=null));var e={};e.filter={CQL:a},"class"===i.target.type?t.Cmdbuild.utilities.proxy.getCardList(i.target.name,e,o,u):"process"===i.target.type&&t.Cmdbuild.utilities.proxy.getActivityList(i.target.name,e,o,u)},u):d()},this.addRemoveSelection=function(i,a){var e=this.getSelectedItems(),s=t.grep(e,function(t){return t.cardId==i});if(s.length){var r=[];t.each(e,function(t,a){!a.cardId==i&&r.push(a)}),e=r}else e.push({cardId:i,className:a});this.setSelectedItems(e)},this.isSelected=function(i){var a=this.getSelectedItems(),e=t.grep(a,function(t){return t.cardId==i});return e.length>0},this.getSelectedItems=function(){return t.Cmdbuild.dataModel.getData(this.formname)},this.setSelectedItems=function(i){t.Cmdbuild.dataModel.updateData(this.formname,i)},this.init()};t.Cmdbuild.standard.backend.NavigationTreeWidget=r}(jQuery);
//# sourceMappingURL=backends.min.js.map