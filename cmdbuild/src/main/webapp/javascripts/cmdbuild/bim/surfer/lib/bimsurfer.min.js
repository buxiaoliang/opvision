function removeA(t){for(var e,i,r=arguments,n=r.length;n>1&&t.length;)for(e=r[--n];-1!==(i=t.indexOf(e));)t.splice(i,1);return t}function GeometryLoader(t,e,i,r){var n=this;n.models=e,n.bimServerApi=t,n.viewer=i,n.state={},n.progressListeners=[],n.objectAddedListeners=[],n.prepareReceived=!1,n.todo=[],n.type=r,null==n.type&&(n.type="triangles"),n.stats={nrPrimitives:0,nrVertices:0,nrNormals:0,nrColors:0},n.dataToInfo={},n.loadedGeometry={},n.infoToOid={},this.addProgressListener=function(t){n.progressListeners.push(t)},this.readObject=function(t,e){if(t.align8(),5==e){var i=t.readLong(),r=t.readLong(),a=(t.readDoubleArray(6),t.readDoubleArray(16)),s=[l=t.readLong()];if(0==n.state.mode)return void console.log("Mode is still 0, should be 1");var o=n.infoToOid[r];null==o?console.log("Not found",r):n.models[i].get(o,function(t){if(t.gid=r,null==n.viewer.scene.findNode(r)){var e=BIMSURFER.Constants.materials[t.getType()],i=!1;null==e&&(console.log("material not found",t.getType()),e=BIMSURFER.Constants.materials.DEFAULT),e.a<1&&(i=!0);var s=0==t.trans.mode,c=null,h=n.loadedGeometry[l];null!=h?Array.isArray(h)?(c=[],h.forEach(function(t){c.push({type:"geometry",coreId:t})})):c=[{type:"geometry",coreId:l}]:null==n.dataToInfo[l]?n.dataToInfo[l]=[r]:n.dataToInfo[l].push(r);var u={type:"flags",flags:{transparent:i},nodes:[{type:"enable",enabled:s,nodes:[{type:"material",baseColor:e,alpha:1},{type:"material",baseColor:e,alpha:e.a,nodes:[{type:"name",id:r,data:{object:t},nodes:[{type:"matrix",elements:a,nodes:c}]}]}]}]};n.modelNode.addNode(u),n.objectAddedListeners.forEach(function(t){t(o)})}else console.log("Node with id "+r+" already existed")})}else if(3==e){for(var s=[],l=t.readLong(),c=t.readInt(),h=0;h<c;h++){var u=t.readLong()+1;s.push(u);f=t.readInt();n.stats.nrPrimitives+=f/3;v=t.readShortArray(f);t.align4();U=t.readInt();n.stats.nrVertices+=U;var g=t.readFloatArray(U),M=t.readInt();n.stats.nrNormals+=M;var d=t.readFloatArray(M),R=t.readInt();n.stats.nrColors+=R;S=t.readFloatArray(R);(m={type:"geometry",primitive:n.type}).coreId=u,"lines"==n.type?m.indices=n.convertToLines(v):m.indices=v,m.positions=g,m.normals=d,null!=S&&S.length>0&&(m.colors=S),n.library.add("node",m)}n.loadedGeometry[l]=s,null!=n.dataToInfo[l]&&(n.dataToInfo[l].forEach(function(t){var e=n.viewer.scene.findNode(t);null!=e&&null!=e.nodes[0]&&s.forEach(function(t){e.nodes[0].addNode({type:"geometry",coreId:t})})}),delete n.dataToInfo[l])}else if(1==e){var l=t.readLong(),f=t.readInt(),v=t.readShortArray(f);n.stats.nrPrimitives+=f/3,t.align4();var U=t.readInt(),g=t.readFloatArray(U);n.stats.nrVertices+=U;M=t.readInt();n.stats.nrNormals+=M;var d=t.readFloatArray(M),R=t.readInt();n.stats.nrColors+=R;var S=t.readFloatArray(R),m={type:"geometry",primitive:n.type};m.coreId=l,"lines"==n.type?m.indices=n.convertToLines(v):m.indices=v,m.positions=g,m.normals=d,null!=S&&S.length>0&&(m.colors=S),n.library.add("node",m),n.loadedGeometry[l]=!0,null!=n.dataToInfo[l]&&(n.dataToInfo[l].forEach(function(t){var e=n.viewer.scene.findNode(t);null!=e&&null!=e.nodes[0]&&e.nodes[0].addNode({type:"geometry",coreId:l})}),delete n.dataToInfo[l])}n.state.nrObjectsRead++},this.convertToLines=function(t){for(var e=[],i=0;i<t.length;i+=3){var r=t[i],n=t[i+1],a=t[i+2];e.push(r,n),e.push(n,a),e.push(a,r)}return e},this.updateProgress=function(){n.progressListeners.forEach(function(t){t("Loading",-1)})},this.downloadInitiated=function(){n.state={mode:0,nrObjectsRead:0,nrObjects:0},n.library=n.viewer.scene.findNode("library-"+n.groupId),null==n.library&&(n.library=n.viewer.scene.addNode({id:"library-"+n.groupId,type:"library"}));var t={topicId:n.topicId};n.bimServerApi.setBinaryDataListener(n.topicId,n.binaryDataListener),n.bimServerApi.downloadViaWebsocket(t)},this.binaryDataListener=function(t){n.todo.push(t)},this.readEnd=function(t){if(Object.keys(n.dataToInfo).length>0){console.error("Unsolved links");for(var e in n.dataToInfo)console.log(e,n.dataToInfo[e])}console.log(n.stats),n.viewer.SYSTEM.events.trigger("progressDone"),n.progressListeners.forEach(function(t){t("done",n.state.nrObjectsRead,n.state.nrObjectsRead)}),n.bimServerApi.call("ServiceInterface","cleanupLongAction",{topicId:n.topicId},function(){})},this.readStart=function(t){var e=t.readUTF8();if("BGS"!=e)return console.log("Stream does not start with BGS ("+e+")"),!1;var i=t.readByte();if(10!=i)return console.log("Unimplemented version"),!1;n.state.version=i,t.align8();var r=t.readDoubleArray(6);n.modelBounds={min:{x:r[0],y:r[1],z:r[2]},max:{x:r[3],y:r[4],z:r[5]}},n.center={x:(n.modelBounds.max.x+n.modelBounds.min.x)/2,y:(n.modelBounds.max.y+n.modelBounds.min.y)/2,z:(n.modelBounds.max.z+n.modelBounds.min.z)/2},n.boundsTranslate=n.viewer.scene.findNode("bounds_translate");a=!1;if(null==n.boundsTranslate){var a=!0;n.boundsTranslate={id:"bounds_translate",type:"translate",x:-n.center.x,y:-n.center.y,z:-n.center.z,nodes:[]},n.boundsTranslate=n.viewer.scene.findNode("my-lights").addNode(n.boundsTranslate)}if(n.modelNode=n.viewer.scene.findNode("model_node_"+n.groupId),null==n.modelNode&&(n.modelNode={id:"model_node_"+n.groupId,type:"translate",x:0,y:0,z:0,data:{groupId:n.groupId},nodes:[]},n.modelNode=n.boundsTranslate.addNode(n.modelNode)),a){var s=n.viewer.scene.findNode("main-lookAt"),o={x:.5*(n.modelBounds.max.x-n.modelBounds.min.x),y:-1*(n.modelBounds.max.y-n.modelBounds.min.y),z:.5*(n.modelBounds.max.z-n.modelBounds.min.z)};s.set("eye",o);var l=n.viewer.scene.findNode("main-camera"),c=5*Math.sqrt(Math.pow(n.modelBounds.max.x-n.modelBounds.min.x,2)+Math.pow(n.modelBounds.max.y-n.modelBounds.min.y,2)+Math.pow(n.modelBounds.max.z-n.modelBounds.min.z,2));l.setOptics({type:"perspective",far:c,near:c/1e3,aspect:jQuery(n.viewer.canvas).width()/jQuery(n.viewer.canvas).height(),fovy:37.8493}),n.viewer.events.trigger("sceneLoaded",[n.viewer.scene])}n.state.mode=1},this.process=function(){for(var t=n.todo.shift();null!=t;){inputStream=new BIMSURFER.DataInputStreamReader(null,t);inputStream.readLong();var e=inputStream.readByte();0==e?n.readStart(inputStream):6==e?n.readEnd(inputStream):n.readObject(inputStream,e),t=n.todo.shift()}},this.progressHandler=function(t,e){t==n.topicId&&("Done preparing"==e.title&&(n.prepareReceived||(n.prepareReceived=!0,n.downloadInitiated())),"FINISHED"==e.state&&n.bimServerApi.unregisterProgressHandler(n.topicId,n.progressHandler),n.progressListeners.forEach(function(t){t("Loading"+(null==n.options.title?"":" "+n.options.title)+"...",e.progress)}))},this.setTitle=function(t){n.options.title=t},this.setLoadOids=function(t,e){n.options={type:"oids",roids:t,oids:e}},this.start=function(){if(null!=n.options){n.groupId=n.options.roids[0],n.infoToOid={};var t=[];if(n.options.oids.forEach(function(e){null!=e.gid&&(n.infoToOid[e.gid]=e.oid,t.push(e.gid))}),t.length>0){var e={type:"GeometryInfo",oids:t,include:{type:"GeometryInfo",field:"data"}};n.bimServerApi.getSerializerByPluginClassName("org.bimserver.serializers.binarygeometry.BinaryGeometryMessagingStreamingSerializerPlugin3",function(t){n.bimServerApi.call("ServiceInterface","download",{roids:n.options.roids,serializerOid:t.oid,sync:!1,query:JSON.stringify(e)},function(t){n.topicId=t,n.bimServerApi.registerProgressHandler(n.topicId,n.progressHandler)})})}}}}function StringView(t,e,i,r){var n,a,s,o,l,c,h=isFinite(i)?i:0,u=15;e&&(this.encoding=e.toString());t:switch(this.encoding){case"UTF-8":o=StringView.putUTF8CharCode,l=StringView.getUTF8CharLength,n=Uint8Array;break t;case"UTF-16":o=StringView.putUTF16CharCode,l=StringView.getUTF16CharLength,n=Uint16Array;break t;case"UTF-32":n=Uint32Array,u&=14;break t;default:n=Uint8Array,u&=14}t:switch(typeof t){case"string":u&=7;break t;case"object":switch(t.constructor){case StringView:u&=3;break t;case String:u&=7;break t;case ArrayBuffer:a=new n(t),c="UTF-32"===this.encoding?t.byteLength>>>2:"UTF-16"===this.encoding?t.byteLength>>>1:t.byteLength,s=0!==h||isFinite(r)&&r!==c?new n(t,h,isFinite(r)?r:c-h):a;break t;case Uint32Array:case Uint16Array:case Uint8Array:n=t.constructor,c=t.length,a=0===t.byteOffset&&t.length===(n===Uint32Array?t.buffer.byteLength>>>2:n===Uint16Array?t.buffer.byteLength>>>1:t.buffer.byteLength)?t:new n(t.buffer),s=0!==h||isFinite(r)&&r!==c?t.subarray(h,isFinite(r)?h+r:c):t;break t;default:c=(a=new n(t)).length,s=0!==h||isFinite(r)&&r!==c?a.subarray(h,isFinite(r)?h+r:c):a}break t;default:a=s=new n(Number(t)||0)}if(u<8){var g,M,d,R,f,v,U;4&u?(M=c=(g=t).length,u^="UTF-32"===this.encoding?0:2,h=d=i?Math.max((M+i)%M,0):0,f=R=(Number.isInteger(r)?Math.min(Math.max(r,0)+h,M):M)-1):(g=t.rawData,c=t.makeIndex(),h=d=i?Math.max((c+i)%c,0):0,f=R=(M=Number.isInteger(r)?Math.min(Math.max(r,0),c-d):c)+d,"UTF-8"===t.encoding?(v=StringView.getUTF8CharLength,U=StringView.loadUTF8CharCode):"UTF-16"===t.encoding?(v=StringView.getUTF16CharLength,U=StringView.loadUTF16CharCode):u&=1),(0===M||u<4&&g.encoding===this.encoding&&0===d&&M===c)&&(u=7);t:switch(u){case 0:a=new n(M);for(m=0;m<M;a[m]=g[h+m++]);break t;case 1:M=0;for(S=h;S<f;S++)M+=l(g[S]);a=new n(M);for(var S=h,m=0;m<M;S++)m=o(a,g[S],m);break t;case 2:h=0;for(I=0;I<d;I++)h+=v(E=U(g,h));a=new n(M);for(var S=h,m=0;m<M;S+=v(E),m++)E=U(g,S),a[m]=E;break t;case 3:M=0;for(var E,I=0,S=0;I<R;S+=v(E))E=U(g,S),I===d&&(h=S),++I>d&&(M+=l(E));a=new n(M);for(var S=h,m=0;m<M;S+=v(E))m=o(a,E=U(g,S),m);break t;case 4:a=new n(M);for(F=0;F<M;F++)a[F]=255&g.charCodeAt(F);break t;case 5:M=0;for(var p=0;p<c;p++)p===d&&(h=M),M+=l(g.charCodeAt(p)),p===R&&(f=M);a=new n(M);for(var m=0,I=0;m<M;I++)m=o(a,g.charCodeAt(I),m);break t;case 6:a=new n(M);for(var F=0;F<M;F++)a[F]=g.charCodeAt(F);break t;case 7:a=new n(M?g:0)}s=u>3&&(h>0||f<a.length-1)?a.subarray(h,f):a}this.buffer=a.buffer,this.bufferView=a,this.rawData=s,Object.freeze(this)}var BIMSURFER={CLASS:"BIMSURFER",VERSION_NUMBER:"2.0 Dev"};BIMSURFER.Class=function(t,e){var i=null,r=e||t,n=i="function"==typeof r.__construct?r.__construct:"function"==typeof t.prototype.__construct?function(){t.prototype.__construct.apply(this,arguments)}:function(){};if(void 0===e)n.prototype=r;else{var a=function(){};a.prototype=jQuery.extend({},t.prototype),jQuery.extend(a.prototype,e),n.prototype=new a}return n};var GEOMETRY_TYPE_TRIANGLES=0,GEOMETRY_TYPE_INSTANCE=1;if(BIMSURFER.Viewer=BIMSURFER.Class({CLASS:"BIMSURFER.Viewer",SYSTEM:null,connectedServers:null,div:null,mode:null,canvas:null,events:null,controls:null,lights:null,scene:null,sceneLoaded:!1,bimServerApi:null,activeGeometryLoaders:[],waitingGeometryLoaders:[],tick:0,__construct:function(t,e,i,r){if(this.bimServerApi=t,"string"==typeof e&&(e=jQuery("div#"+e)[0]),jQuery(e).is("div")){if(BIMSURFER.Util.isset(i)||(i={}),this.SYSTEM=this,this.div=e,this.events=new BIMSURFER.Events(this),this.connectedServers=new Array,this.controls=new Array,BIMSURFER.Util.isset(i.controls)){if(BIMSURFER.Util.isArray(i.controls))for(n=0;n<i.controls.length;n++)this.addControl(i.controls[n]).activateWhenReady()}else this.addControl(new BIMSURFER.Control.PickFlyOrbit).activateWhenReady();if(this.lights=new Array,void 0===i.lights)this.addLight(new BIMSURFER.Light.Sun),this.addLight(new BIMSURFER.Light.Ambient);else if(BIMSURFER.Util.isArray(i.lights))for(var n=0;n<i.lights.length;n++)this.addLight(i.lights[n]);if(this.visibleTypes=new Array,BIMSURFER.Util.isset(i,i.autoStart)){if(!BIMSURFER.Util.isset(i.autoStart.serverUrl,i.autoStart.serverUsername,i.autoStart.serverPassword,i.autoStart.projectOid))return void console.error("Some autostart parameters are missing");var a=this,s=new BIMSURFER.Server(this,i.autoStart.serverUrl,i.autoStart.serverUsername,i.autoStart.serverPassword,!1,!0,!0,function(){if("loggedin"!=s.loginStatus)return a.div.innerHTML="Something went wrong while connecting",void console.error("Something went wrong while connecting");s.getProjectByOid(i.autoStart.projectOid).loadScene(BIMSURFER.Util.isset(i.autoStart.revisionOid)?i.autoStart.revisionOid:null,!0)})}setInterval(this.startNewLoaders,200,this)}else console.error("BIMSURFER: Can not find div element")},addConnectedServer:function(t){-1==this.connectedServers.indexOf(t)&&this.connectedServers.push(t)},addControl:function(t){return BIMSURFER.Util.isset(this.controls[t.CLASS])||(this.controls[t.CLASS]=new Array),-1==this.controls[t.CLASS].indexOf(t)&&this.controls[t.CLASS].push(t),t.setViewer(this),t},removeControl:function(t){if(BIMSURFER.Util.isArray(this.controls[t.CLASS])){var e=this.controls[t.CLASS].indexOf(t);-1!=e&&(this.controls[t.CLASS].splice(e,1),t.deactivate(),t.removeFromViewer())}return t},getControl:function(t){var e=this.controls[t];return e.length>0?e[0]:null},addLight:function(t){if("BIMSURFER.Light."==t.CLASS.substr(0,16))return-1==this.lights.indexOf(t)&&this.lights.push(t),t.setViewer(this),this.scene&&t.activate(),t},resize:function(t,e){if(this.canvas&&(jQuery(this.canvas).width(t).height(e),BIMSURFER.Util.isset(this.canvas[0])&&(this.canvas[0].width=t,this.canvas[0].height=e)),null!==this.scene){var i=this.scene.findNode("main-camera").get("optics");i.aspect=jQuery(this.canvas).width()/jQuery(this.canvas).height(),this.scene.findNode("main-camera").set("optics",i)}},drawCanvas:function(){var t=jQuery(this.div).width(),e=jQuery(this.div).height();if(t>0&&e>0)return 1==jQuery(this.canvas).length&&jQuery(this.canvas).remove(),jQuery(this.div).empty(),this.canvas=jQuery("<canvas />").attr("id",jQuery(this.div).attr("id")+"-canvas").attr("width",t).attr("height",e).html('<p>This application requires a browser that supports the <a href="http://www.w3.org/html/wg/html5/">HTML5</a> &lt;canvas&gt; feature.</p>').addClass(this.CLASS.replace(/\./g,"-")).appendTo(this.div),this.canvas},initEvents:function(){var t=this,e=this.scene.getCanvas();e.addEventListener("mousedown",function(e){t.events.trigger("mouseDown",[e])},!0),e.addEventListener("mousemove",function(e){t.events.trigger("mouseMove",[e])},!0),e.addEventListener("mouseup",function(e){t.events.trigger("mouseUp",[e])},!0),e.addEventListener("touchstart",function(e){t.events.trigger("touchStart",[e])},!0),e.addEventListener("touchmove",function(e){t.events.trigger("touchMove",[e])},!0),e.addEventListener("touchend",function(e){t.events.trigger("touchEnd",[e])},!0),e.addEventListener("mousewheel",function(e){t.events.trigger("mouseWheel",[e])},!0),e.addEventListener("DOMMouseScroll",function(e){t.events.trigger("mouseWheel",[e])},!0),this.scene.on("pick",function(e){t.events.trigger("pick",[e])}),this.scene.on("tick",function(){t.events.trigger("tick",[])});var i={x:null,y:null,scene:this.scene};this.events.register("mouseDown",function(t){this.x=t.offsetX,this.y=t.offsetY},i),this.events.register("mouseUp",function(t){(t.offsetX>this.x?t.offsetX-this.x<5:this.x-t.offsetX<5)&&(t.offsetY>this.y?t.offsetY-this.y<5:this.y-t.offsetY<5)&&this.scene.pick(this.x,this.y,{rayPick:!0})},i)},loadScene:function(t,e){if(SceneJS.reset(),"object"!=typeof e&&(e={}),null==this.scene)try{this.scene={backfaces:!1,type:"scene",nodes:[{type:"lookAt",id:"main-lookAt",eye:"object"==typeof e.eye?e.eye:{x:1,y:1,z:1},look:"object"==typeof e.look?e.look:{x:0,y:0,z:0},up:"object"==typeof e.up?e.up:{x:0,y:0,z:1},nodes:[{nodes:function(t){return e.useCapture&&t.push({type:"canvas/capture",id:"canvasCaptureNode"}),t}([{type:"camera",id:"main-camera",optics:{type:"perspective",far:"number"==typeof e.far?e.far:1e5,near:"number"==typeof e.near?e.near:.001,aspect:"number"==typeof e.aspect?e.aspect:jQuery(this.canvas).width()/jQuery(this.canvas).height(),fovy:"number"==typeof e.fovy?e.fovy:37.8493},nodes:[{type:"renderer",id:"main-renderer",clear:{color:"boolean"!=typeof e.clearColor||e.clearColor,depth:"boolean"!=typeof e.clearDepth||e.clearDepth,stencil:"boolean"!=typeof e.clearStencil||e.clearStencil},nodes:[{type:"lights",id:"my-lights",lights:[]}]}]}])}]}]},this.drawCanvas(),this.scene.canvasId=jQuery(this.canvas).attr("id"),this.scene.id=this.scene.canvasId,this.scene=SceneJS.createScene(this.scene);var i=this;e.useCapture&&this.scene.getNode("canvasCaptureNode",function(t){var e;t.on("image",function(t){e.resolve(t)}),i.capture=function(i){return e=jQuery.Deferred(),t.capture({format:(i||{}).format||"png",width:(i||{}).width||1024,height:(i||{}).height||1024}),e}}),this.scene.on("tick",function(){i.tick%5==0&&i.activeGeometryLoaders.forEach(function(t){t.process()}),i.tick++});for(var r=0;r<this.lights.length;r++)this.lights[r].activate();var n=new BIMSURFER.Control.ClickSelect;this.addControl(n),null!=this.scene&&(this.initEvents(),this.sceneLoaded=!0),t()}catch(t){console.error("loadScene: ",t,t.stack,this,arguments),console.debug("loadScene ERROR",t,t.stack,this,arguments)}else t();return null},startNewLoaders:function(t){if(t.waitingGeometryLoaders.length>0&&t.activeGeometryLoaders.length<3){var e=t.waitingGeometryLoaders[0];t.waitingGeometryLoaders=t.waitingGeometryLoaders.slice(1),t.activeGeometryLoaders.push(e),e.progressListeners.push(function(i){"done"==i&&(t.tick=0,removeA(t.activeGeometryLoaders,e))}),e.start()}},loadGeometry:function(t){var e=this;e.activeGeometryLoaders.length<3?(e.activeGeometryLoaders.push(t),t.progressListeners.push(function(i){"done"==i&&(e.tick=0,removeA(e.activeGeometryLoaders,t))}),t.start()):e.waitingGeometryLoaders.push(t)},hideType:function(t,e){var i=e.visibleTypes.indexOf(t.toLowerCase());-1!=i&&(e.visibleTypes.splice(i,1),this.refreshMask())},refreshMask:function(){var t=new Array;this.visibleTypes.forEach(function(e){t.push(e)});var e="^("+t.join("|")+")$";this.scene.set("tagMask",e),this.events.trigger("tagMaskUpdated")},hideRevision:function(t){for(var e=t.visibleTypes.slice(0),i=0;i<e.length;i++)this.hideType(e[i],t)},showRevision:function(t,e){if(!BIMSURFER.Util.isset(e)){e=new Array;for(var i=0;i<t.ifcTypes.length;i++)-1!=BIMSURFER.Constants.defaultTypes.indexOf(t.ifcTypes[i])&&e.push(t.ifcTypes[i])}this.showType(e,t)}}),"object"!=typeof BIMSURFER.Util&&(BIMSURFER.Util={}),BIMSURFER.Util.isset=function(t){for(var e=0;e<arguments.length;e++)if(void 0===arguments[e]||null==arguments[e])return!1;return!0},BIMSURFER.Util.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},!GLMAT_EPSILON)var GLMAT_EPSILON=1e-6;if(!GLMAT_ARRAY_TYPE)var GLMAT_ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;if(!GLMAT_RANDOM)var GLMAT_RANDOM=Math.random;BIMSURFER.Util.glMatrix={},BIMSURFER.Util.glMatrix.setMatrixArrayType=function(t){GLMAT_ARRAY_TYPE=t},BIMSURFER.Util.glMatrix.toRadian=function(t){return t*(Math.PI/180)},BIMSURFER.Util.glMatrix.vec4={},BIMSURFER.Util.glMatrix.vec4.create=function(){var t=new GLMAT_ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},BIMSURFER.Util.glMatrix.vec4.clone=function(t){var e=new GLMAT_ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},BIMSURFER.Util.glMatrix.vec4.fromValues=function(t,e,i,r){var n=new GLMAT_ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},BIMSURFER.Util.glMatrix.vec4.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},BIMSURFER.Util.glMatrix.vec4.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},BIMSURFER.Util.glMatrix.vec4.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},BIMSURFER.Util.glMatrix.vec4.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},BIMSURFER.Util.glMatrix.vec4.sub=BIMSURFER.Util.glMatrix.vec4.subtract,BIMSURFER.Util.glMatrix.vec4.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},BIMSURFER.Util.glMatrix.vec4.mul=BIMSURFER.Util.glMatrix.vec4.multiply,BIMSURFER.Util.glMatrix.vec4.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},BIMSURFER.Util.glMatrix.vec4.div=BIMSURFER.Util.glMatrix.vec4.divide,BIMSURFER.Util.glMatrix.vec4.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},BIMSURFER.Util.glMatrix.vec4.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},BIMSURFER.Util.glMatrix.vec4.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},BIMSURFER.Util.glMatrix.vec4.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},BIMSURFER.Util.glMatrix.vec4.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+a*a)},BIMSURFER.Util.glMatrix.vec4.dist=BIMSURFER.Util.glMatrix.vec4.distance,BIMSURFER.Util.glMatrix.vec4.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return i*i+r*r+n*n+a*a},BIMSURFER.Util.glMatrix.vec4.sqrDist=BIMSURFER.Util.glMatrix.vec4.squaredDistance,BIMSURFER.Util.glMatrix.vec4.length=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)},BIMSURFER.Util.glMatrix.vec4.len=BIMSURFER.Util.glMatrix.vec4.length,BIMSURFER.Util.glMatrix.vec4.squaredLength=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n},BIMSURFER.Util.glMatrix.vec4.sqrLen=BIMSURFER.Util.glMatrix.vec4.squaredLength,BIMSURFER.Util.glMatrix.vec4.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},BIMSURFER.Util.glMatrix.vec4.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i*i+r*r+n*n+a*a;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s),t},BIMSURFER.Util.glMatrix.vec4.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},BIMSURFER.Util.glMatrix.vec4.lerp=function(t,e,i,r){var n=e[0],a=e[1],s=e[2],o=e[3];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=s+r*(i[2]-s),t[3]=o+r*(i[3]-o),t},BIMSURFER.Util.glMatrix.vec4.random=function(t,e){return e=e||1,t[0]=GLMAT_RANDOM(),t[1]=GLMAT_RANDOM(),t[2]=GLMAT_RANDOM(),t[3]=GLMAT_RANDOM(),BIMSURFER.Util.glMatrix.vec4.normalize(t,t),BIMSURFER.Util.glMatrix.vec4.scale(t,t,e),t},BIMSURFER.Util.glMatrix.vec4.transformMat4=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*s,t[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*s,t[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*s,t[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*s,t},BIMSURFER.Util.glMatrix.vec4.transformQuat=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=i[0],o=i[1],l=i[2],c=i[3],h=c*r+o*a-l*n,u=c*n+l*r-s*a,g=c*a+s*n-o*r,M=-s*r-o*n-l*a;return t[0]=h*c+M*-s+u*-l-g*-o,t[1]=u*c+M*-o+g*-s-h*-l,t[2]=g*c+M*-l+h*-o-u*-s,t},BIMSURFER.Util.glMatrix.vec4.forEach=function(){var t=BIMSURFER.Util.glMatrix.vec4.create();return function(e,i,r,n,a,s){var o,l;for(i||(i=4),r||(r=0),l=n?Math.min(n*i+r,e.length):e.length,o=r;o<l;o+=i)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],a(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}(),BIMSURFER.Util.glMatrix.vec4.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},BIMSURFER.Util.glMatrix.vec3={},BIMSURFER.Util.glMatrix.vec3.create=function(){var t=new GLMAT_ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},BIMSURFER.Util.glMatrix.vec3.clone=function(t){var e=new GLMAT_ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},BIMSURFER.Util.glMatrix.vec3.fromValues=function(t,e,i){var r=new GLMAT_ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=i,r},BIMSURFER.Util.glMatrix.vec3.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},BIMSURFER.Util.glMatrix.vec3.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},BIMSURFER.Util.glMatrix.vec3.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},BIMSURFER.Util.glMatrix.vec3.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},BIMSURFER.Util.glMatrix.vec3.sub=BIMSURFER.Util.glMatrix.vec3.subtract,BIMSURFER.Util.glMatrix.vec3.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},BIMSURFER.Util.glMatrix.vec3.mul=BIMSURFER.Util.glMatrix.vec3.multiply,BIMSURFER.Util.glMatrix.vec3.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},BIMSURFER.Util.glMatrix.vec3.div=BIMSURFER.Util.glMatrix.vec3.divide,BIMSURFER.Util.glMatrix.vec3.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},BIMSURFER.Util.glMatrix.vec3.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},BIMSURFER.Util.glMatrix.vec3.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},BIMSURFER.Util.glMatrix.vec3.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t},BIMSURFER.Util.glMatrix.vec3.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)},BIMSURFER.Util.glMatrix.vec3.dist=BIMSURFER.Util.glMatrix.vec3.distance,BIMSURFER.Util.glMatrix.vec3.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n},BIMSURFER.Util.glMatrix.vec3.sqrDist=BIMSURFER.Util.glMatrix.vec3.squaredDistance,BIMSURFER.Util.glMatrix.vec3.length=function(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)},BIMSURFER.Util.glMatrix.vec3.len=BIMSURFER.Util.glMatrix.vec3.length,BIMSURFER.Util.glMatrix.vec3.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},BIMSURFER.Util.glMatrix.vec3.sqrLen=BIMSURFER.Util.glMatrix.vec3.squaredLength,BIMSURFER.Util.glMatrix.vec3.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},BIMSURFER.Util.glMatrix.vec3.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},BIMSURFER.Util.glMatrix.vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},BIMSURFER.Util.glMatrix.vec3.cross=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=i[0],o=i[1],l=i[2];return t[0]=n*l-a*o,t[1]=a*s-r*l,t[2]=r*o-n*s,t},BIMSURFER.Util.glMatrix.vec3.lerp=function(t,e,i,r){var n=e[0],a=e[1],s=e[2];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=s+r*(i[2]-s),t},BIMSURFER.Util.glMatrix.vec3.random=function(t,e){e=e||1;var i=2*GLMAT_RANDOM()*Math.PI,r=2*GLMAT_RANDOM()-1,n=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=r*e,t},BIMSURFER.Util.glMatrix.vec3.transformMat4=function(t,e,i){var r=e[0],n=e[1],a=e[2];return t[0]=i[0]*r+i[4]*n+i[8]*a+i[12],t[1]=i[1]*r+i[5]*n+i[9]*a+i[13],t[2]=i[2]*r+i[6]*n+i[10]*a+i[14],t},BIMSURFER.Util.glMatrix.vec3.transformMat3=function(t,e,i){var r=e[0],n=e[1],a=e[2];return t[0]=r*i[0]+n*i[3]+a*i[6],t[1]=r*i[1]+n*i[4]+a*i[7],t[2]=r*i[2]+n*i[5]+a*i[8],t},BIMSURFER.Util.glMatrix.vec3.transformQuat=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=i[0],o=i[1],l=i[2],c=i[3],h=c*r+o*a-l*n,u=c*n+l*r-s*a,g=c*a+s*n-o*r,M=-s*r-o*n-l*a;return t[0]=h*c+M*-s+u*-l-g*-o,t[1]=u*c+M*-o+g*-s-h*-l,t[2]=g*c+M*-l+h*-o-u*-s,t},BIMSURFER.Util.glMatrix.vec3.forEach=function(){var t=BIMSURFER.Util.glMatrix.vec3.create();return function(e,i,r,n,a,s){var o,l;for(i||(i=3),r||(r=0),l=n?Math.min(n*i+r,e.length):e.length,o=r;o<l;o+=i)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],a(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}}(),BIMSURFER.Util.glMatrix.vec3.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},BIMSURFER.Util.glMatrix.vec2={},BIMSURFER.Util.glMatrix.vec2.create=function(){var t=new GLMAT_ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},BIMSURFER.Util.glMatrix.vec2.clone=function(t){var e=new GLMAT_ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},BIMSURFER.Util.glMatrix.vec2.fromValues=function(t,e){var i=new GLMAT_ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},BIMSURFER.Util.glMatrix.vec2.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},BIMSURFER.Util.glMatrix.vec2.set=function(t,e,i){return t[0]=e,t[1]=i,t},BIMSURFER.Util.glMatrix.vec2.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},BIMSURFER.Util.glMatrix.vec2.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},BIMSURFER.Util.glMatrix.vec2.sub=BIMSURFER.Util.glMatrix.vec2.subtract,BIMSURFER.Util.glMatrix.vec2.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},BIMSURFER.Util.glMatrix.vec2.mul=BIMSURFER.Util.glMatrix.vec2.multiply,BIMSURFER.Util.glMatrix.vec2.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},BIMSURFER.Util.glMatrix.vec2.div=BIMSURFER.Util.glMatrix.vec2.divide,BIMSURFER.Util.glMatrix.vec2.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},BIMSURFER.Util.glMatrix.vec2.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},BIMSURFER.Util.glMatrix.vec2.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},BIMSURFER.Util.glMatrix.vec2.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t},BIMSURFER.Util.glMatrix.vec2.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)},BIMSURFER.Util.glMatrix.vec2.dist=BIMSURFER.Util.glMatrix.vec2.distance,BIMSURFER.Util.glMatrix.vec2.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r},BIMSURFER.Util.glMatrix.vec2.sqrDist=BIMSURFER.Util.glMatrix.vec2.squaredDistance,BIMSURFER.Util.glMatrix.vec2.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},BIMSURFER.Util.glMatrix.vec2.len=BIMSURFER.Util.glMatrix.vec2.length,BIMSURFER.Util.glMatrix.vec2.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},BIMSURFER.Util.glMatrix.vec2.sqrLen=BIMSURFER.Util.glMatrix.vec2.squaredLength,BIMSURFER.Util.glMatrix.vec2.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},BIMSURFER.Util.glMatrix.vec2.normalize=function(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},BIMSURFER.Util.glMatrix.vec2.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},BIMSURFER.Util.glMatrix.vec2.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},BIMSURFER.Util.glMatrix.vec2.lerp=function(t,e,i,r){var n=e[0],a=e[1];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t},BIMSURFER.Util.glMatrix.vec2.random=function(t,e){e=e||1;var i=2*GLMAT_RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},BIMSURFER.Util.glMatrix.vec2.transformMat2=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t},BIMSURFER.Util.glMatrix.vec2.transformMat2d=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t},BIMSURFER.Util.glMatrix.vec2.transformMat3=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t},BIMSURFER.Util.glMatrix.vec2.transformMat4=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t},BIMSURFER.Util.glMatrix.vec2.forEach=function(){var t=BIMSURFER.Util.glMatrix.vec2.create();return function(e,i,r,n,a,s){var o,l;for(i||(i=2),r||(r=0),l=n?Math.min(n*i+r,e.length):e.length,o=r;o<l;o+=i)t[0]=e[o],t[1]=e[o+1],a(t,t,s),e[o]=t[0],e[o+1]=t[1];return e}}(),BIMSURFER.Util.glMatrix.vec2.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},BIMSURFER.Util.glMatrix.mat4={},BIMSURFER.Util.glMatrix.mat4.create=function(){var t=new GLMAT_ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},BIMSURFER.Util.glMatrix.mat4.clone=function(t){var e=new GLMAT_ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},BIMSURFER.Util.glMatrix.mat4.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},BIMSURFER.Util.glMatrix.mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},BIMSURFER.Util.glMatrix.mat4.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],a=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=n,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},BIMSURFER.Util.glMatrix.mat4.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=e[9],g=e[10],M=e[11],d=e[12],R=e[13],f=e[14],v=e[15],U=i*o-r*s,S=i*l-n*s,m=i*c-a*s,E=r*l-n*o,I=r*c-a*o,p=n*c-a*l,F=h*R-u*d,y=h*f-g*d,B=h*v-M*d,x=u*f-g*R,w=u*v-M*R,b=g*v-M*f,T=U*b-S*w+m*x+E*B-I*y+p*F;return T?(T=1/T,t[0]=(o*b-l*w+c*x)*T,t[1]=(n*w-r*b-a*x)*T,t[2]=(R*p-f*I+v*E)*T,t[3]=(g*I-u*p-M*E)*T,t[4]=(l*B-s*b-c*y)*T,t[5]=(i*b-n*B+a*y)*T,t[6]=(f*m-d*p-v*S)*T,t[7]=(h*p-g*m+M*S)*T,t[8]=(s*w-o*B+c*F)*T,t[9]=(r*B-i*w-a*F)*T,t[10]=(d*I-R*m+v*U)*T,t[11]=(u*m-h*I-M*U)*T,t[12]=(o*y-s*x-l*F)*T,t[13]=(i*x-r*y+n*F)*T,t[14]=(R*S-d*E-f*U)*T,t[15]=(h*E-u*S+g*U)*T,t):null},BIMSURFER.Util.glMatrix.mat4.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=e[9],g=e[10],M=e[11],d=e[12],R=e[13],f=e[14],v=e[15];return t[0]=o*(g*v-M*f)-u*(l*v-c*f)+R*(l*M-c*g),t[1]=-(r*(g*v-M*f)-u*(n*v-a*f)+R*(n*M-a*g)),t[2]=r*(l*v-c*f)-o*(n*v-a*f)+R*(n*c-a*l),t[3]=-(r*(l*M-c*g)-o*(n*M-a*g)+u*(n*c-a*l)),t[4]=-(s*(g*v-M*f)-h*(l*v-c*f)+d*(l*M-c*g)),t[5]=i*(g*v-M*f)-h*(n*v-a*f)+d*(n*M-a*g),t[6]=-(i*(l*v-c*f)-s*(n*v-a*f)+d*(n*c-a*l)),t[7]=i*(l*M-c*g)-s*(n*M-a*g)+h*(n*c-a*l),t[8]=s*(u*v-M*R)-h*(o*v-c*R)+d*(o*M-c*u),t[9]=-(i*(u*v-M*R)-h*(r*v-a*R)+d*(r*M-a*u)),t[10]=i*(o*v-c*R)-s*(r*v-a*R)+d*(r*c-a*o),t[11]=-(i*(o*M-c*u)-s*(r*M-a*u)+h*(r*c-a*o)),t[12]=-(s*(u*f-g*R)-h*(o*f-l*R)+d*(o*g-l*u)),t[13]=i*(u*f-g*R)-h*(r*f-n*R)+d*(r*g-n*u),t[14]=-(i*(o*f-l*R)-s*(r*f-n*R)+d*(r*l-n*o)),t[15]=i*(o*g-l*u)-s*(r*g-n*u)+h*(r*l-n*o),t},BIMSURFER.Util.glMatrix.mat4.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],s=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],g=t[11],M=t[12],d=t[13],R=t[14],f=t[15];return(e*s-i*a)*(u*f-g*R)-(e*o-r*a)*(h*f-g*d)+(e*l-n*a)*(h*R-u*d)+(i*o-r*s)*(c*f-g*M)-(i*l-n*s)*(c*R-u*M)+(r*l-n*o)*(c*d-h*M)},BIMSURFER.Util.glMatrix.mat4.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=e[6],h=e[7],u=e[8],g=e[9],M=e[10],d=e[11],R=e[12],f=e[13],v=e[14],U=e[15],S=i[0],m=i[1],E=i[2],I=i[3];return t[0]=S*r+m*o+E*u+I*R,t[1]=S*n+m*l+E*g+I*f,t[2]=S*a+m*c+E*M+I*v,t[3]=S*s+m*h+E*d+I*U,S=i[4],m=i[5],E=i[6],I=i[7],t[4]=S*r+m*o+E*u+I*R,t[5]=S*n+m*l+E*g+I*f,t[6]=S*a+m*c+E*M+I*v,t[7]=S*s+m*h+E*d+I*U,S=i[8],m=i[9],E=i[10],I=i[11],t[8]=S*r+m*o+E*u+I*R,t[9]=S*n+m*l+E*g+I*f,t[10]=S*a+m*c+E*M+I*v,t[11]=S*s+m*h+E*d+I*U,S=i[12],m=i[13],E=i[14],I=i[15],t[12]=S*r+m*o+E*u+I*R,t[13]=S*n+m*l+E*g+I*f,t[14]=S*a+m*c+E*M+I*v,t[15]=S*s+m*h+E*d+I*U,t},BIMSURFER.Util.glMatrix.mat4.mul=BIMSURFER.Util.glMatrix.mat4.multiply,BIMSURFER.Util.glMatrix.mat4.translate=function(t,e,i){var r,n,a,s,o,l,c,h,u,g,M,d,R=i[0],f=i[1],v=i[2];return e===t?(t[12]=e[0]*R+e[4]*f+e[8]*v+e[12],t[13]=e[1]*R+e[5]*f+e[9]*v+e[13],t[14]=e[2]*R+e[6]*f+e[10]*v+e[14],t[15]=e[3]*R+e[7]*f+e[11]*v+e[15]):(r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=e[6],h=e[7],u=e[8],g=e[9],M=e[10],d=e[11],t[0]=r,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=l,t[6]=c,t[7]=h,t[8]=u,t[9]=g,t[10]=M,t[11]=d,t[12]=r*R+o*f+u*v+e[12],t[13]=n*R+l*f+g*v+e[13],t[14]=a*R+c*f+M*v+e[14],t[15]=s*R+h*f+d*v+e[15]),t},BIMSURFER.Util.glMatrix.mat4.scale=function(t,e,i){var r=i[0],n=i[1],a=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},BIMSURFER.Util.glMatrix.mat4.rotate=function(t,e,i,r){var n,a,s,o,l,c,h,u,g,M,d,R,f,v,U,S,m,E,I,p,F,y,B,x,w=r[0],b=r[1],T=r[2],A=Math.sqrt(w*w+b*b+T*T);return Math.abs(A)<GLMAT_EPSILON?null:(A=1/A,w*=A,b*=A,T*=A,n=Math.sin(i),a=Math.cos(i),s=1-a,o=e[0],l=e[1],c=e[2],h=e[3],u=e[4],g=e[5],M=e[6],d=e[7],R=e[8],f=e[9],v=e[10],U=e[11],S=w*w*s+a,m=b*w*s+T*n,E=T*w*s-b*n,I=w*b*s-T*n,p=b*b*s+a,F=T*b*s+w*n,y=w*T*s+b*n,B=b*T*s-w*n,x=T*T*s+a,t[0]=o*S+u*m+R*E,t[1]=l*S+g*m+f*E,t[2]=c*S+M*m+v*E,t[3]=h*S+d*m+U*E,t[4]=o*I+u*p+R*F,t[5]=l*I+g*p+f*F,t[6]=c*I+M*p+v*F,t[7]=h*I+d*p+U*F,t[8]=o*y+u*B+R*x,t[9]=l*y+g*B+f*x,t[10]=c*y+M*B+v*x,t[11]=h*y+d*B+U*x,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},BIMSURFER.Util.glMatrix.mat4.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],g=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+c*r,t[5]=s*n+h*r,t[6]=o*n+u*r,t[7]=l*n+g*r,t[8]=c*n-a*r,t[9]=h*n-s*r,t[10]=u*n-o*r,t[11]=g*n-l*r,t},BIMSURFER.Util.glMatrix.mat4.rotateY=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[0],s=e[1],o=e[2],l=e[3],c=e[8],h=e[9],u=e[10],g=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-c*r,t[1]=s*n-h*r,t[2]=o*n-u*r,t[3]=l*n-g*r,t[8]=a*r+c*n,t[9]=s*r+h*n,t[10]=o*r+u*n,t[11]=l*r+g*n,t},BIMSURFER.Util.glMatrix.mat4.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[0],s=e[1],o=e[2],l=e[3],c=e[4],h=e[5],u=e[6],g=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+c*r,t[1]=s*n+h*r,t[2]=o*n+u*r,t[3]=l*n+g*r,t[4]=c*n-a*r,t[5]=h*n-s*r,t[6]=u*n-o*r,t[7]=g*n-l*r,t},BIMSURFER.Util.glMatrix.mat4.fromRotationTranslation=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=r+r,l=n+n,c=a+a,h=r*o,u=r*l,g=r*c,M=n*l,d=n*c,R=a*c,f=s*o,v=s*l,U=s*c;return t[0]=1-(M+R),t[1]=u+U,t[2]=g-v,t[3]=0,t[4]=u-U,t[5]=1-(h+R),t[6]=d+f,t[7]=0,t[8]=g+v,t[9]=d-f,t[10]=1-(h+M),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},BIMSURFER.Util.glMatrix.mat4.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i+i,o=r+r,l=n+n,c=i*s,h=i*o,u=i*l,g=r*o,M=r*l,d=n*l,R=a*s,f=a*o,v=a*l;return t[0]=1-(g+d),t[1]=h+v,t[2]=u-f,t[3]=0,t[4]=h-v,t[5]=1-(c+d),t[6]=M+R,t[7]=0,t[8]=u+f,t[9]=M-R,t[10]=1-(c+g),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},BIMSURFER.Util.glMatrix.mat4.frustum=function(t,e,i,r,n,a,s){var o=1/(i-e),l=1/(n-r),c=1/(a-s);return t[0]=2*a*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*l,t[6]=0,t[7]=0,t[8]=(i+e)*o,t[9]=(n+r)*l,t[10]=(s+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*a*2*c,t[15]=0,t},BIMSURFER.Util.glMatrix.mat4.perspective=function(t,e,i,r,n){var a=1/Math.tan(e/2),s=1/(r-n);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*s,t[15]=0,t},BIMSURFER.Util.glMatrix.mat4.ortho=function(t,e,i,r,n,a,s){var o=1/(e-i),l=1/(r-n),c=1/(a-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*o,t[13]=(n+r)*l,t[14]=(s+a)*c,t[15]=1,t},BIMSURFER.Util.glMatrix.mat4.lookAt=function(t,e,i,r){var n,a,s,o,l,c,h,u,g,M,d=e[0],R=e[1],f=e[2],v=r[0],U=r[1],S=r[2],m=i[0],E=i[1],I=i[2];return Math.abs(d-m)<GLMAT_EPSILON&&Math.abs(R-E)<GLMAT_EPSILON&&Math.abs(f-I)<GLMAT_EPSILON?BIMSURFER.Util.glMatrix.mat4.identity(t):(h=d-m,u=R-E,g=f-I,M=1/Math.sqrt(h*h+u*u+g*g),h*=M,u*=M,g*=M,n=U*g-S*u,a=S*h-v*g,s=v*u-U*h,(M=Math.sqrt(n*n+a*a+s*s))?(n*=M=1/M,a*=M,s*=M):(n=0,a=0,s=0),o=u*s-g*a,l=g*n-h*s,c=h*a-u*n,(M=Math.sqrt(o*o+l*l+c*c))?(o*=M=1/M,l*=M,c*=M):(o=0,l=0,c=0),t[0]=n,t[1]=o,t[2]=h,t[3]=0,t[4]=a,t[5]=l,t[6]=u,t[7]=0,t[8]=s,t[9]=c,t[10]=g,t[11]=0,t[12]=-(n*d+a*R+s*f),t[13]=-(o*d+l*R+c*f),t[14]=-(h*d+u*R+g*f),t[15]=1,t)},BIMSURFER.Util.glMatrix.mat4.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},BIMSURFER.Util.glMatrix.mat3={},BIMSURFER.Util.glMatrix.mat3.create=function(){var t=new GLMAT_ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},BIMSURFER.Util.glMatrix.mat3.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},BIMSURFER.Util.glMatrix.mat3.clone=function(t){var e=new GLMAT_ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},BIMSURFER.Util.glMatrix.mat3.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},BIMSURFER.Util.glMatrix.mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},BIMSURFER.Util.glMatrix.mat3.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},BIMSURFER.Util.glMatrix.mat3.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=h*s-o*c,g=-h*a+o*l,M=c*a-s*l,d=i*u+r*g+n*M;return d?(d=1/d,t[0]=u*d,t[1]=(-h*r+n*c)*d,t[2]=(o*r-n*s)*d,t[3]=g*d,t[4]=(h*i-n*l)*d,t[5]=(-o*i+n*a)*d,t[6]=M*d,t[7]=(-c*i+r*l)*d,t[8]=(s*i-r*a)*d,t):null},BIMSURFER.Util.glMatrix.mat3.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],h=e[8];return t[0]=s*h-o*c,t[1]=n*c-r*h,t[2]=r*o-n*s,t[3]=o*l-a*h,t[4]=i*h-n*l,t[5]=n*a-i*o,t[6]=a*c-s*l,t[7]=r*l-i*c,t[8]=i*s-r*a,t},BIMSURFER.Util.glMatrix.mat3.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],s=t[5],o=t[6],l=t[7],c=t[8];return e*(c*a-s*l)+i*(-c*n+s*o)+r*(l*n-a*o)},BIMSURFER.Util.glMatrix.mat3.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=e[6],h=e[7],u=e[8],g=i[0],M=i[1],d=i[2],R=i[3],f=i[4],v=i[5],U=i[6],S=i[7],m=i[8];return t[0]=g*r+M*s+d*c,t[1]=g*n+M*o+d*h,t[2]=g*a+M*l+d*u,t[3]=R*r+f*s+v*c,t[4]=R*n+f*o+v*h,t[5]=R*a+f*l+v*u,t[6]=U*r+S*s+m*c,t[7]=U*n+S*o+m*h,t[8]=U*a+S*l+m*u,t},BIMSURFER.Util.glMatrix.mat3.mul=BIMSURFER.Util.glMatrix.mat3.multiply,BIMSURFER.Util.glMatrix.mat3.translate=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=e[6],h=e[7],u=e[8],g=i[0],M=i[1];return t[0]=r,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=l,t[6]=g*r+M*s+c,t[7]=g*n+M*o+h,t[8]=g*a+M*l+u,t},BIMSURFER.Util.glMatrix.mat3.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=e[6],h=e[7],u=e[8],g=Math.sin(i),M=Math.cos(i);return t[0]=M*r+g*s,t[1]=M*n+g*o,t[2]=M*a+g*l,t[3]=M*s-g*r,t[4]=M*o-g*n,t[5]=M*l-g*a,t[6]=c,t[7]=h,t[8]=u,t},BIMSURFER.Util.glMatrix.mat3.scale=function(t,e,i){var r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},BIMSURFER.Util.glMatrix.mat3.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},BIMSURFER.Util.glMatrix.mat3.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i+i,o=r+r,l=n+n,c=i*s,h=i*o,u=i*l,g=r*o,M=r*l,d=n*l,R=a*s,f=a*o,v=a*l;return t[0]=1-(g+d),t[3]=h+v,t[6]=u-f,t[1]=h-v,t[4]=1-(c+d),t[7]=M+R,t[2]=u+f,t[5]=M-R,t[8]=1-(c+g),t},BIMSURFER.Util.glMatrix.mat3.normalFromMat4=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=e[9],g=e[10],M=e[11],d=e[12],R=e[13],f=e[14],v=e[15],U=i*o-r*s,S=i*l-n*s,m=i*c-a*s,E=r*l-n*o,I=r*c-a*o,p=n*c-a*l,F=h*R-u*d,y=h*f-g*d,B=h*v-M*d,x=u*f-g*R,w=u*v-M*R,b=g*v-M*f,T=U*b-S*w+m*x+E*B-I*y+p*F;return T?(T=1/T,t[0]=(o*b-l*w+c*x)*T,t[1]=(l*B-s*b-c*y)*T,t[2]=(s*w-o*B+c*F)*T,t[3]=(n*w-r*b-a*x)*T,t[4]=(i*b-n*B+a*y)*T,t[5]=(r*B-i*w-a*F)*T,t[6]=(R*p-f*I+v*E)*T,t[7]=(f*m-d*p-v*S)*T,t[8]=(d*I-R*m+v*U)*T,t):null},BIMSURFER.Util.glMatrix.mat3.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},BIMSURFER.Util.glMatrix.mat2d={},BIMSURFER.Util.glMatrix.mat2d.create=function(){var t=new GLMAT_ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},BIMSURFER.Util.glMatrix.mat2d.clone=function(t){var e=new GLMAT_ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},BIMSURFER.Util.glMatrix.mat2d.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},BIMSURFER.Util.glMatrix.mat2d.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},BIMSURFER.Util.glMatrix.mat2d.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=i*a-r*n;return l?(l=1/l,t[0]=a*l,t[1]=-r*l,t[2]=-n*l,t[3]=i*l,t[4]=(n*o-a*s)*l,t[5]=(r*s-i*o)*l,t):null},BIMSURFER.Util.glMatrix.mat2d.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},BIMSURFER.Util.glMatrix.mat2d.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=i[0],h=i[1],u=i[2],g=i[3],M=i[4],d=i[5];return t[0]=r*c+n*u,t[1]=r*h+n*g,t[2]=a*c+s*u,t[3]=a*h+s*g,t[4]=c*o+u*l+M,t[5]=h*o+g*l+d,t},BIMSURFER.Util.glMatrix.mat2d.mul=BIMSURFER.Util.glMatrix.mat2d.multiply,BIMSURFER.Util.glMatrix.mat2d.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=Math.sin(i),h=Math.cos(i);return t[0]=r*h+n*c,t[1]=-r*c+n*h,t[2]=a*h+s*c,t[3]=-a*c+h*s,t[4]=h*o+c*l,t[5]=h*l-c*o,t},BIMSURFER.Util.glMatrix.mat2d.scale=function(t,e,i){var r=i[0],n=i[1];return t[0]=e[0]*r,t[1]=e[1]*n,t[2]=e[2]*r,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*n,t},BIMSURFER.Util.glMatrix.mat2d.translate=function(t,e,i){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4]+i[0],t[5]=e[5]+i[1],t},BIMSURFER.Util.glMatrix.mat2d.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},BIMSURFER.Util.glMatrix.mat2={},BIMSURFER.Util.glMatrix.mat2.create=function(){var t=new GLMAT_ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},BIMSURFER.Util.glMatrix.mat2.clone=function(t){var e=new GLMAT_ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},BIMSURFER.Util.glMatrix.mat2.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},BIMSURFER.Util.glMatrix.mat2.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},BIMSURFER.Util.glMatrix.mat2.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},BIMSURFER.Util.glMatrix.mat2.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i*a-n*r;return s?(s=1/s,t[0]=a*s,t[1]=-r*s,t[2]=-n*s,t[3]=i*s,t):null},BIMSURFER.Util.glMatrix.mat2.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},BIMSURFER.Util.glMatrix.mat2.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},BIMSURFER.Util.glMatrix.mat2.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*o+n*c,t[1]=r*l+n*h,t[2]=a*o+s*c,t[3]=a*l+s*h,t},BIMSURFER.Util.glMatrix.mat2.mul=BIMSURFER.Util.glMatrix.mat2.multiply,BIMSURFER.Util.glMatrix.mat2.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*o,t[1]=r*-o+n*l,t[2]=a*l+s*o,t[3]=a*-o+s*l,t},BIMSURFER.Util.glMatrix.mat2.scale=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=i[0],l=i[1];return t[0]=r*o,t[1]=n*l,t[2]=a*o,t[3]=s*l,t},BIMSURFER.Util.glMatrix.mat2.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},BIMSURFER.Util.glMatrix.quat={},BIMSURFER.Util.glMatrix.quat.create=function(){var t=new GLMAT_ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},BIMSURFER.Util.glMatrix.quat.rotationTo=function(){var t=BIMSURFER.Util.glMatrix.vec3.create(),e=BIMSURFER.Util.glMatrix.vec3.fromValues(1,0,0),i=BIMSURFER.Util.glMatrix.vec3.fromValues(0,1,0);return function(r,n,a){var s=BIMSURFER.Util.glMatrix.vec3.dot(n,a);return s<-.999999?(BIMSURFER.Util.glMatrix.vec3.cross(t,e,n),BIMSURFER.Util.glMatrix.vec3.length(t)<1e-6&&BIMSURFER.Util.glMatrix.vec3.cross(t,i,n),BIMSURFER.Util.glMatrix.vec3.normalize(t,t),BIMSURFER.Util.glMatrix.quat.setAxisAngle(r,t,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(BIMSURFER.Util.glMatrix.vec3.cross(t,n,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+s,BIMSURFER.Util.glMatrix.quat.normalize(r,r))}}(),BIMSURFER.Util.glMatrix.quat.setAxes=function(){var t=BIMSURFER.Util.glMatrix.mat3.create();return function(e,i,r,n){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=i[0],t[5]=i[1],t[8]=i[2],BIMSURFER.Util.glMatrix.quat.normalize(e,BIMSURFER.Util.glMatrix.quat.fromMat3(e,t))}}(),BIMSURFER.Util.glMatrix.quat.clone=BIMSURFER.Util.glMatrix.vec4.clone,BIMSURFER.Util.glMatrix.quat.fromValues=BIMSURFER.Util.glMatrix.vec4.fromValues,BIMSURFER.Util.glMatrix.quat.copy=BIMSURFER.Util.glMatrix.vec4.copy,BIMSURFER.Util.glMatrix.quat.set=BIMSURFER.Util.glMatrix.vec4.set,BIMSURFER.Util.glMatrix.quat.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},BIMSURFER.Util.glMatrix.quat.setAxisAngle=function(t,e,i){i*=.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t},BIMSURFER.Util.glMatrix.quat.add=BIMSURFER.Util.glMatrix.vec4.add,BIMSURFER.Util.glMatrix.quat.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*h+s*o+n*c-a*l,t[1]=n*h+s*l+a*o-r*c,t[2]=a*h+s*c+r*l-n*o,t[3]=s*h-r*o-n*l-a*c,t},BIMSURFER.Util.glMatrix.quat.mul=BIMSURFER.Util.glMatrix.quat.multiply,BIMSURFER.Util.glMatrix.quat.scale=BIMSURFER.Util.glMatrix.vec4.scale,BIMSURFER.Util.glMatrix.quat.rotateX=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*o,t[1]=n*l+a*o,t[2]=a*l-n*o,t[3]=s*l-r*o,t},BIMSURFER.Util.glMatrix.quat.rotateY=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=r*l-a*o,t[1]=n*l+s*o,t[2]=a*l+r*o,t[3]=s*l-n*o,t},BIMSURFER.Util.glMatrix.quat.rotateZ=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*o,t[1]=n*l-r*o,t[2]=a*l+s*o,t[3]=s*l-a*o,t},BIMSURFER.Util.glMatrix.quat.calculateW=function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t},BIMSURFER.Util.glMatrix.quat.dot=BIMSURFER.Util.glMatrix.vec4.dot,BIMSURFER.Util.glMatrix.quat.lerp=BIMSURFER.Util.glMatrix.vec4.lerp,BIMSURFER.Util.glMatrix.quat.slerp=function(t,e,i,r){var n,a,s,o,l,c=e[0],h=e[1],u=e[2],g=e[3],M=i[0],d=i[1],R=i[2],f=i[3];return(a=c*M+h*d+u*R+g*f)<0&&(a=-a,M=-M,d=-d,R=-R,f=-f),1-a>1e-6?(n=Math.acos(a),s=Math.sin(n),o=Math.sin((1-r)*n)/s,l=Math.sin(r*n)/s):(o=1-r,l=r),t[0]=o*c+l*M,t[1]=o*h+l*d,t[2]=o*u+l*R,t[3]=o*g+l*f,t},BIMSURFER.Util.glMatrix.quat.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i*i+r*r+n*n+a*a,o=s?1/s:0;return t[0]=-i*o,t[1]=-r*o,t[2]=-n*o,t[3]=a*o,t},BIMSURFER.Util.glMatrix.quat.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},BIMSURFER.Util.glMatrix.quat.length=BIMSURFER.Util.glMatrix.vec4.length,BIMSURFER.Util.glMatrix.quat.len=BIMSURFER.Util.glMatrix.quat.length,BIMSURFER.Util.glMatrix.quat.squaredLength=BIMSURFER.Util.glMatrix.vec4.squaredLength,BIMSURFER.Util.glMatrix.quat.sqrLen=BIMSURFER.Util.glMatrix.quat.squaredLength,BIMSURFER.Util.glMatrix.quat.normalize=BIMSURFER.Util.glMatrix.vec4.normalize,BIMSURFER.Util.glMatrix.quat.fromMat3=function(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[7]-e[5])*i,t[1]=(e[2]-e[6])*i,t[2]=(e[3]-e[1])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var a=(n+1)%3,s=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*a+a]-e[3*s+s]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*s+a]-e[3*a+s])*i,t[a]=(e[3*a+n]+e[3*n+a])*i,t[s]=(e[3*s+n]+e[3*n+s])*i}return t},BIMSURFER.Util.glMatrix.quat.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},BIMSURFER.Events=BIMSURFER.Class({CLASS:"BIMSURFER.Events",SYSTEM:null,listeners:{},object:null,__construct:function(t){this.object=t,this.listeners={}},register:function(t,e,i){"string"==typeof t&&"function"==typeof e&&(this.listeners[t]||(this.listeners[t]=new Array),this.listeners[t].push({object:BIMSURFER.Util.isset(i)?i:this.object,callback:e}))},unregister:function(t,e,i){if("string"==typeof t&&"function"==typeof e&&(i=BIMSURFER.Util.isset(i)?i:this.object,this.listeners[t]))for(var r=0;r<this.listeners[t].length;r++)if(this.listeners[t][r].object==i&&this.listeners[t][r].callback==e){this.listeners[t].splice(r,1);break}},trigger:function(t,e,i){if("string"!=typeof t)return!1;if(e=e||new Array,BIMSURFER.Util.isset(e)?BIMSURFER.Util.isArray(e)||(e=[e]):e=new Array,"mouse"==t.substring(0,5).toLowerCase()&&(e[0]=this.normalizeEvent(e[0])),!this.listeners[t]||0==this.listeners[t].length)return!0;for(var r=this.listeners[t].slice(0),n=0;n<r.length;n++){if(!1===(BIMSURFER.Util.isset(i)?r[n].callback.apply(i,e):r[n].callback.apply(r[n].object,e)))return!1}return!0},normalizeEvent:function(t){return t}}),BIMSURFER.Control=BIMSURFER.Class({CLASS:"BIMSURFER.Control",SYSTEM:null,div:null,DOMelement:null,active:!1,events:null,__construct:function(t){"string"==typeof t?this.div=jQuery(document).find("div#"+t)[0]||null:jQuery(t).is("div")&&(this.div=t),this.events=new BIMSURFER.Events(this)},redraw:function(){return jQuery(this.div).empty(),jQuery(this.DOMelement).remove(),this.DOMelement=jQuery("<div />").addClass(this.CLASS.replace(/\./g,"-")),this.active&&jQuery(this.div).append(this.DOMelement),this},setViewer:function(t){return this.active&&this.deactivate(),this.SYSTEM=t,this},removeFromSurfer:function(){return this.SYSTEM=null,this},initEvents:function(){return this},activate:function(){return this.div&&(this.active=!0,this.redraw(),this.initEvents(),this.show()),this.events.trigger("activated"),this},activateWhenReady:function(){if(this.SYSTEM.sceneLoaded)this.activate();else{var t=this,e=function(){t.SYSTEM.events.unregister("sceneLoaded",e),t.activate()};this.SYSTEM.events.register("sceneLoaded",e)}return this},deactivate:function(){return this.active=!1,this.initEvents(),jQuery(this.DOMelement).remove(),this.DOMelement=null,this.events.trigger("deactivated"),this},show:function(t){switch(t){case"fast":case"normal":case"slow":jQuery(this.DOMelement).stop().fadeIn(t);break;default:jQuery(this.DOMelement).stop().show()}return this},hide:function(t){switch(t){case"fast":case"normal":case"slow":jQuery(this.DOMelement).stop().fadeOut(t);break;default:jQuery(this.DOMelement).stop().hide()}return this}}),BIMSURFER.DataInputStreamReader=BIMSURFER.Class({CLASS:"BIMSurfer.DataInputStreamReader",SYSTEM:null,arrayBuffer:null,dataView:null,pos:null,__construct:function(t,e){this.arrayBuffer=e,this.dataView=new DataView(this.arrayBuffer),this.pos=0},readUTF8:function(){var t=this.dataView.getInt16(this.pos);this.pos+=2;var e=new StringView(this.arrayBuffer.slice(this.pos,this.pos+t)).toString();return this.pos+=t,e},align4:function(){var t=4-this.pos%4;t>0&&4!=t&&(this.pos+=t)},align8:function(){var t=8-this.pos%8;t>0&&8!=t&&(this.pos+=t)},readFloat:function(){var t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t},readInt:function(){var t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t},readByte:function(){var t=this.dataView.getInt8(this.pos);return this.pos+=1,t},readLong:function(){var t=this.dataView.getUint32(this.pos,!0)+4294967296*this.dataView.getUint32(this.pos+4,!0);return this.pos+=8,t},readFloatArray2:function(t){for(var e=[],i=0;i<t;i++){var r=this.dataView.getFloat32(this.pos,!0);this.pos+=4,e.push(r)}return e},readFloatArray:function(t){try{var e=new Float32Array(this.arrayBuffer,this.pos,t);return this.pos+=4*t,e}catch(e){console.error(e,this.arrayBuffer.byteLength,this.pos,t)}},readDoubleArray:function(t){var e=new Float64Array(this.arrayBuffer,this.pos,t);return this.pos+=8*t,e},readIntArray2:function(t){for(var e=[],i=0;i<t;i++){var r=this.dataView.getInt32(this.pos,!0);this.pos+=4,e.push(r)}return e},readIntArray:function(t){var e=new Int32Array(this.arrayBuffer,this.pos,t);return this.pos+=4*t,e},readShortArray:function(t){try{var e=new Int16Array(this.arrayBuffer,this.pos,t);return this.pos+=2*t,e}catch(e){console.error(e,this.pos,t)}}}),BIMSURFER.ProgressLoader=BIMSURFER.Class({CLASS:"BIMSURFER.Class",SYSTEM:null,server:null,topicId:null,step:null,done:null,autoUnregister:null,registered:null,__construct:function(t,e,i,r,n,a){this.SYSTEM=t,this.server=e,this.topicId=i,this.step=r,this.done=n,this.autoUnregister=a,this.registered=!1;var s=this,o=!0;this.responseHandler=function(t,e){(s.registered||o)&&(s.registered=!0,s.progressHandler.apply(s,[t,e]))},this.server.registerProgressHandler(this.topicId,this.responseHandler,function(){s.registered=!0,o=!1})},unregister:function(){this.server.unregisterProgressHandler(this.topicId,this.responseHandler),this.registered=!1},responseHandler:null,progressHandler:function(t,e){"FINISHED"==e.state?(this.autoUnregister&&this.registered&&this.unregister(),this.done(e,this)):this.step(e,this)}}),"object"!=typeof BIMSURFER.Constants&&(BIMSURFER.Constants={}),BIMSURFER.Constants.timeoutTime=1e4,BIMSURFER.Constants.defaultTypes=["IfcColumn","IfcStair","IfcSlab","IfcWindow","IfcDoor","IfcBuildingElementProxy","IfcWallStandardCase","IfcWall","IfcBeam","IfcRailing","IfcProxy","IfcRoof"],BIMSURFER.Constants.materials={IfcSpace:{r:.137255,g:.403922,b:.870588,a:1},IfcRoof:{r:.837255,g:.203922,b:.270588,a:1},IfcSlab:{r:.637255,g:.603922,b:.670588,a:1},IfcWall:{r:.537255,g:.337255,b:.237255,a:1},IfcWallStandardCase:{r:.537255,g:.337255,b:.237255,a:1},IfcDoor:{r:.637255,g:.603922,b:.670588,a:1},IfcWindow:{r:.137255,g:.403922,b:.870588,a:.5},IfcOpeningElement:{r:.137255,g:.403922,b:.870588,a:0},IfcRailing:{r:.137255,g:.403922,b:.870588,a:1},IfcColumn:{r:.137255,g:.403922,b:.870588,a:1},IfcBeam:{r:.137255,g:.403922,b:.870588,a:1},IfcBeamStandardCase:{r:.137255,g:.403922,b:.870588,a:1},IfcFurnishingElement:{r:.137255,g:.403922,b:.870588,a:1},IfcCurtainWall:{r:.137255,g:.403922,b:.870588,a:1},IfcStair:{r:.637255,g:.603922,b:.670588,a:1},IfcStairFlight:{r:.637255,g:.603922,b:.670588,a:1},IfcBuildingElementProxy:{r:.5,g:.5,b:.5,a:1},IfcFlowSegment:{r:.137255,g:.403922,b:.870588,a:1},IfcFlowitting:{r:.137255,g:.403922,b:.870588,a:1},IfcFlowTerminal:{r:.137255,g:.403922,b:.870588,a:1},IfcProxy:{r:.137255,g:.403922,b:.870588,a:1},IfcSite:{r:.137255,g:.403922,b:.870588,a:1},IfcLightFixture:{r:.8470588235,g:.8470588235,b:.870588,a:1},IfcDuctSegment:{r:.8470588235,g:.427450980392,b:0,a:1},IfcDistributionFlowElement:{r:.8470588235,g:.427450980392,b:0,a:1},IfcDuctFitting:{r:.8470588235,g:.427450980392,b:0,a:1},IfcPlate:{r:.8470588235,g:.427450980392,b:0,a:.5},IfcPile:{r:.8470588235,g:.427450980392,b:0,a:1},IfcAirTerminal:{r:.8470588235,g:.427450980392,b:0,a:1},IfcMember:{r:.8470588235,g:.427450980392,b:0,a:1},IfcCovering:{r:.8470588235,g:.427450980392,b:0,a:1},IfcTransportElement:{r:.8470588235,g:.427450980392,b:0,a:1},IfcFlowController:{r:.8470588235,g:.427450980392,b:0,a:1},IfcFlowFitting:{r:.8470588235,g:.427450980392,b:0,a:1},IfcRamp:{r:.8470588235,g:.427450980392,b:0,a:1},IfcFurniture:{r:.8470588235,g:.427450980392,b:0,a:1},IfcFooting:{r:.8470588235,g:.427450980392,b:0,a:1},IfcSystemFurnitureElement:{r:.8470588235,g:.427450980392,b:0,a:1},IfcSpace:{r:.137255,g:.303922,b:.570588,a:.5},IfcBuildingElementPart:{r:1,g:.5,b:.5,a:1},IfcDistributionElement:{r:1,g:.5,b:.5,a:1},DEFAULT:{r:.8470588235,g:.427450980392,b:0,a:1}},BIMSURFER.Constants.camera={maxOrbitSpeed:.1*Math.PI,orbitSpeedFactor:.05,zoomSpeedFactor:.1,panSpeedFactor:.6},BIMSURFER.Constants.highlightSelectedObject={type:"material",wire:!0,id:"highlight",emit:0,baseColor:{r:0,g:1,b:0}},BIMSURFER.Constants.highlightSelectedSpecialObject={type:"material",id:"specialselectedhighlight",emit:1,baseColor:{r:.16,g:.7,b:.88},shine:10},BIMSURFER.Constants.ProgressBarStyle={Continuous:1,Marquee:2},BIMSURFER.Constants.clamp=function(t,e,i){return Math.min(Math.max(t,e),i)},Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t}),StringView.loadUTF8CharCode=function(t,e){var i=t.length,r=t[e];return r>251&&r<254&&e+5<i?1073741824*(r-252)+(t[e+1]-128<<24)+(t[e+2]-128<<18)+(t[e+3]-128<<12)+(t[e+4]-128<<6)+t[e+5]-128:r>247&&r<252&&e+4<i?(r-248<<24)+(t[e+1]-128<<18)+(t[e+2]-128<<12)+(t[e+3]-128<<6)+t[e+4]-128:r>239&&r<248&&e+3<i?(r-240<<18)+(t[e+1]-128<<12)+(t[e+2]-128<<6)+t[e+3]-128:r>223&&r<240&&e+2<i?(r-224<<12)+(t[e+1]-128<<6)+t[e+2]-128:r>191&&r<224&&e+1<i?(r-192<<6)+t[e+1]-128:r},StringView.putUTF8CharCode=function(t,e,i){var r=i;return e<128?t[r++]=e:e<2048?(t[r++]=192+(e>>>6),t[r++]=128+(63&e)):e<65536?(t[r++]=224+(e>>>12),t[r++]=128+(e>>>6&63),t[r++]=128+(63&e)):e<2097152?(t[r++]=240+(e>>>18),t[r++]=128+(e>>>12&63),t[r++]=128+(e>>>6&63),t[r++]=128+(63&e)):e<67108864?(t[r++]=248+(e>>>24),t[r++]=128+(e>>>18&63),t[r++]=128+(e>>>12&63),t[r++]=128+(e>>>6&63),t[r++]=128+(63&e)):(t[r++]=252+e/1073741824,t[r++]=128+(e>>>24&63),t[r++]=128+(e>>>18&63),t[r++]=128+(e>>>12&63),t[r++]=128+(e>>>6&63),t[r++]=128+(63&e)),r},StringView.getUTF8CharLength=function(t){return t<128?1:t<2048?2:t<65536?3:t<2097152?4:t<67108864?5:6},StringView.loadUTF16CharCode=function(t,e){var i=t[e];return i>55231&&e+1<t.length?(i-55296<<10)+t[e+1]+9216:i},StringView.putUTF16CharCode=function(t,e,i){var r=i;return e<65536?t[r++]=e:(t[r++]=55232+(e>>>10),t[r++]=56320+(1023&e)),r},StringView.getUTF16CharLength=function(t){return t<65536?1:2},StringView.b64ToUint6=function(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:43===t?62:47===t?63:0},StringView.uint6ToB64=function(t){return t<26?t+65:t<52?t+71:t<62?t-4:62===t?43:63===t?47:65},StringView.bytesToBase64=function(t){for(var e,i="",r=t.length,n=0,a=0;a<r;a++)e=a%3,a>0&&4*a/3%76==0&&(i+="\r\n"),n|=t[a]<<(16>>>e&24),2!==e&&t.length-a!=1||(i+=String.fromCharCode(StringView.uint6ToB64(n>>>18&63),StringView.uint6ToB64(n>>>12&63),StringView.uint6ToB64(n>>>6&63),StringView.uint6ToB64(63&n)),n=0);return i.replace(/A(?=A$|$)/g,"=")},StringView.base64ToBytes=function(t,e){for(var i,r,n=t.replace(/[^A-Za-z0-9\+\/]/g,""),a=n.length,s=e?Math.ceil((3*a+1>>>2)/e)*e:3*a+1>>>2,o=new Uint8Array(s),l=0,c=0,h=0;h<a;h++)if(r=3&h,l|=StringView.b64ToUint6(n.charCodeAt(h))<<18-6*r,3===r||a-h==1){for(i=0;i<3&&c<s;i++,c++)o[c]=l>>>(16>>>i&24)&255;l=0}return o},StringView.makeFromBase64=function(t,e,i,r){return new StringView("UTF-16"===e||"UTF-32"===e?StringView.base64ToBytes(t,"UTF-16"===e?2:4).buffer:StringView.base64ToBytes(t),e,i,r)},StringView.prototype.encoding="UTF-8",StringView.prototype.makeIndex=function(t,e){var i,r=this.rawData,n=r.length,a=e||0,s=a,o=isNaN(t)?1/0:t;if(t+1>r.length)throw new RangeError("StringView.prototype.makeIndex - The offset can't be major than the length of the array - 1.");switch(this.encoding){case"UTF-8":var l;for(i=0;s<n&&i<o;i++)s+=(l=r[s])>251&&l<254&&s+5<n?6:l>247&&l<252&&s+4<n?5:l>239&&l<248&&s+3<n?4:l>223&&l<240&&s+2<n?3:l>191&&l<224&&s+1<n?2:1;break;case"UTF-16":for(i=a;s<n&&i<o;i++)s+=r[s]>55231&&s+1<r.length?2:1;break;default:s=i=isFinite(t)?t:n-1}return t?s:i},StringView.prototype.toBase64=function(t){return StringView.bytesToBase64(t?this.bufferView.constructor===Uint8Array?this.bufferView:new Uint8Array(this.buffer):this.rawData.constructor===Uint8Array?this.rawData:new Uint8Array(this.buffer,this.rawData.byteOffset,this.rawData.length<<(this.rawData.constructor===Uint16Array?1:2)))},StringView.prototype.subview=function(t,e){var i,r,n,a,s="UTF-8"===this.encoding||"UTF-16"===this.encoding,o=t,l=this.rawData.length;return 0===l?new StringView(this.buffer,this.encoding):(a=s?this.makeIndex():l,r=t?Math.max((a+t)%a,0):0,n=Number.isInteger(e)?Math.max(e,0)+r>a?a-r:e:a,0===r&&n===a?this:(s?(o=this.makeIndex(r),i=this.makeIndex(n,o)-o):(o=r,i=n-r),"UTF-16"===this.encoding?o<<=1:"UTF-32"===this.encoding&&(o<<=2),new StringView(this.buffer,this.encoding,o,i)))},StringView.prototype.forEachChar=function(t,e,i,r){var n,a,s=this.rawData;if("UTF-8"===this.encoding||"UTF-16"===this.encoding){var o,l;"UTF-8"===this.encoding?(o=StringView.getUTF8CharLength,l=StringView.loadUTF8CharCode):"UTF-16"===this.encoding&&(o=StringView.getUTF16CharLength,l=StringView.loadUTF16CharCode),a=isFinite(i)?this.makeIndex(i):0,n=isFinite(r)?this.makeIndex(r,a):s.length;for(var c,h=0;a<n;h++)c=l(s,a),t.call(e||null,c,h,a,s),a+=o(c)}else for(a=isFinite(i)?i:0,n=isFinite(r)?r+a:s.length,a;a<n;a++)t.call(e||null,s[a],a,a,s)},StringView.prototype.valueOf=StringView.prototype.toString=function(){if("UTF-8"!==this.encoding&&"UTF-16"!==this.encoding)return String.fromCharCode.apply(null,this.rawData);var t,e,i="";"UTF-8"===this.encoding?(e=StringView.getUTF8CharLength,t=StringView.loadUTF8CharCode):"UTF-16"===this.encoding&&(e=StringView.getUTF16CharLength,t=StringView.loadUTF16CharCode);for(var r,n=this.rawData.length,a=0;a<n;a+=e(r))r=t(this.rawData,a),i+=String.fromCharCode(r);return i};var vecCrossProduct=function(t,e){var i=SceneJS_math_cross3Vec3([t.x,t.y,t.z],[e.x,e.y,e.z]);return{x:i[0],y:i[1],z:i[2]}},vecMultiplyScalar=function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}},vecSubtract=function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},vecMagnitude=function(t){var e=t.x,i=t.y,r=t.z;return Math.sqrt(e*e+i*i+r*r)},vecNormalize=function(t){return vecMultiplyScalar(t,1/vecMagnitude(t))},vecNegate=function(t){return{x:-t.x,y:-t.y,z:-t.z}},vecAdd=function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}};BIMSURFER.Control.PickFlyOrbit=BIMSURFER.Class(BIMSURFER.Control,{CLASS:"BIMSURFER.Control.PickFlyOrbit",touching:!1,orbitDragging:!1,panDragging:!1,orbiting:!1,flying:!1,panning:!1,lastX:null,lastY:null,downX:null,downY:null,direction:1,yaw:0,pitch:0,zoom:0,prevZoom:0,scale:1,prevScale:1,rate:40,lookAt:null,startEye:{x:0,y:0,z:0},eye:{x:0,y:0,z:0},look:{x:0,y:0,z:0},startPivot:{x:0,y:0,z:0},endPivot:{x:0,y:0,z:0},currentPivot:{x:0,y:0,z:0},flightStartTime:null,flightDuration:null,__construct:function(t){this.events=new BIMSURFER.Events(this),BIMSURFER.Util.isset(t)&&(this.eye=t.eye||this.eye,this.look=t.look||this.look,this.zoom=t.zoom||this.zoom)},activate:function(){return null!=this.SYSTEM&&this.SYSTEM.sceneLoaded?(this.lookAt=this.SYSTEM.scene.findNode("main-lookAt"),this.eye=this.lookAt.getEye(),this.startEye=this.lookAt.getEye(),this.rate=Math.abs(this.eye.z)/500,this.look=this.lookAt.getLook(),this.currentPivot=this.look,this.active=!0,this.initEvents(),this.events.trigger("activated"),this):(console.error("Cannot activate "+this.CLASS+": Surfer or scene not ready"),null)},deactivate:function(){return this.active=!1,this.initEvents(),this.events.trigger("deactivated"),this},initEvents:function(){return this.active?(this.SYSTEM.events.register("mouseDown",this.mouseDown,this),this.SYSTEM.events.register("mouseUp",this.mouseUp,this),this.SYSTEM.events.register("mouseMove",this.mouseMove,this),this.SYSTEM.events.register("mouseWheel",this.mouseWheel,this),this.SYSTEM.events.register("DOMMouseScroll",this.mouseWheel,this),this.SYSTEM.events.register("touchStart",this.touchStart,this),this.SYSTEM.events.register("touchMove",this.touchMove,this),this.SYSTEM.events.register("touchEnd",this.touchEnd,this),this.SYSTEM.events.register("pick",this.pick,this),this.SYSTEM.events.register("tick",this.tick,this),this.SYSTEM.events.register("touchPinch",this.touchPinch,this),this.SYSTEM.events.register("touchPan",this.touchPan,this)):(this.SYSTEM.events.unregister("mouseDown",this.mouseDown,this),this.SYSTEM.events.unregister("mouseUp",this.mouseUp,this),this.SYSTEM.events.unregister("mouseMove",this.mouseMove,this),this.SYSTEM.events.unregister("mouseWheel",this.mouseWheel,this),this.SYSTEM.events.unregister("touchStart",this.touchStart,this),this.SYSTEM.events.unregister("touchMove",this.touchMove,this),this.SYSTEM.events.unregister("touchEnd",this.touchEnd,this),this.SYSTEM.events.unregister("pick",this.pick,this),this.SYSTEM.events.unregister("tick",this.tick,this),this.SYSTEM.events.unregister("touchPinch",this.touchPinch,this),this.SYSTEM.events.unregister("touchPan",this.touchPan,this)),this},ease:function(t,e,i,r){e=e||0,i=i||1;var n=(t/=r=r||1)*t;return e+i*(-1*n*n+4*(n*t)+-6*n+4*t)},lerp:function(t,e,i){return t+(e-t)*i},lerp3:function(t,e,i,r){for(var n=0;n<3;++n){var a=String.fromCharCode("x".charCodeAt(0)+n);t[a]=this.lerp(e[a],i[a],r)}},updateTimer:function(){this.timeNow=+new Date,null===this.flightStartTime&&(this.flightStartTime=this.timeNow),this.timeElapsed=this.timeNow-this.flightStartTime,this.timeElapsedNormalized=Math.min(this.timeElapsed/this.flightDuration,1),this.timeElapsed>=this.flightDuration&&(this.flying=!1,this.flightStartTime=null,this.rotating=!1,this.startYaw=this.startPitch=this.endYaw=this.endPitch=null)},sphericalCoords:function(t){var e=vecMagnitude(t);return{phi:Math.acos(t.z/e),theta:Math.atan2(t.y,t.x)}},tick:function(){if(this.flying){this.updateTimer();var t=this.ease(this.timeElapsedNormalized);this.lerp3(this.currentPivot,this.startPivot,this.endPivot,t),this.orbiting=!0,this.rotating&&(this.pitch=this.lerp(this.startPitch,this.endPitch,t),this.yaw=this.lerp(this.startYaw,this.endYaw,t))}if(this.orbiting){for(var e=vecMagnitude(this.startEye),i=this.sphericalCoords(this.startEye),r=i.phi,n=i.theta,a=2*Math.PI,s=this.pitch*BIMSURFER.Constants.camera.orbitSpeedFactor+r;s>a;)s-=a;for(;s<0;)s+=a;s>Math.PI?-1!=this.direction&&(this.direction=-1,this.lookAt.set("up",{x:0,y:0,z:-1})):1!=this.direction&&(this.direction=1,this.lookAt.set("up",{x:0,y:0,z:1}));var o=this.yaw*BIMSURFER.Constants.camera.orbitSpeedFactor+n,l=e*Math.sin(s)*Math.cos(o),c=e*Math.sin(s)*Math.sin(o),h=e*Math.cos(s),u=l*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor,g=c*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor,M=h*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor;(l>=0&&u>l||l<0&&u<l||c>=0&&g>c||c<0&&g<c||h>=0&&M>h||h<0&&M<h)&&(this.zoom=this.prevZoom,u=l*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor,g=c*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor,M=h*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor),l-=u,c-=g,h-=M,this.prevZoom=this.zoom,l+=this.currentPivot.x,c+=this.currentPivot.y,h+=this.currentPivot.z,this.eye={x:l,y:c,z:h};this.lookAt.getEye(),this.lookAt.getLook(),this.lookAt.getUp();this.lookAt.setLook(this.currentPivot),this.lookAt.setEye(this.eye),this.orbiting=!1}this.panning&&(this.lookAt.setLook(this.currentPivot),this.lookAt.setEye(this.eye),this.panning=!1)},pick:function(t){if("__SceneJS_dontPickMe"!=t.name){this.startPivot={x:this.currentPivot.x,y:this.currentPivot.y,z:this.currentPivot.z},this.endPivot={x:t.worldPos[0],y:t.worldPos[1],z:t.worldPos[2]};var e={x:this.endPivot.x-this.startPivot.x,y:this.endPivot.y-this.startPivot.y,z:this.endPivot.z-this.startPivot.z},i=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);this.flightStartTime=null,this.flightDuration=1e3*(i/15e3+1),this.flying=!0}},obtainView:function(){var t=this.lookAt.getEye(),e=this.lookAt.getLook(),i=this.lookAt.getUp(),r=vecNormalize(vecSubtract(e,t));return i=vecCrossProduct(vecCrossProduct(r,i),r),i=vecNormalize(i),{eye:t,dir:r,up:i}},restoreView:function(t){var e=vecMagnitude(vecSubtract(this.eye,this.currentPivot)),i=vecSubtract(this.eye,this.currentPivot);this.startEye={x:i.x,y:i.y,z:i.z};var r=this.sphericalCoords(this.startEye),n=this.sphericalCoords(vecNegate(t.dir));this.endYaw=(n.theta-r.theta)/BIMSURFER.Constants.camera.orbitSpeedFactor,this.endPitch=(n.phi-r.phi)/BIMSURFER.Constants.camera.orbitSpeedFactor,this.rotating=!0,this.startYaw=this.startPitch=this.yaw=this.pitch=0,this.zoom=this.prevZoom=0,this.startPivot={x:this.currentPivot.x,y:this.currentPivot.y,z:this.currentPivot.z},this.endPivot=vecSubtract(t.eye,vecNegate(vecMultiplyScalar(t.dir,e))),this.flightStartTime=null,this.flightDuration=1e3,this.flying=!0},actionMove:function(t,e){if(this.orbitDragging)this.yaw-=(t-this.lastX)*this.direction*.1,this.pitch-=.1*(e-this.lastY),this.orbiting=!0;else if(this.panDragging){var i=this.rate,r=this.lookAt.getEye(),n=this.currentPivot,a=vecNormalize(this.lookAt.getUp()),s=vecNormalize(vecSubtract({x:n.x,y:n.y,z:n.z},{x:r.x,y:r.y,z:r.z})),o=vecCrossProduct(a,s);a=vecNormalize(vecCrossProduct(o,s));var l=vecNormalize(vecCrossProduct(s,a)),c=vecMultiplyScalar(l,(t-this.lastX)*i),h=vecMultiplyScalar(a,-1*(e-this.lastY)*i),u=vecAdd(c,h);this.currentPivot=vecAdd({x:n.x,y:n.y,z:n.z},u),this.eye=vecAdd({x:r.x,y:r.y,z:r.z},u),this.panning=!0}this.lastX=t,this.lastY=e},mouseDown:function(t){this.lastX=this.downX=t.offsetX,this.lastY=this.downY=t.offsetY,1==t.which&&(this.orbitDragging=!0),2!=t.which&&3!=t.which||(this.panDragging=!0,t.preventDefault(),t.stopPropagation())},mouseUp:function(t){this.orbitDragging=!1,this.panDragging=!1,2!=t.which&&3!=t.which||(t.preventDefault(),t.stopPropagation())},mouseMove:function(t){this.touching||this.actionMove(t.offsetX,t.offsetY)},mouseWheel:function(t){var e=0,i=t;i.wheelDelta?(e=i.wheelDelta/120,window.opera&&(e=-e)):i.detail&&(e=-i.detail/3),e&&(e<0&&this.zoom>-25?this.zoom-=1:e>0&&(this.zoom+=1)),i.preventDefault&&i.preventDefault(),i.preventDefault(),this.orbiting=!0},touchStart:function(t){1==t.targetTouches.length&&(this.lastX=this.downX=t.targetTouches[0].clientX,this.lastY=this.downY=t.targetTouches[0].clientY,this.orbitDragging=!0,this.touching=!0)},touchMove:function(t){1==t.targetTouches.length&&this.actionMove(t.targetTouches[0].clientX,t.targetTouches[0].clientY)},touchEnd:function(t){1==t.targetTouches.length?(this.orbitDragging=!1,this.panDragging=!1,this.touching=!1):this.prevScale=1},touchPinch:function(t){var e=0,i=t;i.scale&&(this.scale=i.scale,e=this.prevScale-this.scale),e&&(e>.1&&this.zoom>-25?(this.zoom-=1,this.prevScale=this.scale):e<-.1&&(this.zoom+=1,this.prevScale=this.scale)),i.preventDefault&&i.preventDefault(),i.preventDefault(),this.orbiting=!0},touchPan:function(t){this.orbitDragging=!1,this.panDragging=!0,this.actionMove(this.downX+t.deltaX,this.downY+t.deltaY),this.panDragging=!1}}),BIMSURFER.Control.ClickSelect=BIMSURFER.Class(BIMSURFER.Control,{CLASS:"BIMSURFER.Control.ClickSelect",downX:null,downY:null,active:!1,highlighted:null,lastSelected:0,__construct:function(){this.events=new BIMSURFER.Events(this)},activate:function(){return null!=this.SYSTEM&&this.SYSTEM.sceneLoaded?(this.active||(this.active=!0,this.initEvents(),this.events.trigger("activated")),this):(console.error("Cannot activate "+this.CLASS+": Surfer or scene not ready"),null)},initEvents:function(){return this.active?(this.SYSTEM.events.register("pick",this.pick,this),this.SYSTEM.events.register("mouseDown",this.mouseDown,this),this.SYSTEM.events.register("mouseUp",this.mouseUp,this)):(this.SYSTEM.events.unregister("pick",this.pick,this),this.SYSTEM.events.unregister("mouseDown",this.mouseDown,this),this.SYSTEM.events.unregister("mouseUp",this.mouseUp,this)),this},mouseDown:function(t){this.downX=t.offsetX,this.downY=t.offsetY},mouseUp:function(t){(t.offsetX>this.downX?t.offsetX-this.downX<5:this.downX-t.offsetX<5)&&(t.offsetY>this.downY?t.offsetY-this.downY<5:this.downY-t.offsetY<5)&&Date.now()-this.lastSelected>10&&this.unselect()},pick:function(t){this.unselect(),this.highlighted=this.SYSTEM.scene.findNode(t.nodeId);var e=this.highlighted.findParentByType("translate").data.groupId,i=this.highlighted.nodes[0],r=i.nodes[0];if(null!=r._core.arrays.colors){var n={type:"geometry",primitive:"triangles"};n.coreId=r.getCoreId()+"Highlighted",n.indices=r._core.arrays.indices,n.positions=r._core.arrays.positions,n.normals=r._core.arrays.normals,n.colors=[];for(var a=0;a<r._core.arrays.colors.length;a+=4)n.colors[a]=0,n.colors[a+1]=1,n.colors[a+2]=0,n.colors[a+3]=1;this.SYSTEM.scene.findNode("library-"+e).add("node",n);var s={type:"geometry",coreId:r.getCoreId()+"Highlighted"};i.removeNode(r),i.addNode(s)}this.highlighted.insert("node",BIMSURFER.Constants.highlightSelectedObject),this.lastSelected=Date.now();var o=this;window.setTimeout(function(){o.events.trigger("select",[e,o.highlighted])},0)},unselect:function(){var t=this.SYSTEM.scene.findNode(BIMSURFER.Constants.highlightSelectedObject.id);if(null!=t){t.findParentByType("translate").data.groupId;if(null!=t){var e=t.nodes[0],i=e.nodes[0];if(null!=i._core.arrays.colors){e.removeNode(i);var r={type:"geometry",coreId:i.getCoreId().replace("Highlighted","")};e.addNode(r)}t.splice(),this.events.trigger("unselect",[null==this.highlighted?null:this.highlighted.findParentByType("translate").groupId,this.highlighted]),this.highlighted=null}}}}),BIMSURFER.Light=BIMSURFER.Class({CLASS:"BIMSURFER.Light",SYSTEM:null,lightObject:null,__construct:function(){},activate:function(){var t=this.SYSTEM.scene.findNode("my-lights"),e=t._core.lights;if(BIMSURFER.Util.isArray(this.lightObject))for(var i=0;i<this.lightObject.length;i++)-1==e.indexOf(this.lightObject[i])&&e.push(this.lightObject[i]);else-1==e.indexOf(this.lightObject)&&e.push(this.lightObject);t.setLights(e)},deactivate:function(){this.SYSTEM.scene.findNode("my-lights");var t=myLights._core.lights,e=-1;if(BIMSURFER.Util.isArray(this.lightObject))for(e=0;e<this.lightObject.length;e++){var i=t.indexOf(this.lightObject[e]);i>-1&&t.splice(i,1)}else(e=t.indexOf(this.lightObject)>-1)&&t.splice(e,1);myLights.setLights(t)},setViewer:function(t){this.SYSTEM=t}}),BIMSURFER.Light.Sun=BIMSURFER.Class(BIMSURFER.Light,{CLASS:"BIMSURFER.Light.Sun",__construct:function(t){this.SYSTEM=t,this.lightObject={type:"light",id:"sun-light",mode:"dir",color:{r:.8,g:.8,b:.8},dir:{x:-.5,y:.5,z:-1},diffuse:!0,specular:!0}}}),BIMSURFER.Light.Camera=BIMSURFER.Class(BIMSURFER.Light,{CLASS:"BIMSURFER.Light.Camera",__construct:function(t){this.SYSTEM=t,this.lightObject={type:"light",id:"sun-light",mode:"dir",color:{r:1,g:1,b:1},dir:{x:-.5,y:-.5,z:-1},space:"world",diffuse:!0,specular:!0}}}),BIMSURFER.Light.Ambient=BIMSURFER.Class(BIMSURFER.Light,{CLASS:"BIMSURFER.Light.Ambient",__construct:function(t){this.SYSTEM=t,this.lightObject=new Array({mode:"ambient",color:{r:.3,g:.3,b:.3},diffuse:!1,specular:!1},{mode:"dir",color:{r:1,g:1,b:1},diffuse:!0,specular:!0,dir:{x:-.5,y:-.5,z:-1},space:"view"})}});